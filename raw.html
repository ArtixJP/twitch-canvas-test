<!DOCTYPE html>

<html lang="en">
<head>
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' https:; script-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com https://cdn.jsdelivr.net https://unpkg.com https://esm.sh https://esm.run https://cdn.tailwindcss.com https://threejs.org https://cdn.threejs.org https://cdn.p5js.org https://code.jquery.com https://d3js.org https://cdn.plot.ly https://cdn.tonejs.org; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://fonts.gstatic.com https://cdnjs.cloudflare.com https://cdn.jsdelivr.net; img-src 'self' data: https:; media-src 'self' https:; font-src 'self' https://fonts.gstatic.com https://fonts.googleapis.com https://cdnjs.cloudflare.com https://cdn.jsdelivr.net; worker-src 'self'; frame-src https://www.youtube.com https://www.youtube-nocookie.com https://player.vimeo.com; connect-src 'self' https: wss: ws:; object-src 'none'; base-uri 'self'; form-action 'self';">
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>üî¥ POK√âMON SIMULATOR - Gotta Catch 'Em All! üî¥</title>
<style>
        * { box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', system-ui, sans-serif; 
            display: flex; 
            flex-direction: column;
            justify-content: flex-start; 
            align-items: center; 
            min-height: 100vh; 
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #0d0d1a 0%, #1a0a2e 50%, #0a1628 100%);
            color: #f0e6d3;
            overflow: hidden;
        }
        h1 { font-size: 2.5rem; text-align: center; text-shadow: 0 0 20px #ffd700, 0 0 40px #ff8c00; margin-bottom: 10px; }
        .subtitle { color: #ffd700; font-size: 1rem; margin-bottom: 20px; }
        .game-container { display: flex; gap: 20px; flex-wrap: wrap; justify-content: center; width: 100%; max-width: 1200px; position: relative; z-index: 10; }
        .panels-overlay { position: fixed; top: 10px; right: 10px; z-index: 100; display: flex; gap: 10px; flex-direction: column; max-height: 90vh; overflow-y: auto; }
        .panels-overlay .panel { opacity: 0.95; transform: scale(0.9); transform-origin: top right; }
        .toggle-panels-btn { position: fixed; top: 60px; left: 10px; z-index: 200; padding: 10px 20px; background: linear-gradient(180deg, #3a2a1a, #2a1a0a); border: 2px solid #ffd700; color: #ffd700; cursor: pointer; border-radius: 5px; font-weight: bold; }
        .fullscreen-indicator { position: fixed; bottom: 10px; left: 10px; z-index: 200; background: rgba(0,0,0,0.7); padding: 5px 10px; border-radius: 5px; font-size: 12px; color: #4a4; }
        @keyframes pulse-glow { 0%, 100% { box-shadow: 0 0 10px #ffd700; } 50% { box-shadow: 0 0 30px #ffd700, 0 0 50px #ff8c00; } }
        .world-enemy { animation: enemyFloat 2s infinite, pulse-glow 3s infinite; }
        .player-char { animation: pulse-glow 2s infinite; }
        .panel { background: linear-gradient(180deg, rgba(40,30,50,0.95) 0%, rgba(20,15,30,0.98) 100%); border: 2px solid #5a4a3a; border-radius: 8px; padding: 15px; box-shadow: 0 0 20px rgba(255,165,0,0.2), inset 0 0 30px rgba(0,0,0,0.5); }
        .character-panel { width: 280px; }
        .combat-panel { width: 500px; min-height: 350px; display: none; }
        .log-panel { width: 350px; height: 350px; overflow-y: auto; }
        .stat-bar { height: 20px; border-radius: 10px; margin: 5px 0; position: relative; overflow: hidden; }
        .health-bar { background: linear-gradient(90deg, #8b0000, #ff0000); box-shadow: 0 0 10px #ff0000; }
        .mana-bar { background: linear-gradient(90deg, #00008b, #4169e1); box-shadow: 0 0 10px #4169e1; }
        .xp-bar { background: linear-gradient(90deg, #4b0082, #9932cc); box-shadow: 0 0 10px #9932cc; }
        .bar-fill { height: 100%; transition: width 0.3s; border-radius: 10px; }
        .bar-text { position: absolute; width: 100%; text-align: center; font-size: 12px; line-height: 20px; text-shadow: 1px 1px 2px black; }
        .class-select { display: flex; gap: 10px; margin: 15px 0; flex-wrap: wrap; justify-content: center; }
        .class-btn { padding: 10px 15px; border: 2px solid #5a4a3a; background: linear-gradient(180deg, #3a2a1a, #2a1a0a); color: #ffd700; cursor: pointer; border-radius: 5px; transition: all 0.3s; font-weight: bold; }
        .class-btn:hover { border-color: #ffd700; box-shadow: 0 0 15px rgba(255,215,0,0.5); transform: scale(1.05); }
        .class-btn.selected { border-color: #ffd700; background: linear-gradient(180deg, #5a4a2a, #3a2a1a); }
        .enemy-display { text-align: center; padding: 20px; display: none; }
        .enemy-sprite { font-size: 80px; animation: enemyBounce 1s infinite; display: none; }
        @keyframes enemyBounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        .action-buttons { display: flex; gap: 10px; flex-wrap: wrap; justify-content: center; margin-top: 15px; }
        .action-btn { padding: 12px 20px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; transition: all 0.2s; text-transform: uppercase; }
        .attack-btn { background: linear-gradient(180deg, #8b0000, #5a0000); color: white; border: 2px solid #ff4444; }
        .skill-btn { background: linear-gradient(180deg, #00008b, #000050); color: white; border: 2px solid #4444ff; }
        .heal-btn { background: linear-gradient(180deg, #006400, #003200); color: white; border: 2px solid #44ff44; }
        .action-btn:hover { transform: scale(1.1); box-shadow: 0 0 20px currentColor; }
        .action-btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
        .log-entry { padding: 5px; border-bottom: 1px solid #3a3a3a; font-size: 13px; }
        .log-damage { color: #ff6b6b; }
        .log-heal { color: #6bff6b; }
        .log-xp { color: #d4a5ff; }
        .log-level { color: #ffd700; font-weight: bold; }
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 5px; font-size: 14px; margin: 10px 0; }
        .stat-item { background: rgba(0,0,0,0.3); padding: 5px; border-radius: 3px; }
        .gold-display { color: #ffd700; font-size: 18px; text-align: center; margin: 10px 0; }
        .world-panel { width: 100vw; height: 100vh; position: fixed; top: 0; left: 0; overflow: hidden; background: linear-gradient(180deg, #1a3a1a 0%, #0d2a0d 100%); border: none; z-index: 1; image-rendering: pixelated; perspective: 800px; transform-style: preserve-3d; }
        .world-floor { transform: rotateX(60deg) translateZ(-100px) scale(2.5); transform-origin: center center; background-image: repeating-linear-gradient(90deg, transparent, transparent 40px, rgba(0,80,0,0.3) 40px, rgba(0,80,0,0.3) 42px), repeating-linear-gradient(0deg, transparent, transparent 40px, rgba(0,80,0,0.3) 40px, rgba(0,80,0,0.3) 42px); }
        .world-3d-horizon { position: absolute; top: 0; left: 0; width: 100%; height: 40%; background: linear-gradient(180deg, #1a0a2e 0%, #2a1a4e 30%, #3a5a3a 70%, #1a4a1a 100%); z-index: 0; }
        .world-3d-mountains { position: absolute; top: 15%; left: 0; width: 100%; height: 25%; z-index: 1; font-size: 80px; letter-spacing: -20px; opacity: 0.6; filter: blur(2px); color: #2a3a2a; }
        .world-panel.minimized { width: 100%; max-width: 600px; height: 400px; position: relative; border: 3px solid #5a4a3a; }
        .world-floor { position: absolute; width: 100%; height: 100%; background-image: repeating-linear-gradient(90deg, transparent, transparent 40px, rgba(80,0,80,0.15) 40px, rgba(80,0,80,0.15) 41px), repeating-linear-gradient(0deg, transparent, transparent 40px, rgba(80,0,80,0.15) 40px, rgba(80,0,80,0.15) 41px); background-color: #0a0a1a; }
        @keyframes voidPulse { 0%, 100% { opacity: 0.7; } 50% { opacity: 0.9; } }
        .world-tree { position: absolute; font-size: 50px; z-index: 2; pointer-events: none; filter: drop-shadow(3px 6px 8px rgba(0,0,0,0.7)); transform: perspective(500px) rotateX(-5deg); }
        .world-rock { position: absolute; font-size: 35px; z-index: 2; pointer-events: none; opacity: 0.8; }
        .player-char { position: absolute; font-size: 40px; transition: left 0.15s, top 0.15s; z-index: 10; filter: drop-shadow(0 0 5px #ffd700) drop-shadow(2px 4px 6px rgba(0,0,0,0.5)); cursor: pointer; transform: perspective(500px) rotateX(-10deg); }
        .world-enemy { position: absolute; font-size: 35px; cursor: pointer; animation: enemyFloat 2s infinite; z-index: 5; filter: drop-shadow(2px 4px 6px rgba(0,0,0,0.6)); transform: perspective(500px) rotateX(-10deg); }
        .world-chest { position: absolute; font-size: 30px; cursor: pointer; z-index: 5; }
        .world-chest:hover, .world-enemy:hover { transform: scale(1.2); filter: drop-shadow(0 0 10px gold); }
        @keyframes enemyFloat { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }
        .daggers { position: absolute; font-size: 20px; opacity: 0; transition: all 0.2s; }
        .daggers.attack-left { opacity: 1; transform: translateX(-30px) rotate(-45deg); }
        .daggers.attack-right { opacity: 1; transform: translateX(30px) rotate(45deg); }
        .world-controls { text-align: center; margin-top: 10px; font-size: 12px; color: #aaa; }
        .level-display { font-size: 24px; color: #ffd700; text-align: center; }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }
        .shake { animation: shake 0.3s; }
        @keyframes glow { 0%, 100% { filter: brightness(1); } 50% { filter: brightness(1.5); } }
        .glow { animation: glow 0.5s; }
    </style>
</head>
<body>
<h1 style="position:fixed;top:10%;left:50%;transform:translateX(-50%);z-index:150;background:transparent;padding:20px 40px;font-size:2.5rem;margin:0;color:#ff4444;text-shadow:0 0 30px #ff0000,0 0 60px #880000;animation:fadeIn 3s ease-out;">üî¥ POK√âMON SIMULATOR üî¥</h1>
<style>@keyframes fadeIn { 0% { opacity:0; transform:translate(-50%,-50%) scale(0.5); } 100% { opacity:1; transform:translate(-50%,-50%) scale(1); } }</style>
<p style="position:fixed;bottom:20%;left:50%;transform:translateX(-50%);color:#f0f;font-size:1.2rem;text-align:center;z-index:100;text-shadow:0 0 10px #808;">üéÆ WASD to explore tall grass ‚Ä¢ Click wild Pok√©mon to battle ‚Ä¢ Throw Pok√©balls to catch! üéÆ</p>
<div id="captured-display" style="position:fixed;top:70px;left:20px;color:#f0f;font-family:monospace;font-size:14px;z-index:100;background:linear-gradient(180deg,rgba(80,0,80,0.9),rgba(40,0,60,0.95));padding:12px 15px;border-radius:10px;border:2px solid #f0f;box-shadow:0 0 20px rgba(255,0,255,0.4);">
<div style="font-weight:bold;margin-bottom:8px;font-size:16px;color:#ff4444;">üìñ POK√âDEX</div><div id="trainer-badges" style="font-size:10px;margin-bottom:5px;">üèÖ Badges: <span id="badge-count">0</span>/8</div>
üîÆ Captured: <span id="capture-count">0</span>/5
<div id="captured-list" style="margin-top:8px;font-size:12px;max-height:100px;overflow-y:auto;"></div>
</div>
<div id="spaceship" style="position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);font-size:48px;z-index:50;transition:transform 0.1s;filter:drop-shadow(0 0 20px #ffd700);cursor:pointer;">üß¢</div>
<div id="coordinates" style="position:fixed;top:20px;left:20px;color:#4f4;font-family:monospace;font-size:14px;z-index:100;background:rgba(0,0,0,0.5);padding:10px;border-radius:5px;border:1px solid #4f4;">üó∫Ô∏è ROUTE 1 | Steps: 0 | TALL GRASS</div>
<div id="space-objects"></div>
<div id="planet-3d" style="position:fixed;right:15%;top:20%;width:200px;height:200px;border-radius:50%;background:radial-gradient(circle at 30% 30%, #4a90d9, #1a3a6e 40%, #0d1f3c 80%, #050a14);box-shadow:inset -30px -20px 40px rgba(0,0,0,0.8), inset 10px 10px 30px rgba(255,255,255,0.1), 0 0 60px rgba(74,144,217,0.4), 0 0 120px rgba(74,144,217,0.2);z-index:20;animation:planetRotate 20s linear infinite;transform-style:preserve-3d;">
<div style="position:absolute;width:100%;height:100%;border-radius:50%;background:linear-gradient(90deg, transparent 0%, rgba(100,180,255,0.1) 20%, transparent 40%, rgba(255,200,100,0.05) 60%, transparent 80%);animation:planetRotate 15s linear infinite reverse;"></div>
<div style="position:absolute;top:35%;left:10%;width:25%;height:8%;background:rgba(255,255,255,0.15);border-radius:50%;filter:blur(3px);"></div>
<div style="position:absolute;top:55%;left:40%;width:35%;height:10%;background:rgba(200,150,100,0.2);border-radius:50%;filter:blur(4px);"></div>
</div>
<div id="shooting-star-container" style="position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:15;overflow:hidden;"></div>
<button id="bigbang-btn" style="position:fixed;bottom:20px;right:20px;z-index:200;padding:15px 25px;background:radial-gradient(circle,#ff6600,#ff0000);border:2px solid #ffd700;color:#fff;font-weight:bold;cursor:pointer;border-radius:50%;font-size:12px;box-shadow:0 0 20px #ff4400;">üí• BIG BANG</button>
<div id="pokemon-battle" style="display:none;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);z-index:250;background:linear-gradient(180deg,#1a2a4a,#0a1020);border:4px solid #4a90d9;border-radius:15px;padding:20px;width:400px;box-shadow:0 0 40px rgba(74,144,217,0.6);">
<div style="display:flex;justify-content:space-between;margin-bottom:15px;">
<div id="enemy-pokemon" style="text-align:center;"><div id="enemy-sprite-poke" style="font-size:60px;">üëæ</div><div id="enemy-name-poke" style="color:#fff;font-weight:bold;">Wild Nebulax</div><div style="background:#333;border-radius:10px;height:12px;width:120px;margin-top:5px;"><div id="enemy-hp-bar" style="background:linear-gradient(90deg,#4f4,#0a0);height:100%;width:100%;border-radius:10px;transition:width 0.3s;"></div></div></div>
<div id="player-pokemon" style="text-align:center;"><div style="font-size:60px;">üß¢</div><div style="color:#0ff;font-weight:bold;">TRAINER</div><div style="background:#333;border-radius:10px;height:12px;width:120px;margin-top:5px;"><div id="player-hp-bar" style="background:linear-gradient(90deg,#4af,#08f);height:100%;width:100%;border-radius:10px;transition:width 0.3s;"></div></div></div>
</div>
<div id="battle-log" style="background:#000;color:#0f0;font-family:monospace;padding:10px;border-radius:5px;height:60px;overflow-y:auto;margin-bottom:10px;font-size:12px;">A wild cosmic creature appeared!</div>
<div style="display:flex;gap:10px;flex-wrap:wrap;justify-content:center;">
<button onclick="pokeBattleAction('laser')" style="padding:10px 20px;background:#e44;border:2px solid #f66;color:#fff;border-radius:8px;cursor:pointer;font-weight:bold;">‚ö° LASER</button>
<button onclick="pokeBattleAction('shield')" style="padding:10px 20px;background:#44e;border:2px solid #66f;color:#fff;border-radius:8px;cursor:pointer;font-weight:bold;">üõ°Ô∏è SHIELD</button>
<button onclick="pokeBattleAction('capture')" style="padding:10px 20px;background:linear-gradient(180deg,#ff4444,#cc0000);border:2px solid #fff;color:#fff;border-radius:50%;width:60px;height:60px;cursor:pointer;font-weight:bold;box-shadow:0 0 15px #ff0000;">üî¥</button>
<button onclick="pokeBattleAction('flee')" style="padding:10px 20px;background:#444;border:2px solid #666;color:#fff;border-radius:8px;cursor:pointer;font-weight:bold;">üèÉ FLEE</button>
</div>
</div>
<div id="canon-panel" style="position:fixed;bottom:20px;left:20px;z-index:200;background:linear-gradient(180deg,rgba(255,0,0,0.15),rgba(40,0,60,0.95));border:2px solid #ff4444;border-radius:10px;padding:15px;max-width:340px;color:#ffcccc;font-size:13px;box-shadow:0 0 20px rgba(255,68,68,0.4);backdrop-filter:blur(5px);">
<h3 style="margin:0 0 10px 0;color:#fff;text-shadow:0 0 10px #ff4444;font-size:14px;">üìú POK√âMON CANON</h3>
<p style="margin:5px 0;color:#ffd700;"><strong>Premise:</strong></p>
<p style="margin:0 0 10px 0;font-style:italic;">A Pokemon simulator - explore routes and tall grass as a trainer, encounter wild Pokemon, battle them with moves, and catch them all with Pokeballs for your Pokedex!</p>
<p style="margin:5px 0;color:#ffd700;"><strong>Core Invariants:</strong></p>
<ul style="margin:5px 0;padding-left:20px;">
<li>The page must remain functional and visually coherent</li>
<li>Pokemon-style battles with type system are core</li>
<li>Pokeball capture mechanic is central</li>
<li>Trainer exploration provides adventure</li>
<li>The Pokedex tracks captured Pokemon</li>
</ul>
<p style="margin:10px 0 5px 0;color:#ffd700;"><strong>Important Elements:</strong></p>
<p style="margin:0;font-family:monospace;font-size:11px;color:#0ff;">üî¥ #pokemon-battle | üìñ #captured-display | üß¢ #spaceship | üåü #space-objects | üëæ .wild-creature</p>
<button onclick="this.parentElement.style.display='none'" style="position:absolute;top:5px;right:8px;background:none;border:none;color:#888;cursor:pointer;font-size:16px;">√ó</button>
</div>
<script>
// Big Bang Effect - defined early to be available
function triggerBigBang() {
  const bang = document.createElement('div');
  bang.style.cssText = 'position:fixed;left:50%;top:50%;width:100px;height:100px;border-radius:50%;background:radial-gradient(circle,#fff 0%,#ffff00 20%,#ff8800 40%,#ff0000 60%,#880000 80%,transparent 100%);z-index:300;animation:bigBangPulse 2s ease-out forwards;pointer-events:none;';
  document.body.appendChild(bang);
  for(let i=0;i<50;i++) {
    setTimeout(()=>{
      const particle = document.createElement('div');
      const angle = Math.random()*Math.PI*2;
      const dist = 50+Math.random()*400;
      const emoji = ['üåü','‚≠ê','üí´','‚ú®','üî•'][Math.floor(Math.random()*5)];
      particle.textContent = emoji;
      particle.style.cssText = `position:fixed;left:50%;top:50%;font-size:${20+Math.random()*30}px;z-index:299;transition:all ${1+Math.random()}s ease-out;pointer-events:none;`;
      document.body.appendChild(particle);
      setTimeout(()=>{
        particle.style.transform = `translate(${Math.cos(angle)*dist}px, ${Math.sin(angle)*dist}px)`;
        particle.style.opacity = '0';
      },50);
      setTimeout(()=>particle.remove(),2000);
    },i*30);
  }
  setTimeout(()=>bang.remove(),2500);
}
document.getElementById('bigbang-btn').onclick = triggerBigBang;
</script>
<div id="void-canvas" style="position:fixed;top:0;left:0;width:100vw;height:100vh;background:radial-gradient(ellipse at center, #111 0%, #000 100%);z-index:0;"></div>
<div id="star-field" style="position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:1;"></div>
<canvas id="particle-canvas" style="position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:1000;"></canvas>
<script>
// Gentle star animation for the new beginning
const starField = document.getElementById('star-field');
for(let i = 0; i < 50; i++) {
  const star = document.createElement('div');
  star.style.cssText = `position:absolute;width:${Math.random()*3+1}px;height:${Math.random()*3+1}px;background:#fff;border-radius:50%;left:${Math.random()*100}%;top:${Math.random()*100}%;opacity:${Math.random()*0.7+0.3};animation:twinkle ${Math.random()*3+2}s infinite;`;
  starField.appendChild(star);
}
const style = document.createElement('style');
style.textContent = `@keyframes twinkle { 0%,100% { opacity:0.3; } 50% { opacity:1; } }
@keyframes shipGlow { 0%,100% { filter:drop-shadow(0 0 20px #0ff); } 50% { filter:drop-shadow(0 0 40px #0ff) drop-shadow(0 0 60px #08f); } }
@keyframes planetRotate { 0% { transform: rotateY(0deg); } 100% { transform: rotateY(360deg); } }
@keyframes shootingStar { 0% { transform: translate(0,0) scale(1); opacity:1; } 100% { transform: translate(-400px, 300px) scale(0.2); opacity:0; } }
@keyframes bigBangPulse { 0% { transform: translate(-50%,-50%) scale(0); opacity:1; } 50% { transform: translate(-50%,-50%) scale(3); opacity:0.8; } 100% { transform: translate(-50%,-50%) scale(8); opacity:0; } }`;
document.head.appendChild(style);

// Spatial Exploration System
let shipX = 0, shipY = 0;
let shipRotation = 0;
const ship = document.getElementById('spaceship');
const coords = document.getElementById('coordinates');
const spaceObjects = document.getElementById('space-objects');

// Generate cosmic objects
const cosmicEmojis = ['üëæ', 'üëª', 'ü¶Ñ', 'üåÄ', '‚ú®', 'üêâ', 'üëΩ', 'ü§ñ'];
for(let i = 0; i < 30; i++) {
  const obj = document.createElement('div');
  obj.className = 'cosmic-object';
  obj.style.cssText = `position:fixed;font-size:${20+Math.random()*40}px;left:${Math.random()*100}%;top:${Math.random()*100}%;z-index:5;opacity:0.7;transition:transform 0.3s;pointer-events:auto;cursor:pointer;`;obj.title='Click to encounter!';
  obj.textContent = cosmicEmojis[Math.floor(Math.random()*cosmicEmojis.length)];
  obj.classList.add('wild-creature');
  obj.dataset.parallax = (Math.random()*0.5+0.2).toFixed(2);
  spaceObjects.appendChild(obj);
}

const sectors = ['ROUTE 1', 'ROUTE 2', 'VIRIDIAN FOREST', 'CERULEAN CITY', 'VERMILION PORT', 'LAVENDER TOWN', 'SAFARI ZONE', 'VICTORY ROAD'];

function updateShip() {
  ship.style.transform = `translate(-50%,-50%) rotate(${shipRotation}deg)`;
  const sector = sectors[Math.abs(Math.floor(shipX/500) + Math.floor(shipY/500)) % sectors.length];
  const steps = Math.abs(Math.floor(shipX/20)) + Math.abs(Math.floor(shipY/20));
  coords.innerHTML = `üó∫Ô∏è ${sector} | Steps: ${steps} | TALL GRASS`;
  
  // Parallax effect on cosmic objects
  document.querySelectorAll('.cosmic-object').forEach(obj => {
    const p = parseFloat(obj.dataset.parallax);
    const offsetX = -shipX * p;
    const offsetY = -shipY * p;
    obj.style.transform = `translate(${offsetX}px, ${offsetY}px)`;
  });
  
  // Move stars too
  starField.style.transform = `translate(${-shipX*0.1}px, ${-shipY*0.1}px)`;
}

document.addEventListener('keydown', (e) => {
  const speed = 20;
  if(e.key === 'w' || e.key === 'ArrowUp') { shipY -= speed; shipRotation = 0; }
  if(e.key === 's' || e.key === 'ArrowDown') { shipY += speed; shipRotation = 180; }
  if(e.key === 'a' || e.key === 'ArrowLeft') { shipX -= speed; shipRotation = -90; }
  if(e.key === 'd' || e.key === 'ArrowRight') { shipX += speed; shipRotation = 90; }
  updateShip();
  // Spawn particles behind ship
  const rect = ship.getBoundingClientRect();
  spawnParticles(rect.left + rect.width/2, rect.top + rect.height/2, '#0ff', 3);
});

ship.style.animation = 'shipGlow 2s infinite';

// Shooting Star System
function createShootingStar() {
  const container = document.getElementById('shooting-star-container');
  const star = document.createElement('div');
  const startX = Math.random() * 60 + 40;
  const startY = Math.random() * 30;
  star.style.cssText = `position:absolute;left:${startX}%;top:${startY}%;width:4px;height:4px;background:#fff;border-radius:50%;box-shadow:0 0 10px #fff, 0 0 20px #fff, -20px 0 30px #fff, -40px 0 20px rgba(255,255,255,0.5), -80px 0 10px rgba(255,255,255,0.2);animation:shootingStar ${1.5+Math.random()}s linear forwards;`;
  container.appendChild(star);
  setTimeout(() => star.remove(), 3000);
}
setInterval(createShootingStar, 4000 + Math.random() * 3000);
setTimeout(createShootingStar, 1000);

// Big Bang Effect moved to earlier in page load

// Pokemon-style Battle System
const cosmicCreatures = [
  {name:'Nebulax',sprite:'üëæ',hp:40,atk:8,type:'Psychic'},
  {name:'Stardust',sprite:'‚ú®',hp:30,atk:12,type:'Fairy'},
  {name:'Voidling',sprite:'üëª',hp:50,atk:6,type:'Ghost'},
  {name:'Cosmog',sprite:'üåÄ',hp:35,atk:10,type:'Cosmic'},
  {name:'Astraleon',sprite:'ü¶Ñ',hp:60,atk:15,type:'Dragon'},
  {name:'Pikastar',sprite:'‚ö°',hp:35,atk:14,type:'Electric'},
  {name:'Charcomet',sprite:'üî•',hp:45,atk:16,type:'Fire'},
  {name:'Aquanaut',sprite:'üíß',hp:55,atk:10,type:'Water'}
];
let battleState = {active:false, playerHp:100, enemyHp:100, enemy:null, captured:[]};

function startBattle() {
  if(battleState.active) return;
  battleState.active = true;
  battleState.playerHp = 100;
  battleState.enemy = cosmicCreatures[Math.floor(Math.random()*cosmicCreatures.length)];
  battleState.enemyHp = battleState.enemy.hp;
  document.getElementById('pokemon-battle').style.display = 'block';
  document.getElementById('enemy-sprite-poke').textContent = battleState.enemy.sprite;
  document.getElementById('enemy-name-poke').textContent = 'Wild ' + battleState.enemy.name;
  document.getElementById('enemy-hp-bar').style.width = '100%';
  document.getElementById('player-hp-bar').style.width = '100%';
  document.getElementById('battle-log').innerHTML = 'üéµ Wild ' + battleState.enemy.name + ' appeared! üéµ<br>Type: ' + battleState.enemy.type;
}

function pokeBattleAction(action) {
  if(!battleState.active) return;
  const log = document.getElementById('battle-log');
  if(action === 'laser') {
    const dmg = 15 + Math.floor(Math.random()*10);
    battleState.enemyHp -= dmg;
    log.innerHTML += '<br>‚ö° Laser dealt ' + dmg + ' damage!';
  } else if(action === 'shield') {
    battleState.playerHp = Math.min(100, battleState.playerHp + 20);
    log.innerHTML += '<br>üõ°Ô∏è Shield restored 20 HP!';
  } else if(action === 'capture') {
    const chance = (1 - battleState.enemyHp/battleState.enemy.hp) * 80;
    if(Math.random()*100 < chance) {
      log.innerHTML += '<br>üî¥ *shake* *shake* *shake* ... ‚ú® CLICK! ‚ú®<br>üéâ Gotcha! ' + battleState.enemy.name + ' was caught!';
      updatePokedex();
      battleState.captured.push(battleState.enemy.name);
      setTimeout(endBattle, 1500);
      return;
    } else {
      log.innerHTML += '<br>üîÆ Capture failed!';
    }
  } else if(action === 'flee') {
    log.innerHTML += '<br>üèÉ Escaped safely!';
    setTimeout(endBattle, 1000);
    return;
  }
  // Enemy turn
  if(battleState.enemyHp > 0) {
    const eDmg = battleState.enemy.atk + Math.floor(Math.random()*5);
    battleState.playerHp -= eDmg;
    log.innerHTML += '<br>' + battleState.enemy.sprite + ' dealt ' + eDmg + ' damage!';
  }
  updateBattleUI();
  if(battleState.enemyHp <= 0) {
    log.innerHTML += '<br>üéâ ' + battleState.enemy.name + ' defeated!';
    setTimeout(endBattle, 1500);
  } else if(battleState.playerHp <= 0) {
    log.innerHTML += '<br>üí• Your ship was destroyed!';
    setTimeout(endBattle, 1500);
  }
  log.scrollTop = log.scrollHeight;
}

function updateBattleUI() {
  document.getElementById('enemy-hp-bar').style.width = Math.max(0,battleState.enemyHp/battleState.enemy.hp*100) + '%';
  document.getElementById('player-hp-bar').style.width = Math.max(0,battleState.playerHp) + '%';
}

function endBattle() {
  battleState.active = false;
  document.getElementById('pokemon-battle').style.display = 'none';
}

// Random encounters while exploring
setInterval(() => {
  if(!battleState.active && Math.random() < 0.08) {
    startBattle();
  }
}, 1500);

function updatePokedex() {
  document.getElementById('capture-count').textContent = battleState.captured.length;
  const list = document.getElementById('captured-list');
  list.innerHTML = battleState.captured.map(c => '<div style="color:#0ff;">‚úì ' + c + '</div>').join('');
  if(battleState.captured.length >= 5) {
    list.innerHTML += '<div style="color:#ffd700;font-weight:bold;margin-top:5px;">üèÜ POK√âMON MASTER!</div>';
    document.getElementById('badge-count').textContent = Math.min(8, battleState.captured.length);
  }
  document.getElementById('badge-count').textContent = Math.min(8, Math.floor(battleState.captured.length / 1));
}

// Click on cosmic objects to trigger battles
document.addEventListener('click', (e) => {
  if(e.target.classList.contains('cosmic-object') && !battleState.active) {
    startBattle();
  }
});
</script>
<script>
        // Legacy code preserved but inactive - awaiting new purpose
        const classes = {
            warrior: { hp: 120, mp: 30, atk: 15, def: 10, crit: 5, spd: 8, skill: 'Heroic Strike', skillMult: 2.5 },
            mage: { hp: 70, mp: 100, atk: 8, def: 3, crit: 15, spd: 12, skill: 'Fireball', skillMult: 3.5 },
            rogue: { hp: 85, mp: 50, atk: 12, def: 5, crit: 25, spd: 18, skill: 'Backstab', skillMult: 4 }
        };
        const enemies = [
            { name: 'Wild Boar', sprite: 'üêó', hp: 30, atk: 5, xp: 20, gold: 5 },
            { name: 'Forest Wolf', sprite: 'üê∫', hp: 45, atk: 8, xp: 35, gold: 10 },
            { name: 'Goblin Scout', sprite: 'üë∫', hp: 60, atk: 12, xp: 50, gold: 20 },
            { name: 'Orc Warrior', sprite: 'üëπ', hp: 100, atk: 18, xp: 80, gold: 40 },
            { name: 'Dark Mage', sprite: 'üßô', hp: 70, atk: 25, xp: 100, gold: 60 },
            { name: 'Dragon Whelp', sprite: 'üêâ', hp: 150, atk: 30, xp: 150, gold: 100 },
            { name: 'Lich King', sprite: 'üíÄ', hp: 300, atk: 45, xp: 300, gold: 250 }
        ];
        
        let player = { class: 'warrior', level: 1, xp: 0, gold: 0, ...classes.warrior, maxHp: 120, maxMp: 30 };
        let enemy = { ...enemies[0], maxHp: enemies[0].hp };
        
        function selectClass(c) {
            document.querySelectorAll('.class-btn').forEach(b => b.classList.remove('selected'));
            document.querySelector(`[data-class="${c}"]`).classList.add('selected');
            player = { class: c, level: 1, xp: 0, gold: player.gold, ...classes[c], maxHp: classes[c].hp, maxMp: classes[c].mp };
            updateUI();
            addLog(`You are now a ${c.toUpperCase()}!`, 'log-level');
        }
        
        function updateUI() {
            if(!document.getElementById('level')) return; // Guard for missing legacy elements
            document.getElementById('level').textContent = player.level;
            document.getElementById('health-fill').style.width = (player.hp/player.maxHp*100)+'%';
            document.getElementById('health-text').textContent = `${Math.max(0,Math.floor(player.hp))}/${player.maxHp} HP`;
            document.getElementById('mana-fill').style.width = (player.mp/player.maxMp*100)+'%';
            document.getElementById('mana-text').textContent = `${Math.max(0,Math.floor(player.mp))}/${player.maxMp} MP`;
            document.getElementById('xp-fill').style.width = (player.xp/(player.level*100)*100)+'%';
            document.getElementById('xp-text').textContent = `${player.xp}/${player.level*100} XP`;
            document.getElementById('gold').textContent = player.gold;
            document.getElementById('atk').textContent = player.atk;
            document.getElementById('def').textContent = player.def;
            document.getElementById('crit').textContent = player.crit;
            document.getElementById('spd').textContent = player.spd;
            document.getElementById('enemy-sprite').textContent = enemy.sprite;
            document.getElementById('enemy-name').textContent = enemy.name;
            document.getElementById('enemy-health-fill').style.width = (enemy.hp/enemy.maxHp*100)+'%';
            document.getElementById('enemy-health-text').textContent = `${Math.max(0,Math.floor(enemy.hp))}/${enemy.maxHp} HP`;
        }
        
        function addLog(msg, cls='') { document.getElementById('log').innerHTML = `<div class="log-entry ${cls}">${msg}</div>` + document.getElementById('log').innerHTML; }
        
        function attack() {
            let dmg = player.atk + Math.floor(Math.random()*5);
            let crit = Math.random()*100 < player.crit;
            if(crit) dmg *= 2;
            enemy.hp -= dmg;
            document.getElementById('enemy-sprite').classList.add('shake');
            setTimeout(() => document.getElementById('enemy-sprite').classList.remove('shake'), 300);
            addLog(`You ${crit?'CRITICALLY ':''}hit ${enemy.name} for ${dmg} damage!`, 'log-damage');
            checkCombat();
        }
        
        function useSkill() {
            if(player.mp < 20) { addLog('Not enough mana!', 'log-damage'); return; }
            player.mp -= 20;
            let dmg = Math.floor(player.atk * classes[player.class].skillMult);
            enemy.hp -= dmg;
            document.getElementById('enemy-sprite').classList.add('shake');
            setTimeout(() => document.getElementById('enemy-sprite').classList.remove('shake'), 300);
            addLog(`${classes[player.class].skill}! ${dmg} damage to ${enemy.name}!`, 'log-damage');
            checkCombat();
        }
        
        function heal() {
            if(player.mp < 15) { addLog('Not enough mana!', 'log-damage'); return; }
            player.mp -= 15;
            let amt = 20 + player.level * 5;
            player.hp = Math.min(player.maxHp, player.hp + amt);
            addLog(`Healed for ${amt} HP!`, 'log-heal');
            updateUI();
        }
        
        function checkCombat() {
            if(enemy.hp <= 0) {
                addLog(`${enemy.name} defeated! +${enemy.xp} XP, +${enemy.gold} Gold`, 'log-xp');
                player.xp += enemy.xp;
                player.gold += enemy.gold;
                if(player.xp >= player.level * 100) levelUp();
                spawnEnemy();
            } else {
                enemyTurn();
            }
            updateUI();
        }
        
        function enemyTurn() {
            let dmg = Math.max(1, enemy.atk - player.def + Math.floor(Math.random()*5));
            player.hp -= dmg;
            addLog(`${enemy.name} hits you for ${dmg} damage!`, 'log-damage');
            if(player.hp <= 0) {
                addLog('YOU DIED! Respawning...', 'log-damage');
                player.hp = player.maxHp;
                player.mp = player.maxMp;
                player.gold = Math.floor(player.gold * 0.5);
            }
        }
        
        function levelUp() {
            player.xp -= player.level * 100;
            player.level++;
            player.maxHp += 10;
            player.maxMp += 5;
            player.hp = player.maxHp;
            player.mp = player.maxMp;
            player.atk += 2;
            player.def += 1;
            addLog(`LEVEL UP! You are now level ${player.level}!`, 'log-level');
        }
        
        function spawnEnemy() {
            let idx = Math.min(enemies.length-1, Math.floor(player.level/2) + Math.floor(Math.random()*2));
            let base = enemies[idx];
            let scale = 1 + (player.level-1)*0.15;
            enemy = { ...base, hp: Math.floor(base.hp*scale), maxHp: Math.floor(base.hp*scale), atk: Math.floor(base.atk*scale), xp: Math.floor(base.xp*scale), gold: Math.floor(base.gold*scale) };
            addLog(`A ${enemy.name} appears!`, '');
        }
        
        // Legacy UI update - only run if elements exist
        if(document.getElementById('level')) {
          updateUI();
          addLog('Welcome, Hero! Choose your class and begin your adventure!', 'log-level');
        }
        
        // 2D World Movement System (legacy - player-sprite no longer exists)
        let playerX = 280, playerY = 180;
        const playerSprite = document.getElementById('player-sprite');
        if(playerSprite) {
          playerSprite.style.left = playerX + 'px';
          playerSprite.style.top = playerY + 'px';
        }
        
        document.addEventListener('keydown', (e) => {
            const speed = 15;
            if(e.key === 'w' || e.key === 'ArrowUp') playerY = Math.max(40, playerY - speed);
            if(e.key === 's' || e.key === 'ArrowDown') playerY = Math.min(350, playerY + speed);
            if(e.key === 'a' || e.key === 'ArrowLeft') playerX = Math.max(10, playerX - speed);
            if(e.key === 'd' || e.key === 'ArrowRight') playerX = Math.min(550, playerX + speed);
            if(playerSprite) {
              playerSprite.style.left = playerX + 'px';
              playerSprite.style.top = playerY + 'px';
            }
            checkProximity();
        });
        
        function checkProximity() {
            document.querySelectorAll('.world-enemy').forEach(en => {
                const ex = parseInt(en.style.left), ey = parseInt(en.style.top);
                if(Math.abs(playerX - ex) < 50 && Math.abs(playerY - ey) < 50) {
                    en.style.filter = 'drop-shadow(0 0 15px red)';
                }
            });
        }
        
        document.querySelectorAll('.world-enemy').forEach(en => {
            en.addEventListener('click', () => attackWorldEnemy(en));
        });
        
        function attackWorldEnemy(en) {
            const ex = parseInt(en.style.left), ey = parseInt(en.style.top);
            if(Math.abs(playerX - ex) < 80 && Math.abs(playerY - ey) < 80) {
                const dl = document.getElementById('dagger-left');
                const dr = document.getElementById('dagger-right');
                dl.classList.add('attack-left');
                dr.classList.add('attack-right');
                setTimeout(() => { dl.classList.remove('attack-left'); dr.classList.remove('attack-right'); }, 200);
                
                let hp = parseInt(en.dataset.hp) || 30;
                let dmg = player.atk + Math.floor(Math.random() * 10);
                if(player.class === 'rogue') dmg = Math.floor(dmg * 1.5);
                hp -= dmg;
                en.dataset.hp = hp;
                addLog(`üó°Ô∏è Dual strike on ${en.dataset.name} for ${dmg} damage!`, 'log-damage');
                const enRect = en.getBoundingClientRect();
                spawnParticles(enRect.left + enRect.width/2, enRect.top + enRect.height/2, '#ffd700', 25);
                screenShake(6);
                en.classList.add('shake');
                setTimeout(() => en.classList.remove('shake'), 300);
                if(hp <= 0) {
                    addLog(`${en.dataset.name} defeated in the world! +25 XP, +15 Gold`, 'log-xp');
                    player.xp += 25; player.gold += 15;
                    if(player.xp >= player.level * 100) levelUp();
                    en.style.opacity = '0';
                    setTimeout(() => en.remove(), 500);
                    updateUI();
                }
            } else {
                addLog('Too far away! Move closer to attack.', '');
            }
        }
        
        function openChest(chest) {
            const cx = parseInt(chest.style.left), cy = parseInt(chest.style.top);
            if(Math.abs(playerX - cx) < 60 && Math.abs(playerY - cy) < 60) {
                const goldFound = 10 + Math.floor(Math.random() * 30);
                player.gold += goldFound;
                addLog(`üì¶ Opened chest! Found ${goldFound} gold!`, 'log-xp');
                chest.textContent = 'üì≠';
                chest.style.opacity = '0.5';
                chest.onclick = null;
                updateUI();
            } else {
                addLog('Move closer to open the chest!', '');
            }
        }
        
        // Auto-select rogue for the dual dagger experience - only if UI exists
        if(document.getElementById('level')) selectClass('rogue');
        
        // Epic Particle System - particles array declared early to prevent reference errors
        let particles = [];
        const particleCanvas = document.getElementById('particle-canvas');
        const pCtx = particleCanvas.getContext('2d');
        particleCanvas.width = window.innerWidth;
        particleCanvas.height = window.innerHeight;
        window.addEventListener('resize', () => { particleCanvas.width = window.innerWidth; particleCanvas.height = window.innerHeight; });
        class Particle {
            constructor(x, y, color, type) {
                this.x = x; this.y = y;
                this.color = color;
                this.type = type;
                this.vx = (Math.random() - 0.5) * 10;
                this.vy = (Math.random() - 0.5) * 10 - 3;
                this.life = 1;
                this.size = Math.random() * 8 + 4;
            }
            update() {
                this.x += this.vx;
                this.y += this.vy;
                this.vy += 0.2;
                this.life -= 0.02;
                this.size *= 0.98;
            }
            draw() {
                pCtx.globalAlpha = this.life;
                pCtx.fillStyle = this.color;
                if(this.type === 'spark') {
                    pCtx.beginPath();
                    pCtx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                    pCtx.fill();
                } else {
                    pCtx.font = this.size + 'px Arial';
                    pCtx.fillText('‚ú®', this.x, this.y);
                }
                pCtx.globalAlpha = 1;
            }
        }
        
        function spawnParticles(x, y, color, count=15) {
            for(let i = 0; i < count; i++) {
                particles.push(new Particle(x, y, color, Math.random() > 0.5 ? 'spark' : 'star'));
            }
        }
        
        function animateParticles() {
            pCtx.clearRect(0, 0, particleCanvas.width, particleCanvas.height);
            particles = particles.filter(p => p.life > 0);
            particles.forEach(p => { p.update(); p.draw(); });
            requestAnimationFrame(animateParticles);
        }
        animateParticles();
        
        // Screen shake effect
        function screenShake(intensity = 5) {
            const world = document.getElementById('game-world');
            let shakes = 6;
            const interval = setInterval(() => {
                if(shakes <= 0) { world.style.transform = 'translate(0, 0)'; clearInterval(interval); return; }
                const x = (Math.random() - 0.5) * intensity;
                const y = (Math.random() - 0.5) * intensity;
                world.style.transform = `translate(${x}px, ${y}px)`;
                shakes--;
            }, 30);
        }
        
        // Override attack to add particles
        const originalAttack = attack;
        attack = function() {
            originalAttack();
            const enemyEl = document.getElementById('enemy-sprite');
            const rect = enemyEl.getBoundingClientRect();
            spawnParticles(rect.left + rect.width/2, rect.top + rect.height/2, '#ff4444', 20);
            screenShake(8);
        };
        
        // Full screen world panel toggle
        let panelsVisible = true;
        function togglePanels() {
            panelsVisible = !panelsVisible;
            document.getElementById('panels-overlay').style.display = panelsVisible ? 'flex' : 'none';
        }
        
        // Expand movement bounds for full screen
        document.addEventListener('keydown', (e) => {
            const speed = 15;
            const maxX = window.innerWidth - 50;
            const maxY = window.innerHeight - 50;
            if(e.key === 'w' || e.key === 'ArrowUp') playerY = Math.max(40, playerY - speed);
            if(e.key === 's' || e.key === 'ArrowDown') playerY = Math.min(maxY, playerY + speed);
            if(e.key === 'a' || e.key === 'ArrowLeft') playerX = Math.max(10, playerX - speed);
            if(e.key === 'd' || e.key === 'ArrowRight') playerX = Math.min(maxX, playerX + speed);
            if(playerSprite) {
              playerSprite.style.left = playerX + 'px';
              playerSprite.style.top = playerY + 'px';
            }
            checkProximity();
        });
        
        // Re-bind world enemies for the new fullscreen world
        document.querySelectorAll('.world-enemy').forEach(en => {
            en.addEventListener('click', () => attackWorldEnemy(en));
        });
    </script>
</body>
</html>