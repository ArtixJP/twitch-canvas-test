<!DOCTYPE html>

<html lang="en">
<head>
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' https:; script-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com https://cdn.jsdelivr.net https://unpkg.com https://esm.sh https://esm.run https://cdn.tailwindcss.com https://threejs.org https://cdn.threejs.org https://cdn.p5js.org https://code.jquery.com https://d3js.org https://cdn.plot.ly https://cdn.tonejs.org; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://fonts.gstatic.com https://cdnjs.cloudflare.com https://cdn.jsdelivr.net; img-src 'self' data: https:; media-src 'self' https:; font-src 'self' https://fonts.gstatic.com https://fonts.googleapis.com https://cdnjs.cloudflare.com https://cdn.jsdelivr.net; worker-src 'self'; frame-src https://www.youtube.com https://www.youtube-nocookie.com https://player.vimeo.com; connect-src 'self' https: wss: ws:; object-src 'none'; base-uri 'self'; form-action 'self';">
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Twitch World Builder</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.min.js"></script>
<style>
        body { 
            font-family: system-ui, sans-serif; 
            margin: 0;
            padding: 0;
            overflow: hidden;
            background: #1a1a2e;
            color: white;
        }
        h1 { 
            font-size: 2rem; 
            text-align: center; 
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 100;
            text-shadow: 0 0 10px #9b59b6, 0 0 20px #9b59b6;
            margin: 0;
            pointer-events: none;
        }
        #game-container {
            position: relative;
            width: 100vw;
            height: 100vh;
        }
        canvas {
            display: block;
        }
        #object-count {
            position: absolute;
            bottom: 10px;
            left: 10px;
            font-size: 0.9rem;
            opacity: 0.7;
            z-index: 100;
        }
    </style>
</head>
<body>
<div id="game-container">
<h1>ðŸŽ® Twitch World Builder ðŸŽ®</h1>
<div id="object-count">Objects: 0 | Chat to add more!</div>
</div>
<script>
        // Game World State
        let gameObjects = [];
        let groundLevel;
        let stars = [];
        
        function setup() {
            let canvas = createCanvas(windowWidth, windowHeight);
            canvas.parent('game-container');
            groundLevel = height - 80;
            
            // Add a flying fish to the world!
            addGameObject(new FlyingFish());
            
            // Add a shark prowling below!
            addGameObject(new Shark());
            
            // Create starry sky
            for (let i = 0; i < 100; i++) {
                stars.push({
                    x: random(width),
                    y: random(groundLevel - 50),
                    size: random(1, 3),
                    twinkle: random(TWO_PI)
                });
            }
        }
        
        function draw() {
            // Sky gradient
            for (let y = 0; y < groundLevel; y++) {
                let inter = map(y, 0, groundLevel, 0, 1);
                let c = lerpColor(color(26, 26, 46), color(22, 33, 62), inter);
                stroke(c);
                line(0, y, width, y);
            }
            
            // Twinkling stars
            noStroke();
            for (let star of stars) {
                let alpha = map(sin(frameCount * 0.05 + star.twinkle), -1, 1, 100, 255);
                fill(255, 255, 255, alpha);
                ellipse(star.x, star.y, star.size);
            }
            
            // Ground
            fill(34, 139, 34);
            rect(0, groundLevel, width, height - groundLevel);
            
            // Grass details
            stroke(50, 205, 50);
            strokeWeight(2);
            for (let x = 0; x < width; x += 15) {
                let grassHeight = 5 + sin(x * 0.1 + frameCount * 0.02) * 3;
                line(x, groundLevel, x + 3, groundLevel - grassHeight);
            }
            
            // Draw all game objects
            for (let obj of gameObjects) {
                if (obj.draw) obj.draw();
            }
            
            // Update object count
            document.getElementById('object-count').textContent = 
                `Objects: ${gameObjects.length} | Chat to add more!`;
        }
        
        function windowResized() {
            resizeCanvas(windowWidth, windowHeight);
            groundLevel = height - 80;
        }
        
        // Helper function to add objects (will be used by future requests)
        function addGameObject(obj) {
            gameObjects.push(obj);
        }
        
        // Flying Fish class
        class FlyingFish {
            constructor() {
                this.x = random(width);
                this.y = random(100, groundLevel - 150);
                this.vx = random(-2, 2);
                this.vy = 0;
                this.size = random(30, 50);
                this.color = color(random(100, 200), random(150, 255), 255);
                this.finAngle = 0;
                this.wobble = random(TWO_PI);
            }
            
            draw() {
                this.finAngle = sin(frameCount * 0.3 + this.wobble) * 0.5;
                this.y += sin(frameCount * 0.05 + this.wobble) * 0.5;
                this.x += this.vx;
                
                // Wrap around screen
                if (this.x > width + 50) this.x = -50;
                if (this.x < -50) this.x = width + 50;
                
                push();
                translate(this.x, this.y);
                if (this.vx < 0) scale(-1, 1);
                
                // Body
                fill(this.color);
                noStroke();
                ellipse(0, 0, this.size, this.size * 0.5);
                
                // Tail
                fill(this.color);
                triangle(
                    -this.size * 0.4, 0,
                    -this.size * 0.7, -this.size * 0.2,
                    -this.size * 0.7, this.size * 0.2
                );
                
                // Flying fins (wings)
                push();
                rotate(this.finAngle);
                fill(this.color.levels[0], this.color.levels[1], 255, 180);
                ellipse(0, -this.size * 0.2, this.size * 0.8, this.size * 0.3);
                pop();
                
                push();
                rotate(-this.finAngle);
                fill(this.color.levels[0], this.color.levels[1], 255, 180);
                ellipse(0, this.size * 0.2, this.size * 0.6, this.size * 0.2);
                pop();
                
                // Eye
                fill(255);
                ellipse(this.size * 0.2, -this.size * 0.05, this.size * 0.15);
                fill(0);
                ellipse(this.size * 0.22, -this.size * 0.05, this.size * 0.08);
                
                // Sparkle trail
                for (let i = 1; i <= 3; i++) {
                    let sparkleAlpha = map(i, 1, 3, 150, 50);
                    fill(255, 255, 255, sparkleAlpha);
                    ellipse(-this.size * 0.3 * i, sin(frameCount * 0.2 + i) * 5, 4 - i);
                }
                
                pop();
            }
        }
        
        // Flying fish will be added in setup after p5.js initializes
        
        // Shark class - the apex predator!
        class Shark {
            constructor() {
                this.x = random(width);
                this.y = groundLevel - random(20, 50);
                this.vx = random(1, 2) * (random() > 0.5 ? 1 : -1);
                this.size = random(60, 90);
                this.tailAngle = 0;
                this.jawOpen = 0;
            }
            
            draw() {
                this.tailAngle = sin(frameCount * 0.15) * 0.3;
                this.jawOpen = abs(sin(frameCount * 0.05)) * 0.1;
                this.x += this.vx;
                
                // Wrap around screen
                if (this.x > width + 100) this.x = -100;
                if (this.x < -100) this.x = width + 100;
                
                push();
                translate(this.x, this.y);
                if (this.vx < 0) scale(-1, 1);
                
                // Tail
                push();
                translate(-this.size * 0.5, 0);
                rotate(this.tailAngle);
                fill(70, 80, 90);
                noStroke();
                triangle(
                    0, 0,
                    -this.size * 0.4, -this.size * 0.25,
                    -this.size * 0.4, this.size * 0.25
                );
                pop();
                
                // Body
                fill(85, 95, 110);
                noStroke();
                ellipse(0, 0, this.size, this.size * 0.4);
                
                // Dorsal fin
                fill(70, 80, 90);
                triangle(
                    -this.size * 0.1, -this.size * 0.2,
                    this.size * 0.1, -this.size * 0.2,
                    0, -this.size * 0.45
                );
                
                // Belly
                fill(180, 180, 190);
                ellipse(0, this.size * 0.1, this.size * 0.7, this.size * 0.15);
                
                // Jaw (animated)
                push();
                translate(this.size * 0.35, this.size * 0.05);
                rotate(this.jawOpen);
                fill(60, 20, 30);
                arc(0, 0, this.size * 0.3, this.size * 0.15, 0, PI);
                // Teeth
                fill(255);
                for (let i = 0; i < 5; i++) {
                    let tx = map(i, 0, 4, -this.size * 0.12, this.size * 0.12);
                    triangle(tx, 0, tx - 2, 6, tx + 2, 6);
                }
                pop();
                
                // Eye
                fill(0);
                ellipse(this.size * 0.25, -this.size * 0.05, this.size * 0.08);
                fill(255, 50);
                ellipse(this.size * 0.26, -this.size * 0.06, this.size * 0.03);
                
                // Gills
                stroke(60, 70, 80);
                strokeWeight(2);
                for (let i = 0; i < 3; i++) {
                    let gx = this.size * 0.1 + i * 5;
                    line(gx, -this.size * 0.08, gx, this.size * 0.08);
                }
                
                pop();
            }
        }
    </script>
</body>
</html>