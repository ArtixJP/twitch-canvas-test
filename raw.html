<!DOCTYPE html>

<html lang="en">
<head>
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' https:; script-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com https://cdn.jsdelivr.net https://unpkg.com https://esm.sh https://esm.run https://cdn.tailwindcss.com https://threejs.org https://cdn.threejs.org https://cdn.p5js.org https://code.jquery.com https://d3js.org https://cdn.plot.ly https://cdn.tonejs.org; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://fonts.gstatic.com https://cdnjs.cloudflare.com https://cdn.jsdelivr.net; img-src 'self' data: https:; media-src 'self' https:; font-src 'self' https://fonts.gstatic.com https://fonts.googleapis.com https://cdnjs.cloudflare.com https://cdn.jsdelivr.net; worker-src 'self'; frame-src https://www.youtube.com https://www.youtube-nocookie.com https://player.vimeo.com; connect-src 'self' https: wss: ws:; object-src 'none'; base-uri 'self'; form-action 'self';">
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>WoW RPG Simulator - Twitch Versus Code</title>
<style>
        * { box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', system-ui, sans-serif; 
            display: flex; 
            flex-direction: column;
            justify-content: flex-start; 
            align-items: center; 
            min-height: 100vh; 
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #0d0d1a 0%, #1a0a2e 50%, #0a1628 100%);
            color: #f0e6d3;
            overflow: hidden;
        }
        h1 { font-size: 2.5rem; text-align: center; text-shadow: 0 0 20px #ffd700, 0 0 40px #ff8c00; margin-bottom: 10px; }
        .subtitle { color: #ffd700; font-size: 1rem; margin-bottom: 20px; }
        .game-container { display: flex; gap: 20px; flex-wrap: wrap; justify-content: center; width: 100%; max-width: 1200px; position: relative; z-index: 10; }
        .panels-overlay { position: fixed; top: 10px; right: 10px; z-index: 100; display: flex; gap: 10px; flex-direction: column; max-height: 90vh; overflow-y: auto; }
        .panels-overlay .panel { opacity: 0.95; transform: scale(0.9); transform-origin: top right; }
        .toggle-panels-btn { position: fixed; top: 60px; left: 10px; z-index: 200; padding: 10px 20px; background: linear-gradient(180deg, #3a2a1a, #2a1a0a); border: 2px solid #ffd700; color: #ffd700; cursor: pointer; border-radius: 5px; font-weight: bold; }
        .fullscreen-indicator { position: fixed; bottom: 10px; left: 10px; z-index: 200; background: rgba(0,0,0,0.7); padding: 5px 10px; border-radius: 5px; font-size: 12px; color: #4a4; }
        @keyframes pulse-glow { 0%, 100% { box-shadow: 0 0 10px #ffd700; } 50% { box-shadow: 0 0 30px #ffd700, 0 0 50px #ff8c00; } }
        .world-enemy { animation: enemyFloat 2s infinite, pulse-glow 3s infinite; }
        .player-char { animation: pulse-glow 2s infinite; }
        .panel { background: linear-gradient(180deg, rgba(40,30,50,0.95) 0%, rgba(20,15,30,0.98) 100%); border: 2px solid #5a4a3a; border-radius: 8px; padding: 15px; box-shadow: 0 0 20px rgba(255,165,0,0.2), inset 0 0 30px rgba(0,0,0,0.5); }
        .character-panel { width: 280px; }
        .combat-panel { width: 500px; min-height: 350px; display: none; }
        .log-panel { width: 350px; height: 350px; overflow-y: auto; }
        .stat-bar { height: 20px; border-radius: 10px; margin: 5px 0; position: relative; overflow: hidden; }
        .health-bar { background: linear-gradient(90deg, #8b0000, #ff0000); box-shadow: 0 0 10px #ff0000; }
        .mana-bar { background: linear-gradient(90deg, #00008b, #4169e1); box-shadow: 0 0 10px #4169e1; }
        .xp-bar { background: linear-gradient(90deg, #4b0082, #9932cc); box-shadow: 0 0 10px #9932cc; }
        .bar-fill { height: 100%; transition: width 0.3s; border-radius: 10px; }
        .bar-text { position: absolute; width: 100%; text-align: center; font-size: 12px; line-height: 20px; text-shadow: 1px 1px 2px black; }
        .class-select { display: flex; gap: 10px; margin: 15px 0; flex-wrap: wrap; justify-content: center; }
        .class-btn { padding: 10px 15px; border: 2px solid #5a4a3a; background: linear-gradient(180deg, #3a2a1a, #2a1a0a); color: #ffd700; cursor: pointer; border-radius: 5px; transition: all 0.3s; font-weight: bold; }
        .class-btn:hover { border-color: #ffd700; box-shadow: 0 0 15px rgba(255,215,0,0.5); transform: scale(1.05); }
        .class-btn.selected { border-color: #ffd700; background: linear-gradient(180deg, #5a4a2a, #3a2a1a); }
        .enemy-display { text-align: center; padding: 20px; display: none; }
        .enemy-sprite { font-size: 80px; animation: enemyBounce 1s infinite; display: none; }
        @keyframes enemyBounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        .action-buttons { display: flex; gap: 10px; flex-wrap: wrap; justify-content: center; margin-top: 15px; }
        .action-btn { padding: 12px 20px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; transition: all 0.2s; text-transform: uppercase; }
        .attack-btn { background: linear-gradient(180deg, #8b0000, #5a0000); color: white; border: 2px solid #ff4444; }
        .skill-btn { background: linear-gradient(180deg, #00008b, #000050); color: white; border: 2px solid #4444ff; }
        .heal-btn { background: linear-gradient(180deg, #006400, #003200); color: white; border: 2px solid #44ff44; }
        .action-btn:hover { transform: scale(1.1); box-shadow: 0 0 20px currentColor; }
        .action-btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
        .log-entry { padding: 5px; border-bottom: 1px solid #3a3a3a; font-size: 13px; }
        .log-damage { color: #ff6b6b; }
        .log-heal { color: #6bff6b; }
        .log-xp { color: #d4a5ff; }
        .log-level { color: #ffd700; font-weight: bold; }
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 5px; font-size: 14px; margin: 10px 0; }
        .stat-item { background: rgba(0,0,0,0.3); padding: 5px; border-radius: 3px; }
        .gold-display { color: #ffd700; font-size: 18px; text-align: center; margin: 10px 0; }
        .world-panel { width: 100vw; height: 100vh; position: fixed; top: 0; left: 0; overflow: hidden; background: linear-gradient(180deg, #1a3a1a 0%, #0d2a0d 100%); border: none; z-index: 1; image-rendering: pixelated; perspective: 800px; transform-style: preserve-3d; }
        .world-floor { transform: rotateX(60deg) translateZ(-100px) scale(2.5); transform-origin: center center; background-image: repeating-linear-gradient(90deg, transparent, transparent 40px, rgba(0,80,0,0.3) 40px, rgba(0,80,0,0.3) 42px), repeating-linear-gradient(0deg, transparent, transparent 40px, rgba(0,80,0,0.3) 40px, rgba(0,80,0,0.3) 42px); }
        .world-3d-horizon { position: absolute; top: 0; left: 0; width: 100%; height: 40%; background: linear-gradient(180deg, #1a0a2e 0%, #2a1a4e 30%, #3a5a3a 70%, #1a4a1a 100%); z-index: 0; }
        .world-3d-mountains { position: absolute; top: 15%; left: 0; width: 100%; height: 25%; z-index: 1; font-size: 80px; letter-spacing: -20px; opacity: 0.6; filter: blur(2px); color: #2a3a2a; }
        .world-panel.minimized { width: 100%; max-width: 600px; height: 400px; position: relative; border: 3px solid #5a4a3a; }
        .world-floor { position: absolute; width: 100%; height: 100%; background-image: repeating-linear-gradient(90deg, transparent, transparent 40px, rgba(80,0,80,0.15) 40px, rgba(80,0,80,0.15) 41px), repeating-linear-gradient(0deg, transparent, transparent 40px, rgba(80,0,80,0.15) 40px, rgba(80,0,80,0.15) 41px); background-color: #0a0a1a; }
        @keyframes voidPulse { 0%, 100% { opacity: 0.7; } 50% { opacity: 0.9; } }
        .world-tree { position: absolute; font-size: 50px; z-index: 2; pointer-events: none; filter: drop-shadow(3px 6px 8px rgba(0,0,0,0.7)); transform: perspective(500px) rotateX(-5deg); }
        .world-rock { position: absolute; font-size: 35px; z-index: 2; pointer-events: none; opacity: 0.8; }
        .player-char { position: absolute; font-size: 40px; transition: left 0.15s, top 0.15s; z-index: 10; filter: drop-shadow(0 0 5px #ffd700) drop-shadow(2px 4px 6px rgba(0,0,0,0.5)); cursor: pointer; transform: perspective(500px) rotateX(-10deg); }
        .world-enemy { position: absolute; font-size: 35px; cursor: pointer; animation: enemyFloat 2s infinite; z-index: 5; filter: drop-shadow(2px 4px 6px rgba(0,0,0,0.6)); transform: perspective(500px) rotateX(-10deg); }
        .world-chest { position: absolute; font-size: 30px; cursor: pointer; z-index: 5; }
        .world-chest:hover, .world-enemy:hover { transform: scale(1.2); filter: drop-shadow(0 0 10px gold); }
        @keyframes enemyFloat { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }
        .daggers { position: absolute; font-size: 20px; opacity: 0; transition: all 0.2s; }
        .daggers.attack-left { opacity: 1; transform: translateX(-30px) rotate(-45deg); }
        .daggers.attack-right { opacity: 1; transform: translateX(30px) rotate(45deg); }
        .world-controls { text-align: center; margin-top: 10px; font-size: 12px; color: #aaa; }
        .level-display { font-size: 24px; color: #ffd700; text-align: center; }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }
        .shake { animation: shake 0.3s; }
        @keyframes glow { 0%, 100% { filter: brightness(1); } 50% { filter: brightness(1.5); } }
        .glow { animation: glow 0.5s; }
    </style>
</head>
<body>
<h1 style="position:fixed;top:10px;left:50%;transform:translateX(-50%);z-index:150;background:linear-gradient(180deg, rgba(20,0,40,0.95), rgba(10,0,20,0.95));padding:8px 25px;border-radius:5px;font-size:1.5rem;margin:0;border:2px solid #6a14a8;box-shadow:0 0 20px rgba(150,0,255,0.4),inset 0 0 10px rgba(200,100,255,0.2);animation:titleGlow 3s infinite;">ğŸŒ‘ Void World of Warcraft 3D ğŸŒ‘</h1>
<style>@keyframes titleGlow { 0%, 100% { box-shadow: 0 0 20px rgba(150,0,255,0.4); } 50% { box-shadow: 0 0 40px rgba(200,0,255,0.6); } }</style>
<button class="toggle-panels-btn" onclick="togglePanels()">ğŸ“Š Toggle Panels</button>
<div class="panel world-panel" id="game-world">
<h3 style="text-align:center;color:#4a4;margin:5px 0;position:absolute;top:10px;left:50%;transform:translateX(-50%);z-index:20;background:rgba(0,0,0,0.7);padding:5px 15px;border-radius:5px;">ğŸ—ºï¸ Explore the World</h3>
<div class="world-3d-horizon" style="background: linear-gradient(180deg, #000000 0%, #0a0015 30%, #150020 70%, #0d001a 100%);"></div>
<div class="void-effect" style="position:absolute;top:0;left:0;width:100%;height:100%;background:radial-gradient(ellipse at center, transparent 30%, rgba(0,0,0,0.7) 100%);pointer-events:none;z-index:3;animation:voidPulse 4s infinite;"></div>
<div class="world-3d-mountains" style="opacity:0.3;filter:blur(4px);color:#1a0030;">ğŸ”ï¸ğŸ—»ğŸ”ï¸ğŸ—»ğŸ”ï¸ğŸ—»ğŸ”ï¸ğŸ—»ğŸ”ï¸ğŸ—»ğŸ”ï¸ğŸ—»ğŸ”ï¸ğŸ—»ğŸ”ï¸</div>
<div class="world-floor"></div>
<div class="world-tree" style="left:50px;top:200px;font-size:60px;">ğŸŒ²</div>
<div class="world-tree" style="left:150px;top:120px;font-size:40px;opacity:0.7;">ğŸŒ²</div>
<div class="world-tree" style="left:1100px;top:150px;font-size:45px;opacity:0.8;">ğŸŒ³</div>
<div class="world-tree" style="left:600px;top:100px;">ğŸŒ³</div>
<div class="world-tree" style="left:900px;top:350px;">ğŸŒ²</div>
<div class="world-tree" style="left:300px;top:450px;">ğŸŒ³</div>
<div class="world-rock" style="left:450px;top:500px;">ğŸª¨</div>
<div class="world-rock" style="left:750px;top:150px;">ğŸª¨</div>
<div class="player-char" id="player-sprite">ğŸ—¡ï¸<span class="daggers" id="dagger-left">ğŸ—¡ï¸</span><span class="daggers" id="dagger-right">ğŸ—¡ï¸</span></div>
<div class="world-enemy" data-hp="30" data-name="Goblin" id="world-enemy-1" style="left:400px;top:150px;">ğŸ‘º</div>
<div class="world-enemy" data-hp="45" data-name="Wolf" id="world-enemy-2" style="left:200px;top:280px;">ğŸº</div>
<div class="world-enemy" data-hp="60" data-name="Orc" id="world-enemy-3" style="left:700px;top:400px;">ğŸ‘¹</div>
<div class="world-enemy" data-hp="40" data-name="Spider" id="world-enemy-4" style="left:150px;top:500px;">ğŸ•·ï¸</div>
<div class="world-chest" id="chest-1" onclick="openChest(this)" style="left:500px;top:300px;">ğŸ“¦</div>
<div class="world-chest" id="chest-2" onclick="openChest(this)" style="left:100px;top:100px;">ğŸ“¦</div>
<div class="world-chest" id="chest-3" onclick="openChest(this)" style="left:800px;top:200px;">ğŸ“¦</div>
<div class="world-controls" style="position:absolute;bottom:10px;left:50%;transform:translateX(-50%);background:rgba(0,0,0,0.7);padding:5px 15px;border-radius:5px;">Use WASD or Arrow Keys to move â€¢ Click enemies to attack</div>
<div class="fullscreen-indicator" style="color:#a0a;border:1px solid #606;">ğŸŒ‘ Void Realm - All Persists in Shadow ğŸŒ‘</div>
</div>
<div class="panels-overlay" id="panels-overlay">
<div class="game-container">
<div class="panel character-panel">
<h3 style="text-align:center;color:#ffd700;margin:0 0 10px 0;">ğŸ›¡ï¸ Your Hero</h3>
<div class="level-display">Level <span id="level">1</span></div>
<div class="class-select">
<button class="class-btn selected" data-class="warrior" onclick="selectClass('warrior')">âš”ï¸ Warrior</button>
<button class="class-btn" data-class="mage" onclick="selectClass('mage')">ğŸ”® Mage</button>
<button class="class-btn" data-class="rogue" onclick="selectClass('rogue')">ğŸ—¡ï¸ Rogue</button>
</div>
<div class="stat-bar health-bar"><div class="bar-fill" id="health-fill" style="width:100%;background:#22aa22;"></div><span class="bar-text" id="health-text">100/100 HP</span></div>
<div class="stat-bar mana-bar"><div class="bar-fill" id="mana-fill" style="width:100%;background:#2266dd;"></div><span class="bar-text" id="mana-text">50/50 MP</span></div>
<div class="stat-bar xp-bar"><div class="bar-fill" id="xp-fill" style="width:0%;background:#9932cc;"></div><span class="bar-text" id="xp-text">0/100 XP</span></div>
<div class="gold-display">ğŸ’° <span id="gold">0</span> Gold</div>
<div class="stats-grid">
<div class="stat-item">âš”ï¸ ATK: <span id="atk">10</span></div>
<div class="stat-item">ğŸ›¡ï¸ DEF: <span id="def">5</span></div>
<div class="stat-item">âœ¨ CRIT: <span id="crit">5</span>%</div>
<div class="stat-item">ğŸ’¨ SPD: <span id="spd">10</span></div>
</div>
</div>
<div class="panel" style="width:280px;text-align:center;">
<h3 style="color:#4a4;margin:0 0 10px 0;">ğŸŒ World Actions</h3>
<p style="font-size:13px;color:#aaa;">Click enemies in the world to attack them!</p>
<button class="action-btn heal-btn" onclick="heal()" style="margin-top:10px;">ğŸ’š Heal (15 MP)</button>
<p style="font-size:11px;color:#666;margin-top:10px;">Explore the map and defeat monsters!</p>
</div>
</div>
</div>
<div class="panel log-panel" style="max-height:200px;">
<h3 style="text-align:center;color:#aaa;margin:0 0 10px 0;">ğŸ“œ Battle Log</h3>
<div id="log"></div>
</div>
<canvas id="particle-canvas" style="position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:1000;"></canvas>
<script>
        const classes = {
            warrior: { hp: 120, mp: 30, atk: 15, def: 10, crit: 5, spd: 8, skill: 'Heroic Strike', skillMult: 2.5 },
            mage: { hp: 70, mp: 100, atk: 8, def: 3, crit: 15, spd: 12, skill: 'Fireball', skillMult: 3.5 },
            rogue: { hp: 85, mp: 50, atk: 12, def: 5, crit: 25, spd: 18, skill: 'Backstab', skillMult: 4 }
        };
        const enemies = [
            { name: 'Wild Boar', sprite: 'ğŸ—', hp: 30, atk: 5, xp: 20, gold: 5 },
            { name: 'Forest Wolf', sprite: 'ğŸº', hp: 45, atk: 8, xp: 35, gold: 10 },
            { name: 'Goblin Scout', sprite: 'ğŸ‘º', hp: 60, atk: 12, xp: 50, gold: 20 },
            { name: 'Orc Warrior', sprite: 'ğŸ‘¹', hp: 100, atk: 18, xp: 80, gold: 40 },
            { name: 'Dark Mage', sprite: 'ğŸ§™', hp: 70, atk: 25, xp: 100, gold: 60 },
            { name: 'Dragon Whelp', sprite: 'ğŸ‰', hp: 150, atk: 30, xp: 150, gold: 100 },
            { name: 'Lich King', sprite: 'ğŸ’€', hp: 300, atk: 45, xp: 300, gold: 250 }
        ];
        
        let player = { class: 'warrior', level: 1, xp: 0, gold: 0, ...classes.warrior, maxHp: 120, maxMp: 30 };
        let enemy = { ...enemies[0], maxHp: enemies[0].hp };
        
        function selectClass(c) {
            document.querySelectorAll('.class-btn').forEach(b => b.classList.remove('selected'));
            document.querySelector(`[data-class="${c}"]`).classList.add('selected');
            player = { class: c, level: 1, xp: 0, gold: player.gold, ...classes[c], maxHp: classes[c].hp, maxMp: classes[c].mp };
            updateUI();
            addLog(`You are now a ${c.toUpperCase()}!`, 'log-level');
        }
        
        function updateUI() {
            document.getElementById('level').textContent = player.level;
            document.getElementById('health-fill').style.width = (player.hp/player.maxHp*100)+'%';
            document.getElementById('health-text').textContent = `${Math.max(0,Math.floor(player.hp))}/${player.maxHp} HP`;
            document.getElementById('mana-fill').style.width = (player.mp/player.maxMp*100)+'%';
            document.getElementById('mana-text').textContent = `${Math.max(0,Math.floor(player.mp))}/${player.maxMp} MP`;
            document.getElementById('xp-fill').style.width = (player.xp/(player.level*100)*100)+'%';
            document.getElementById('xp-text').textContent = `${player.xp}/${player.level*100} XP`;
            document.getElementById('gold').textContent = player.gold;
            document.getElementById('atk').textContent = player.atk;
            document.getElementById('def').textContent = player.def;
            document.getElementById('crit').textContent = player.crit;
            document.getElementById('spd').textContent = player.spd;
            document.getElementById('enemy-sprite').textContent = enemy.sprite;
            document.getElementById('enemy-name').textContent = enemy.name;
            document.getElementById('enemy-health-fill').style.width = (enemy.hp/enemy.maxHp*100)+'%';
            document.getElementById('enemy-health-text').textContent = `${Math.max(0,Math.floor(enemy.hp))}/${enemy.maxHp} HP`;
        }
        
        function addLog(msg, cls='') { document.getElementById('log').innerHTML = `<div class="log-entry ${cls}">${msg}</div>` + document.getElementById('log').innerHTML; }
        
        function attack() {
            let dmg = player.atk + Math.floor(Math.random()*5);
            let crit = Math.random()*100 < player.crit;
            if(crit) dmg *= 2;
            enemy.hp -= dmg;
            document.getElementById('enemy-sprite').classList.add('shake');
            setTimeout(() => document.getElementById('enemy-sprite').classList.remove('shake'), 300);
            addLog(`You ${crit?'CRITICALLY ':''}hit ${enemy.name} for ${dmg} damage!`, 'log-damage');
            checkCombat();
        }
        
        function useSkill() {
            if(player.mp < 20) { addLog('Not enough mana!', 'log-damage'); return; }
            player.mp -= 20;
            let dmg = Math.floor(player.atk * classes[player.class].skillMult);
            enemy.hp -= dmg;
            document.getElementById('enemy-sprite').classList.add('shake');
            setTimeout(() => document.getElementById('enemy-sprite').classList.remove('shake'), 300);
            addLog(`${classes[player.class].skill}! ${dmg} damage to ${enemy.name}!`, 'log-damage');
            checkCombat();
        }
        
        function heal() {
            if(player.mp < 15) { addLog('Not enough mana!', 'log-damage'); return; }
            player.mp -= 15;
            let amt = 20 + player.level * 5;
            player.hp = Math.min(player.maxHp, player.hp + amt);
            addLog(`Healed for ${amt} HP!`, 'log-heal');
            updateUI();
        }
        
        function checkCombat() {
            if(enemy.hp <= 0) {
                addLog(`${enemy.name} defeated! +${enemy.xp} XP, +${enemy.gold} Gold`, 'log-xp');
                player.xp += enemy.xp;
                player.gold += enemy.gold;
                if(player.xp >= player.level * 100) levelUp();
                spawnEnemy();
            } else {
                enemyTurn();
            }
            updateUI();
        }
        
        function enemyTurn() {
            let dmg = Math.max(1, enemy.atk - player.def + Math.floor(Math.random()*5));
            player.hp -= dmg;
            addLog(`${enemy.name} hits you for ${dmg} damage!`, 'log-damage');
            if(player.hp <= 0) {
                addLog('YOU DIED! Respawning...', 'log-damage');
                player.hp = player.maxHp;
                player.mp = player.maxMp;
                player.gold = Math.floor(player.gold * 0.5);
            }
        }
        
        function levelUp() {
            player.xp -= player.level * 100;
            player.level++;
            player.maxHp += 10;
            player.maxMp += 5;
            player.hp = player.maxHp;
            player.mp = player.maxMp;
            player.atk += 2;
            player.def += 1;
            addLog(`LEVEL UP! You are now level ${player.level}!`, 'log-level');
        }
        
        function spawnEnemy() {
            let idx = Math.min(enemies.length-1, Math.floor(player.level/2) + Math.floor(Math.random()*2));
            let base = enemies[idx];
            let scale = 1 + (player.level-1)*0.15;
            enemy = { ...base, hp: Math.floor(base.hp*scale), maxHp: Math.floor(base.hp*scale), atk: Math.floor(base.atk*scale), xp: Math.floor(base.xp*scale), gold: Math.floor(base.gold*scale) };
            addLog(`A ${enemy.name} appears!`, '');
        }
        
        updateUI();
        addLog('Welcome, Hero! Choose your class and begin your adventure!', 'log-level');
        
        // 2D World Movement System
        let playerX = 280, playerY = 180;
        const playerSprite = document.getElementById('player-sprite');
        playerSprite.style.left = playerX + 'px';
        playerSprite.style.top = playerY + 'px';
        
        document.addEventListener('keydown', (e) => {
            const speed = 15;
            if(e.key === 'w' || e.key === 'ArrowUp') playerY = Math.max(40, playerY - speed);
            if(e.key === 's' || e.key === 'ArrowDown') playerY = Math.min(350, playerY + speed);
            if(e.key === 'a' || e.key === 'ArrowLeft') playerX = Math.max(10, playerX - speed);
            if(e.key === 'd' || e.key === 'ArrowRight') playerX = Math.min(550, playerX + speed);
            playerSprite.style.left = playerX + 'px';
            playerSprite.style.top = playerY + 'px';
            checkProximity();
        });
        
        function checkProximity() {
            document.querySelectorAll('.world-enemy').forEach(en => {
                const ex = parseInt(en.style.left), ey = parseInt(en.style.top);
                if(Math.abs(playerX - ex) < 50 && Math.abs(playerY - ey) < 50) {
                    en.style.filter = 'drop-shadow(0 0 15px red)';
                }
            });
        }
        
        document.querySelectorAll('.world-enemy').forEach(en => {
            en.addEventListener('click', () => attackWorldEnemy(en));
        });
        
        function attackWorldEnemy(en) {
            const ex = parseInt(en.style.left), ey = parseInt(en.style.top);
            if(Math.abs(playerX - ex) < 80 && Math.abs(playerY - ey) < 80) {
                const dl = document.getElementById('dagger-left');
                const dr = document.getElementById('dagger-right');
                dl.classList.add('attack-left');
                dr.classList.add('attack-right');
                setTimeout(() => { dl.classList.remove('attack-left'); dr.classList.remove('attack-right'); }, 200);
                
                let hp = parseInt(en.dataset.hp) || 30;
                let dmg = player.atk + Math.floor(Math.random() * 10);
                if(player.class === 'rogue') dmg = Math.floor(dmg * 1.5);
                hp -= dmg;
                en.dataset.hp = hp;
                addLog(`ğŸ—¡ï¸ Dual strike on ${en.dataset.name} for ${dmg} damage!`, 'log-damage');
                const enRect = en.getBoundingClientRect();
                spawnParticles(enRect.left + enRect.width/2, enRect.top + enRect.height/2, '#ffd700', 25);
                screenShake(6);
                en.classList.add('shake');
                setTimeout(() => en.classList.remove('shake'), 300);
                if(hp <= 0) {
                    addLog(`${en.dataset.name} defeated in the world! +25 XP, +15 Gold`, 'log-xp');
                    player.xp += 25; player.gold += 15;
                    if(player.xp >= player.level * 100) levelUp();
                    en.style.opacity = '0';
                    setTimeout(() => en.remove(), 500);
                    updateUI();
                }
            } else {
                addLog('Too far away! Move closer to attack.', '');
            }
        }
        
        function openChest(chest) {
            const cx = parseInt(chest.style.left), cy = parseInt(chest.style.top);
            if(Math.abs(playerX - cx) < 60 && Math.abs(playerY - cy) < 60) {
                const goldFound = 10 + Math.floor(Math.random() * 30);
                player.gold += goldFound;
                addLog(`ğŸ“¦ Opened chest! Found ${goldFound} gold!`, 'log-xp');
                chest.textContent = 'ğŸ“­';
                chest.style.opacity = '0.5';
                chest.onclick = null;
                updateUI();
            } else {
                addLog('Move closer to open the chest!', '');
            }
        }
        
        // Auto-select rogue for the dual dagger experience
        selectClass('rogue');
        
        // Epic Particle System
        const particleCanvas = document.getElementById('particle-canvas');
        const pCtx = particleCanvas.getContext('2d');
        particleCanvas.width = window.innerWidth;
        particleCanvas.height = window.innerHeight;
        window.addEventListener('resize', () => { particleCanvas.width = window.innerWidth; particleCanvas.height = window.innerHeight; });
        
        let particles = [];
        class Particle {
            constructor(x, y, color, type) {
                this.x = x; this.y = y;
                this.color = color;
                this.type = type;
                this.vx = (Math.random() - 0.5) * 10;
                this.vy = (Math.random() - 0.5) * 10 - 3;
                this.life = 1;
                this.size = Math.random() * 8 + 4;
            }
            update() {
                this.x += this.vx;
                this.y += this.vy;
                this.vy += 0.2;
                this.life -= 0.02;
                this.size *= 0.98;
            }
            draw() {
                pCtx.globalAlpha = this.life;
                pCtx.fillStyle = this.color;
                if(this.type === 'spark') {
                    pCtx.beginPath();
                    pCtx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                    pCtx.fill();
                } else {
                    pCtx.font = this.size + 'px Arial';
                    pCtx.fillText('âœ¨', this.x, this.y);
                }
                pCtx.globalAlpha = 1;
            }
        }
        
        function spawnParticles(x, y, color, count=15) {
            for(let i = 0; i < count; i++) {
                particles.push(new Particle(x, y, color, Math.random() > 0.5 ? 'spark' : 'star'));
            }
        }
        
        function animateParticles() {
            pCtx.clearRect(0, 0, particleCanvas.width, particleCanvas.height);
            particles = particles.filter(p => p.life > 0);
            particles.forEach(p => { p.update(); p.draw(); });
            requestAnimationFrame(animateParticles);
        }
        animateParticles();
        
        // Screen shake effect
        function screenShake(intensity = 5) {
            const world = document.getElementById('game-world');
            let shakes = 6;
            const interval = setInterval(() => {
                if(shakes <= 0) { world.style.transform = 'translate(0, 0)'; clearInterval(interval); return; }
                const x = (Math.random() - 0.5) * intensity;
                const y = (Math.random() - 0.5) * intensity;
                world.style.transform = `translate(${x}px, ${y}px)`;
                shakes--;
            }, 30);
        }
        
        // Override attack to add particles
        const originalAttack = attack;
        attack = function() {
            originalAttack();
            const enemyEl = document.getElementById('enemy-sprite');
            const rect = enemyEl.getBoundingClientRect();
            spawnParticles(rect.left + rect.width/2, rect.top + rect.height/2, '#ff4444', 20);
            screenShake(8);
        };
        
        // Full screen world panel toggle
        let panelsVisible = true;
        function togglePanels() {
            panelsVisible = !panelsVisible;
            document.getElementById('panels-overlay').style.display = panelsVisible ? 'flex' : 'none';
        }
        
        // Expand movement bounds for full screen
        document.addEventListener('keydown', (e) => {
            const speed = 15;
            const maxX = window.innerWidth - 50;
            const maxY = window.innerHeight - 50;
            if(e.key === 'w' || e.key === 'ArrowUp') playerY = Math.max(40, playerY - speed);
            if(e.key === 's' || e.key === 'ArrowDown') playerY = Math.min(maxY, playerY + speed);
            if(e.key === 'a' || e.key === 'ArrowLeft') playerX = Math.max(10, playerX - speed);
            if(e.key === 'd' || e.key === 'ArrowRight') playerX = Math.min(maxX, playerX + speed);
            playerSprite.style.left = playerX + 'px';
            playerSprite.style.top = playerY + 'px';
            checkProximity();
        });
        
        // Re-bind world enemies for the new fullscreen world
        document.querySelectorAll('.world-enemy').forEach(en => {
            en.addEventListener('click', () => attackWorldEnemy(en));
        });
    </script>
</body>
</html>