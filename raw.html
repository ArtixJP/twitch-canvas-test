<!DOCTYPE html>

<html lang="en">
<head>
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' https:; script-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com https://cdn.jsdelivr.net https://unpkg.com https://esm.sh https://esm.run https://cdn.tailwindcss.com https://threejs.org https://cdn.threejs.org https://cdn.p5js.org https://code.jquery.com https://d3js.org https://cdn.plot.ly https://cdn.tonejs.org; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://fonts.gstatic.com https://cdnjs.cloudflare.com https://cdn.jsdelivr.net; img-src 'self' data: https:; media-src 'self' https:; font-src 'self' https://fonts.gstatic.com https://fonts.googleapis.com https://cdnjs.cloudflare.com https://cdn.jsdelivr.net; worker-src 'self'; frame-src https://www.youtube.com https://www.youtube-nocookie.com https://player.vimeo.com; connect-src 'self' https: wss: ws:; object-src 'none'; base-uri 'self'; form-action 'self';">
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Mini Minecraft - Click Edition</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { 
        min-height: 100vh;
        background: #1a1a2e;
        font-family: 'Segoe UI', sans-serif;
        overflow: hidden;
    }
    #game-container {
        width: 100vw;
        height: 100vh;
        position: relative;
    }
    canvas { display: block; }
    
    /* UI Overlay */
    #ui {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
    }
    
    /* Movement Controls */
    #movement-controls {
        position: absolute;
        bottom: 20px;
        left: 20px;
        display: grid;
        grid-template-columns: repeat(3, 60px);
        grid-template-rows: repeat(3, 60px);
        gap: 5px;
        pointer-events: auto;
    }
    
    .move-btn {
        width: 60px;
        height: 60px;
        background: rgba(255,255,255,0.2);
        border: 2px solid rgba(255,255,255,0.5);
        border-radius: 10px;
        color: white;
        font-size: 24px;
        cursor: pointer;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    .move-btn:hover {
        background: rgba(255,255,255,0.4);
        transform: scale(1.1);
    }
    .move-btn:active {
        background: rgba(0,210,255,0.6);
    }
    .empty { background: transparent; border: none; pointer-events: none; }
    
    /* Action Controls */
    #action-controls {
        position: absolute;
        bottom: 20px;
        right: 20px;
        display: flex;
        flex-direction: column;
        gap: 10px;
        pointer-events: auto;
    }
    
    .action-btn {
        padding: 15px 25px;
        background: rgba(255,255,255,0.2);
        border: 2px solid rgba(255,255,255,0.5);
        border-radius: 10px;
        color: white;
        font-size: 16px;
        cursor: pointer;
        transition: all 0.2s;
    }
    .action-btn:hover {
        background: rgba(255,255,255,0.4);
    }
    .action-btn.active {
        background: rgba(0,210,255,0.6);
        border-color: #00d2ff;
    }
    
    /* Block Selector */
    #block-selector {
        position: absolute;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        gap: 10px;
        pointer-events: auto;
    }
    
    .block-btn {
        width: 50px;
        height: 50px;
        border: 3px solid rgba(255,255,255,0.3);
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.2s;
    }
    .block-btn:hover {
        transform: scale(1.1);
    }
    .block-btn.selected {
        border-color: #00d2ff;
        box-shadow: 0 0 15px #00d2ff;
    }
    
    #grass-btn { background: linear-gradient(to bottom, #4a7c23 0%, #4a7c23 30%, #8B4513 30%, #8B4513 100%); }
    #dirt-btn { background: #8B4513; }
    #stone-btn { background: #808080; }
    #wood-btn { background: #654321; }
    #leaves-btn { background: #228B22; }
    #water-btn { background: linear-gradient(135deg, #1e90ff, #00bfff); }
    #sand-btn { background: #f4d03f; }
    
    /* Camera Controls */
    #camera-controls {
        position: absolute;
        top: 20px;
        right: 20px;
        display: flex;
        flex-direction: column;
        gap: 10px;
        pointer-events: auto;
    }
    
    /* Info Panel */
    #test-banner {
        position: absolute;
        top: 80px;
        left: 50%;
        transform: translateX(-50%);
        background: linear-gradient(135deg, #ff6b6b, #feca57, #48dbfb, #ff9ff3);
        background-size: 400% 400%;
        animation: gradient-shift 3s ease infinite, float 2s ease-in-out infinite;
        padding: 10px 30px;
        border-radius: 20px;
        color: white;
        font-weight: bold;
        font-size: 18px;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        animation: gradient-shift 3s ease infinite, float 2s ease-in-out infinite, pulse-glow 2s ease-in-out infinite;
        z-index: 100;
    }
    @keyframes gradient-shift {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
    }
    @keyframes pulse-glow {
        0%, 100% { box-shadow: 0 0 20px #ff6b6b, 0 0 40px #feca57; }
        25% { box-shadow: 0 0 20px #48dbfb, 0 0 40px #ff6b6b; }
        50% { box-shadow: 0 0 20px #ff9ff3, 0 0 40px #48dbfb; }
        75% { box-shadow: 0 0 20px #feca57, 0 0 40px #ff9ff3; }
    }
    @keyframes float {
        0%, 100% { transform: translateX(-50%) translateY(0); }
        50% { transform: translateX(-50%) translateY(-10px); }
    }
    #info {
        position: absolute;
        top: 20px;
        left: 20px;
        color: white;
        font-size: 14px;
        background: rgba(0,0,0,0.5);
        padding: 10px;
        border-radius: 8px;
    }
    
    /* Crosshair */
    #crosshair {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 20px;
        height: 20px;
        pointer-events: none;
    }
    #crosshair::before, #crosshair::after {
        content: '';
        position: absolute;
        background: white;
    }
    #crosshair::before {
        width: 2px;
        height: 20px;
        left: 9px;
    }
    #crosshair::after {
        width: 20px;
        height: 2px;
        top: 9px;
    }
    
    /* Red Sun */
    #red-sun {
        position: absolute;
        top: 60px;
        right: 150px;
        width: 100px;
        height: 100px;
        background: radial-gradient(circle at 30% 30%, #fff9c4, #ffeb3b, #ffc107);
        border-radius: 50%;
        box-shadow: 
            0 0 60px #ffeb3b,
            0 0 120px #ffc107,
            0 0 180px rgba(255,235,59,0.5),
            inset -10px -10px 30px rgba(255,193,7,0.6),
            inset 10px 10px 20px rgba(255,249,196,0.4);
        animation: sun-pulse 4s ease-in-out infinite, sun-glow 2s ease-in-out infinite alternate;
        z-index: 50;
        pointer-events: none;
    }
    
    #red-sun::before {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 70%;
        height: 70%;
        background: radial-gradient(circle, rgba(255,200,100,0.3), transparent 70%);
        border-radius: 50%;
    }
    
    #red-sun::after {
        content: '';
        position: absolute;
        top: -20px;
        left: -20px;
        right: -20px;
        bottom: -20px;
        background: radial-gradient(circle, rgba(255,69,0,0.2), transparent 60%);
        border-radius: 50%;
        animation: corona-flare 3s ease-in-out infinite;
    }
    
    @keyframes sun-pulse {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.05); }
    }
    
    @keyframes sun-glow {
        0% { box-shadow: 0 0 60px #ffeb3b, 0 0 120px #ffc107, 0 0 180px rgba(255,235,59,0.5); }
        100% { box-shadow: 0 0 80px #fff59d, 0 0 150px #ffeb3b, 0 0 220px rgba(255,241,118,0.6); }
    }
    
    @keyframes corona-flare {
        0%, 100% { opacity: 0.5; transform: scale(1); }
        50% { opacity: 0.8; transform: scale(1.1); }
    }
    
    /* Cloud covering the sun */
    #cloud {
        position: absolute;
        top: 40px;
        width: 180px;
        height: 80px;
        z-index: 60;
        animation: cloud-drift 15s ease-in-out infinite;
        pointer-events: none;
        filter: drop-shadow(0 5px 15px rgba(0,0,0,0.2));
    }
    
    #cloud::before, #cloud::after, #cloud .puff1, #cloud .puff2, #cloud .puff3 {
        content: '';
        position: absolute;
        background: linear-gradient(180deg, #f0f0f0 0%, #d4d4d4 50%, #b8b8b8 100%);
        border-radius: 50%;
    }
    
    #cloud::before {
        width: 80px;
        height: 80px;
        top: 20px;
        left: 20px;
    }
    
    #cloud::after {
        width: 100px;
        height: 70px;
        top: 30px;
        left: 60px;
    }
    
    #cloud .puff1 {
        width: 60px;
        height: 60px;
        top: 35px;
        left: 0;
    }
    
    #cloud .puff2 {
        width: 70px;
        height: 55px;
        top: 10px;
        left: 50px;
    }
    
    #cloud .puff3 {
        width: 50px;
        height: 50px;
        top: 40px;
        left: 130px;
    }
    
    @keyframes cloud-drift {
        0% {
            right: 300px;
            opacity: 0.3;
        }
        20% {
            opacity: 0.9;
        }
        50% {
            right: 120px;
            opacity: 1;
        }
        80% {
            opacity: 0.9;
        }
        100% {
            right: 300px;
            opacity: 0.3;
        }
    }
    
    /* Sun dimming effect when cloud passes */
    #red-sun {
        animation: sun-pulse 4s ease-in-out infinite, sun-glow 2s ease-in-out infinite alternate, sun-dim 15s ease-in-out infinite;
    }
    
    /* Rain Effect */
    .raindrop {
        position: absolute;
        width: 2px;
        height: 20px;
        background: linear-gradient(to bottom, transparent, rgba(174, 194, 224, 0.8), rgba(174, 194, 224, 0.3));
        pointer-events: none;
        animation: rain-fall linear infinite;
        z-index: 200;
    }
    
    @keyframes rain-fall {
        0% {
            transform: translateY(-100px) rotate(15deg);
            opacity: 0;
        }
        10% {
            opacity: 1;
        }
        90% {
            opacity: 1;
        }
        100% {
            transform: translateY(100vh) rotate(15deg);
            opacity: 0;
        }
    }
    
    /* Rain splash effect */
    .splash {
        position: absolute;
        width: 10px;
        height: 5px;
        border-radius: 50%;
        background: rgba(174, 194, 224, 0.5);
        pointer-events: none;
        animation: splash 0.4s ease-out forwards;
        z-index: 199;
    }
    
    @keyframes splash {
        0% {
            transform: scale(0);
            opacity: 1;
        }
        100% {
            transform: scale(2);
            opacity: 0;
        }
    }
    
    /* Darker sky during rain */
    #game-container {
        position: relative;
    }
    
    #rain-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(to bottom, rgba(50, 60, 80, 0.4), rgba(30, 40, 60, 0.2));
        pointer-events: none;
        z-index: 150;
        display: none;
    }
    
    /* Thunder flash */
    @keyframes thunder-flash {
        0%, 100% { opacity: 0; }
        5%, 25% { opacity: 0.3; }
        10%, 20% { opacity: 0; }
        15% { opacity: 0.5; }
    }
    
    #thunder {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: white;
        pointer-events: none;
        z-index: 300;
        opacity: 0;
        display: none;
    }
    
    @keyframes sun-dim {
        0%, 100% { filter: brightness(1); }
        40%, 60% { filter: brightness(0.6); }
    }
    
    /* Asteroid */
    #asteroid {
        position: absolute;
        width: 60px;
        height: 60px;
        background: radial-gradient(ellipse at 30% 30%, #8B7355, #4a3728, #2d1f14);
        border-radius: 45% 55% 50% 50%;
        box-shadow: 
            inset -5px -5px 15px rgba(0,0,0,0.6),
            inset 5px 5px 10px rgba(139,115,85,0.3),
            0 0 30px rgba(255,100,0,0.8),
            0 0 60px rgba(255,50,0,0.5);
        animation: asteroid-fly 4s linear infinite;
        z-index: 1000;
        pointer-events: none;
    }
    
    #asteroid::before {
        content: '';
        position: absolute;
        width: 100%;
        height: 100%;
        background: 
            radial-gradient(circle at 20% 30%, rgba(100,80,60,0.8) 5%, transparent 10%),
            radial-gradient(circle at 60% 40%, rgba(80,60,40,0.7) 8%, transparent 15%),
            radial-gradient(circle at 40% 70%, rgba(70,50,30,0.6) 6%, transparent 12%),
            radial-gradient(circle at 75% 65%, rgba(90,70,50,0.5) 4%, transparent 8%);
        border-radius: inherit;
    }
    
    #asteroid::after {
        content: '';
        position: absolute;
        right: -80px;
        top: 50%;
        transform: translateY(-50%);
        width: 120px;
        height: 30px;
        background: linear-gradient(to left, 
            transparent,
            rgba(255,200,100,0.3),
            rgba(255,150,50,0.5),
            rgba(255,100,0,0.7));
        filter: blur(8px);
        border-radius: 50%;
    }
    
    @keyframes asteroid-fly {
        0% {
            top: -100px;
            left: 110%;
            transform: rotate(0deg) scale(0.5);
            opacity: 0;
        }
        10% {
            opacity: 1;
            transform: rotate(36deg) scale(1);
        }
        50% {
            transform: rotate(180deg) scale(1.2);
        }
        90% {
            opacity: 1;
            transform: rotate(324deg) scale(1);
        }
        100% {
            top: 110%;
            left: -100px;
            transform: rotate(360deg) scale(0.5);
            opacity: 0;
        }
    }
    
    .particle {
        position: absolute;
        width: 8px;
        height: 8px;
        background: radial-gradient(circle, #ffaa00, #ff5500);
        border-radius: 50%;
        pointer-events: none;
        animation: particle-fade 0.8s ease-out forwards;
        z-index: 999;
    }
    
    @keyframes particle-fade {
        0% {
            opacity: 1;
            transform: scale(1);
        }
        100% {
            opacity: 0;
            transform: scale(0.2);
        }
    }
</style>
</head>
<body>
<div id="game-container">
<div id="ui">
<div id="test-banner">‚òÄÔ∏è SUNNY SKIES! ‚òÄÔ∏è</div>
<div id="info">
<div>üéÆ Mathilde's Minecraft World üè∞</div>
<div style="color: #00ff00; font-size: 12px;">‚úÖ TEST SUCCESSFUL!</div>
<div id="mode-display">Mode: BUILD</div>
<div id="coords">Pos: 0, 0, 0</div>
</div>
<div id="block-selector">
<div class="block-btn selected" data-block="grass" id="grass-btn" title="Grass"></div>
<div class="block-btn" data-block="dirt" id="dirt-btn" title="Dirt"></div>
<div class="block-btn" data-block="stone" id="stone-btn" title="Stone"></div>
<div class="block-btn" data-block="wood" id="wood-btn" title="Wood"></div>
<div class="block-btn" data-block="leaves" id="leaves-btn" title="Leaves"></div>
<div class="block-btn" data-block="water" id="water-btn" title="Water"></div>
<div class="block-btn" data-block="sand" id="sand-btn" title="Sand"></div>
</div>
<div id="camera-controls">
<button class="action-btn" id="rotate-left">‚ü≤ Rotate Left</button>
<button class="action-btn" id="rotate-right">‚ü≥ Rotate Right</button>
<button class="action-btn" id="zoom-in">üîç+ Zoom In</button>
<button class="action-btn" id="zoom-out">üîç- Zoom Out</button>
</div>
<div id="movement-controls">
<div class="move-btn empty"></div>
<button class="move-btn" id="move-forward">‚¨ÜÔ∏è</button>
<div class="move-btn empty"></div>
<button class="move-btn" id="move-left">‚¨ÖÔ∏è</button>
<button class="move-btn" id="move-up">‚¨Ü</button>
<button class="move-btn" id="move-right">‚û°Ô∏è</button>
<div class="move-btn empty"></div>
<button class="move-btn" id="move-backward">‚¨áÔ∏è</button>
<button class="move-btn" id="move-down">‚¨á</button>
</div>
<div id="action-controls">
<button class="action-btn active" id="build-mode">üî® BUILD</button>
<button class="action-btn" id="destroy-mode">üí• DESTROY</button>
</div>
<div id="crosshair"></div>
<div id="red-sun"></div>
<div id="cloud">
<div class="puff1"></div>
<div class="puff2"></div>
<div class="puff3"></div>
</div>
<div id="asteroid"></div>
<div id="rain-overlay"></div>
<div id="thunder"></div>
<div id="rain-container"></div>
</div>
</div>
<script>
// Game State
let scene, camera, renderer, raycaster, mouse;
let blocks = [];
let playerPos = { x: 8, y: 5, z: 8 };
let cameraAngle = 0;
let cameraDistance = 20;
let currentBlock = 'grass';
let mode = 'build'; // 'build' or 'destroy'

// Block colors
const blockColors = {
    grass: { top: 0x4a7c23, side: 0x8B4513, bottom: 0x8B4513 },
    dirt: { top: 0x8B4513, side: 0x8B4513, bottom: 0x8B4513 },
    stone: { top: 0x808080, side: 0x808080, bottom: 0x808080 },
    wood: { top: 0x654321, side: 0x8B6914, bottom: 0x654321 },
    leaves: { top: 0x228B22, side: 0x228B22, bottom: 0x228B22 },
    water: { top: 0x1e90ff, side: 0x1e90ff, bottom: 0x1e90ff },
    sand: { top: 0xf4d03f, side: 0xf4d03f, bottom: 0xf4d03f }
};

// Initialize Three.js
function init() {
    scene = new THREE.Scene();
    scene.background = new THREE.Color(0x2d1b4e);
    
    // Add fog for atmosphere
    scene.fog = new THREE.Fog(0x4a1a3d, 30, 80);
    
    // Add 3D Red Sun
    const sunGeometry = new THREE.SphereGeometry(5, 32, 32);
    const sunMaterial = new THREE.MeshBasicMaterial({ 
        color: 0xffeb3b,
        emissive: 0xffc107
    });
    const sun3D = new THREE.Mesh(sunGeometry, sunMaterial);
    sun3D.position.set(50, 40, -30);
    scene.add(sun3D);
    
    // Sun glow
    const glowGeometry = new THREE.SphereGeometry(7, 32, 32);
    const glowMaterial = new THREE.MeshBasicMaterial({ 
        color: 0xffeb3b,
        transparent: true,
        opacity: 0.3
    });
    const sunGlow = new THREE.Mesh(glowGeometry, glowMaterial);
    sunGlow.position.copy(sun3D.position);
    scene.add(sunGlow);
    
    // Red ambient light from sun
    const redLight = new THREE.PointLight(0xffeb3b, 0.5, 100);
    redLight.position.copy(sun3D.position);
    scene.add(redLight);
    
    camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
    updateCamera();
    
    renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.shadowMap.enabled = true;
    document.getElementById('game-container').insertBefore(renderer.domElement, document.getElementById('ui'));
    
    raycaster = new THREE.Raycaster();
    mouse = new THREE.Vector2();
    
    // Lighting
    const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
    scene.add(ambientLight);
    
    const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
    directionalLight.position.set(10, 20, 10);
    directionalLight.castShadow = true;
    scene.add(directionalLight);
    
    // Generate terrain
    generateTerrain();
    
    // Add player indicator
    createPlayerIndicator();
    
    // Event listeners
    setupControls();
    
    // Start render loop
    animate();
}

function createBlock(x, y, z, type) {
    const geometry = new THREE.BoxGeometry(1, 1, 1);
    const colors = blockColors[type];
    
    const materials = [
        new THREE.MeshLambertMaterial({ color: colors.side }), // right
        new THREE.MeshLambertMaterial({ color: colors.side }), // left
        new THREE.MeshLambertMaterial({ color: colors.top }),  // top
        new THREE.MeshLambertMaterial({ color: colors.bottom }), // bottom
        new THREE.MeshLambertMaterial({ color: colors.side }), // front
        new THREE.MeshLambertMaterial({ color: colors.side })  // back
    ];
    
    if (type === 'water') {
        materials.forEach(m => { m.transparent = true; m.opacity = 0.7; });
    }
    if (type === 'leaves') {
        materials.forEach(m => { m.transparent = true; m.opacity = 0.9; });
    }
    
    const mesh = new THREE.Mesh(geometry, materials);
    mesh.position.set(x, y, z);
    mesh.castShadow = true;
    mesh.receiveShadow = true;
    mesh.userData = { type, x, y, z };
    
    scene.add(mesh);
    blocks.push(mesh);
    return mesh;
}

function generateTerrain() {
    // Create a 16x16 terrain
    for (let x = 0; x < 16; x++) {
        for (let z = 0; z < 16; z++) {
            // Simple height variation
            const height = Math.floor(Math.sin(x * 0.3) * Math.cos(z * 0.3) * 2) + 2;
            
            for (let y = 0; y <= height; y++) {
                if (y === height) {
                    createBlock(x, y, z, 'grass');
                } else if (y > height - 3) {
                    createBlock(x, y, z, 'dirt');
                } else {
                    createBlock(x, y, z, 'stone');
                }
            }
        }
    }
    
    // Add a tree
    createTree(5, 4, 5);
    createTree(12, 3, 10);
    
    // Mathilde's special flower garden üå∏
    createFlowerPatch(8, 3, 3);
}

function createTree(x, baseY, z) {
    // Trunk
    for (let y = baseY; y < baseY + 4; y++) {
        createBlock(x, y, z, 'wood');
    }
    // Leaves
    for (let dx = -2; dx <= 2; dx++) {
        for (let dz = -2; dz <= 2; dz++) {
            for (let dy = 0; dy <= 2; dy++) {
                if (Math.abs(dx) + Math.abs(dz) + dy < 4) {
                    if (!(dx === 0 && dz === 0 && dy < 2)) {
                        createBlock(x + dx, baseY + 3 + dy, z + dz, 'leaves');
                    }
                }
            }
        }
    }
}

let playerIndicator;
function createPlayerIndicator() {
    const geometry = new THREE.ConeGeometry(0.3, 0.6, 4);
    const material = new THREE.MeshLambertMaterial({ color: 0xff0000 });
    playerIndicator = new THREE.Mesh(geometry, material);
    playerIndicator.rotation.x = Math.PI;
    scene.add(playerIndicator);
    updatePlayerIndicator();
}

function updatePlayerIndicator() {
    playerIndicator.position.set(playerPos.x, playerPos.y + 1.5, playerPos.z);
    document.getElementById('coords').textContent = `Pos: ${playerPos.x}, ${playerPos.y}, ${playerPos.z}`;
}

function updateCamera() {
    const x = playerPos.x + Math.sin(cameraAngle) * cameraDistance;
    const z = playerPos.z + Math.cos(cameraAngle) * cameraDistance;
    camera.position.set(x, playerPos.y + 10, z);
    camera.lookAt(playerPos.x, playerPos.y, playerPos.z);
}

function setupControls() {
    // Movement
    document.getElementById('move-forward').addEventListener('click', () => movePlayer(0, 0, -1));
    document.getElementById('move-backward').addEventListener('click', () => movePlayer(0, 0, 1));
    document.getElementById('move-left').addEventListener('click', () => movePlayer(-1, 0, 0));
    document.getElementById('move-right').addEventListener('click', () => movePlayer(1, 0, 0));
    document.getElementById('move-up').addEventListener('click', () => movePlayer(0, 1, 0));
    document.getElementById('move-down').addEventListener('click', () => movePlayer(0, -1, 0));
    
    // Camera
    document.getElementById('rotate-left').addEventListener('click', () => {
        cameraAngle -= Math.PI / 4;
        updateCamera();
    });
    document.getElementById('rotate-right').addEventListener('click', () => {
        cameraAngle += Math.PI / 4;
        updateCamera();
    });
    document.getElementById('zoom-in').addEventListener('click', () => {
        cameraDistance = Math.max(5, cameraDistance - 3);
        updateCamera();
    });
    document.getElementById('zoom-out').addEventListener('click', () => {
        cameraDistance = Math.min(40, cameraDistance + 3);
        updateCamera();
    });
    
    // Mode
    document.getElementById('build-mode').addEventListener('click', () => {
        mode = 'build';
        document.getElementById('build-mode').classList.add('active');
        document.getElementById('destroy-mode').classList.remove('active');
        document.getElementById('mode-display').textContent = 'Mode: BUILD';
    });
    document.getElementById('destroy-mode').addEventListener('click', () => {
        mode = 'destroy';
        document.getElementById('destroy-mode').classList.add('active');
        document.getElementById('build-mode').classList.remove('active');
        document.getElementById('mode-display').textContent = 'Mode: DESTROY';
    });
    
    // Block selector
    document.querySelectorAll('.block-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            document.querySelectorAll('.block-btn').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
            currentBlock = btn.dataset.block;
        });
    });
    
    // Click on canvas to place/destroy blocks
    renderer.domElement.addEventListener('click', onCanvasClick);
    
    // Window resize
    window.addEventListener('resize', () => {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
    });
}

function movePlayer(dx, dy, dz) {
    // Rotate movement based on camera angle
    const sin = Math.sin(cameraAngle);
    const cos = Math.cos(cameraAngle);
    
    const newX = playerPos.x + Math.round(dx * cos - dz * sin);
    const newY = playerPos.y + dy;
    const newZ = playerPos.z + Math.round(dx * sin + dz * cos);
    
    // Bounds check
    if (newX >= -5 && newX <= 20 && newZ >= -5 && newZ <= 20 && newY >= 0 && newY <= 20) {
        playerPos.x = newX;
        playerPos.y = newY;
        playerPos.z = newZ;
        updatePlayerIndicator();
        updateCamera();
    }
}

function onCanvasClick(event) {
    const rect = renderer.domElement.getBoundingClientRect();
    mouse.x = ((event.clientX - rect.left) / rect.width) * 2 - 1;
    mouse.y = -((event.clientY - rect.top) / rect.height) * 2 + 1;
    
    raycaster.setFromCamera(mouse, camera);
    const intersects = raycaster.intersectObjects(blocks);
    
    if (mode === 'destroy' && intersects.length > 0) {
        const block = intersects[0].object;
        scene.remove(block);
        blocks = blocks.filter(b => b !== block);
    } else if (mode === 'build' && intersects.length > 0) {
        const intersect = intersects[0];
        const normal = intersect.face.normal;
        const pos = intersect.object.position.clone();
        
        const newX = Math.round(pos.x + normal.x);
        const newY = Math.round(pos.y + normal.y);
        const newZ = Math.round(pos.z + normal.z);
        
        // Check if block already exists at this position
        const exists = blocks.some(b => 
            Math.round(b.position.x) === newX && 
            Math.round(b.position.y) === newY && 
            Math.round(b.position.z) === newZ
        );
        
        if (!exists && newY >= 0) {
            createBlock(newX, newY, newZ, currentBlock);
        }
    }
}

function animate() {
    requestAnimationFrame(animate);
    
    // Animate water blocks
    blocks.forEach(block => {
        if (block.userData.type === 'water') {
            block.position.y = block.userData.y + Math.sin(Date.now() * 0.002 + block.userData.x) * 0.05;
        }
    });
    
    // Rotate player indicator
    playerIndicator.rotation.y += 0.02;
    
    renderer.render(scene, camera);
}

function createFlowerPatch(x, baseY, z) {
    // Create a cute flower patch for Mathilde
    const flowerColors = [0xff69b4, 0xff1493, 0xda70d6, 0xee82ee, 0xffb6c1];
    for (let dx = -1; dx <= 1; dx++) {
        for (let dz = -1; dz <= 1; dz++) {
            if (Math.random() > 0.3) {
                const color = flowerColors[Math.floor(Math.random() * flowerColors.length)];
                const geometry = new THREE.ConeGeometry(0.15, 0.3, 6);
                const material = new THREE.MeshLambertMaterial({ color: color });
                const flower = new THREE.Mesh(geometry, material);
                flower.position.set(x + dx + Math.random() * 0.5, baseY + 0.65, z + dz + Math.random() * 0.5);
                flower.rotation.x = Math.PI;
                scene.add(flower);
            }
        }
    }
}

// Start the game
init();

// Asteroid particle trail
function createAsteroidParticles() {
    const asteroid = document.getElementById('asteroid');
    const rect = asteroid.getBoundingClientRect();
    
    if (rect.left > -100 && rect.left < window.innerWidth + 100) {
        for (let i = 0; i < 3; i++) {
            const particle = document.createElement('div');
            particle.className = 'particle';
            particle.style.left = (rect.left + 30 + Math.random() * 20) + 'px';
            particle.style.top = (rect.top + 30 + Math.random() * 20) + 'px';
            particle.style.width = (4 + Math.random() * 8) + 'px';
            particle.style.height = particle.style.width;
            document.body.appendChild(particle);
            
            setTimeout(() => particle.remove(), 800);
        }
    }
}

setInterval(createAsteroidParticles, 50);

// Heavy Rain Effect - Il pleut √† seaux!
function createRain() {
    const rainContainer = document.getElementById('rain-container');
    if (!rainContainer) return;
    
    // Create multiple raindrops at once for heavy rain
    for (let i = 0; i < 5; i++) {
        const drop = document.createElement('div');
        drop.className = 'raindrop';
        drop.style.left = Math.random() * 100 + 'vw';
        drop.style.animationDuration = (0.3 + Math.random() * 0.4) + 's';
        drop.style.height = (15 + Math.random() * 15) + 'px';
        drop.style.opacity = 0.4 + Math.random() * 0.4;
        document.body.appendChild(drop);
        
        // Remove raindrop and create splash
        const duration = parseFloat(drop.style.animationDuration) * 1000;
        setTimeout(() => {
            // Create splash at bottom
            const splash = document.createElement('div');
            splash.className = 'splash';
            splash.style.left = drop.style.left;
            splash.style.bottom = '0px';
            document.body.appendChild(splash);
            setTimeout(() => splash.remove(), 400);
            
            drop.remove();
        }, duration);
    }
}

// Rain disabled - sunny day!
// setInterval(createRain, 30);

// Sunny bright sky!
if (scene) {
    scene.background = new THREE.Color(0x4a90c2);
    scene.fog = new THREE.Fog(0x87ceeb, 30, 80);
}

console.log('‚òÄÔ∏è Sunny skies! Rain removed!');
</script>
</body>
</html>