<!DOCTYPE html>

<html lang="en">
<head>
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' https:; script-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com https://cdn.jsdelivr.net https://unpkg.com https://esm.sh https://esm.run https://cdn.tailwindcss.com https://threejs.org https://cdn.threejs.org https://cdn.p5js.org https://code.jquery.com https://d3js.org https://cdn.plot.ly https://cdn.tonejs.org; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://fonts.gstatic.com https://cdnjs.cloudflare.com https://cdn.jsdelivr.net; img-src 'self' data: https:; media-src 'self' https:; font-src 'self' https://fonts.gstatic.com https://fonts.googleapis.com https://cdnjs.cloudflare.com https://cdn.jsdelivr.net; worker-src 'self'; frame-src https://www.youtube.com https://www.youtube-nocookie.com https://player.vimeo.com; connect-src 'self' https: wss: ws:; object-src 'none'; base-uri 'self'; form-action 'self';">
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Pokemon Adventure - French Keyboard Edition</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<style>
        body { 
            font-family: system-ui, sans-serif; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            min-height: 100vh; 
            margin: 0;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: white;
        }
        h1 { font-size: 3rem; text-align: center; }
        #game-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; }
        #ui { position: fixed; top: 20px; left: 20px; z-index: 100; font-size: 14px; }
        .health-bar { width: 200px; height: 20px; background: #333; border: 2px solid #fff; border-radius: 10px; overflow: hidden; }
        .health-fill { height: 100%; background: linear-gradient(90deg, #ff4444, #ff6666); transition: width 0.3s; }
        .stats { margin-top: 10px; }
        #controls { position: fixed; bottom: 20px; left: 20px; z-index: 100; background: rgba(0,0,0,0.7); padding: 15px; border-radius: 10px; }
        .xp-bar { width: 200px; height: 10px; background: #333; border: 2px solid #gold; border-radius: 5px; margin-top: 5px; }
        .xp-fill { height: 100%; background: linear-gradient(90deg, #ffd700, #ffec8b); transition: width 0.3s; }
    </style>
</head>
<body>
<div id="game-container"></div>
<div id="ui">
<h2>ðŸŽ® Trainer Ash</h2>
<div class="health-bar"><div class="health-fill" id="health" style="width: 100%"></div></div>
<div class="stats">HP: <span id="hp-text">100</span>/100</div>
<div class="xp-bar"><div class="xp-fill" id="xp" style="width: 0%"></div></div>
<div class="stats">Level: <span id="level">1</span> | XP: <span id="xp-text">0</span>/100</div>
<div class="stats">Wild PokÃ©mon: <span id="enemies">0</span> | Caught: <span id="score">0</span></div>
<div class="stats">ðŸ”´ PokÃ©balls: <span id="pokeballs">âˆž</span></div>
</div>
<div id="controls">
<strong>ðŸŽ® Controls (AZERTY)</strong><br/>
        Z - Forward | S - Back<br/>
        Q - Left | D - Right<br/>
        SPACE - Throw PokÃ©ball<br/>
        E - Pikachu Thunderbolt!
    </div>
<h1 style="position:fixed;bottom:60px;right:20px;font-size:1rem;opacity:0.5">Hello World</h1>
<script>
    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0x1a1a2e);
    scene.fog = new THREE.Fog(0x1a1a2e, 10, 50);
    const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
    const renderer = new THREE.WebGLRenderer({antialias: true});
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.shadowMap.enabled = true;
    document.getElementById('game-container').appendChild(renderer.domElement);
    
    // Lights
    const ambient = new THREE.AmbientLight(0x404040, 0.5);
    scene.add(ambient);
    const sun = new THREE.DirectionalLight(0xffffff, 1);
    sun.position.set(10, 20, 10);
    sun.castShadow = true;
    scene.add(sun);
    
    // Floor
    const floorGeo = new THREE.PlaneGeometry(100, 100);
    const floorMat = new THREE.MeshStandardMaterial({color: 0x2d5a27});
    const floor = new THREE.Mesh(floorGeo, floorMat);
    floor.rotation.x = -Math.PI/2;
    floor.receiveShadow = true;
    scene.add(floor);
    
    // Player
    const playerGeo = new THREE.CylinderGeometry(0.5, 0.5, 1.5, 8);
    const playerMat = new THREE.MeshStandardMaterial({color: 0xff0000}); // Red cap trainer
    const player = new THREE.Mesh(playerGeo, playerMat);
    player.position.y = 1;
    player.castShadow = true;
    scene.add(player);
    
    // Pokeball weapon
    const pokeballGeo = new THREE.SphereGeometry(0.25, 16, 16);
    const pokeballMat = new THREE.MeshStandardMaterial({color: 0xff0000, emissive: 0x000000});
    const pokeball = new THREE.Mesh(pokeballGeo, pokeballMat);
    pokeball.position.set(0.8, 0.2, 0);
    player.add(pokeball);
    // White stripe on pokeball
    const stripeGeo = new THREE.TorusGeometry(0.25, 0.03, 8, 16);
    const stripeMat = new THREE.MeshStandardMaterial({color: 0xffffff});
    const stripe = new THREE.Mesh(stripeGeo, stripeMat);
    stripe.rotation.x = Math.PI/2;
    pokeball.add(stripe);
    
    // Pikachu companion
    const pikachuBody = new THREE.SphereGeometry(0.4, 8, 8);
    const pikachuMat = new THREE.MeshStandardMaterial({color: 0xffdd00});
    const pikachu = new THREE.Mesh(pikachuBody, pikachuMat);
    pikachu.position.set(1.2, -0.3, 0);
    player.add(pikachu);
    // Pikachu ears
    const earGeo = new THREE.ConeGeometry(0.15, 0.4, 4);
    const ear1 = new THREE.Mesh(earGeo, pikachuMat);
    const ear2 = new THREE.Mesh(earGeo, pikachuMat);
    ear1.position.set(-0.2, 0.35, 0);
    ear2.position.set(0.2, 0.35, 0);
    pikachu.add(ear1); pikachu.add(ear2);
    
    let hp = 100, xp = 0, level = 1, score = 0;
    const enemies = [];
    const keys = {};
    let attacking = false;
    let thunderboltCooldown = false;
    const thrownPokeballs = [];
    
    function spawnEnemy() {
        const enemyGeo = new THREE.SphereGeometry(0.6, 8, 8);
        const pokemonColors = [0x9b59b6, 0x3498db, 0xe74c3c, 0x2ecc71, 0xf39c12];
        const enemyMat = new THREE.MeshStandardMaterial({color: pokemonColors[Math.floor(Math.random()*pokemonColors.length)]});
        const enemy = new THREE.Mesh(enemyGeo, enemyMat);
        const angle = Math.random() * Math.PI * 2;
        const dist = 15 + Math.random() * 10;
        enemy.position.set(Math.cos(angle)*dist, 0.6, Math.sin(angle)*dist);
        enemy.castShadow = true;
        enemy.userData = {hp: 30, speed: 0.02 + level*0.005};
        scene.add(enemy);
        enemies.push(enemy);
        document.getElementById('enemies').textContent = enemies.length;
    }
    for(let i=0;i<5;i++) spawnEnemy();
    setInterval(spawnEnemy, 3000);
    
    document.addEventListener('keydown', e => keys[e.key.toLowerCase()] = true);
    document.addEventListener('keyup', e => keys[e.key.toLowerCase()] = false);
    
    camera.position.set(0, 8, 10);
    camera.lookAt(player.position);
    
    function throwPokeball() {
        if(attacking) return;
        attacking = true;
        // Find nearest enemy to throw at
        let nearest = null, minDist = 20;
        enemies.forEach(e => {
            const d = player.position.distanceTo(e.position);
            if(d < minDist) { minDist = d; nearest = e; }
        });
        if(!nearest) { attacking = false; return; }
        
        // Create thrown pokeball
        const thrownGeo = new THREE.SphereGeometry(0.25, 16, 16);
        const thrownMat = new THREE.MeshStandardMaterial({color: 0xff0000, emissive: 0x330000});
        const thrown = new THREE.Mesh(thrownGeo, thrownMat);
        thrown.position.copy(player.position);
        thrown.position.y = 1.5;
        thrown.userData = {target: nearest, speed: 0.5};
        scene.add(thrown);
        thrownPokeballs.push(thrown);
        setTimeout(() => { attacking = false; }, 500);
    }
    
    function thunderbolt() {
        if(thunderboltCooldown) return;
        thunderboltCooldown = true;
        // Pikachu flash
        pikachu.material.emissive.setHex(0xffff00);
        // Create lightning bolts to all nearby enemies
        enemies.forEach((e,i) => {
            if(player.position.distanceTo(e.position) < 10) {
                // Lightning effect
                const points = [];
                points.push(pikachu.getWorldPosition(new THREE.Vector3()));
                points.push(e.position.clone());
                const lightGeo = new THREE.BufferGeometry().setFromPoints(points);
                const lightMat = new THREE.LineBasicMaterial({color: 0xffff00, linewidth: 3});
                const lightning = new THREE.Line(lightGeo, lightMat);
                scene.add(lightning);
                setTimeout(() => scene.remove(lightning), 200);
                
                e.userData.hp -= 15 + level*3;
                e.material.emissive.setHex(0xffff00);
                setTimeout(() => e.material.emissive.setHex(0), 200);
                if(e.userData.hp <= 0) {
                    scene.remove(e);
                    enemies.splice(i, 1);
                    xp += 25; score += 1;
                    if(xp >= 100) { level++; xp = 0; hp = Math.min(100, hp+20); }
                    updateUI();
                }
            }
        });
        // Show PIKA! text
        const pika = document.createElement('div');
        pika.textContent = 'âš¡ PIKA! âš¡';
        pika.style.cssText = 'position:fixed;top:40%;left:50%;transform:translate(-50%,-50%);font-size:2.5rem;color:#ffff00;text-shadow:0 0 20px #ff0;z-index:999;';
        document.body.appendChild(pika);
        setTimeout(() => pika.remove(), 800);
        setTimeout(() => { pikachu.material.emissive.setHex(0); thunderboltCooldown = false; }, 2000);
    }
    
    function updateUI() {
        document.getElementById('health').style.width = hp+'%';
        document.getElementById('hp-text').textContent = hp;
        document.getElementById('xp').style.width = xp+'%';
        document.getElementById('xp-text').textContent = xp;
        document.getElementById('level').textContent = level;
        document.getElementById('score').textContent = score;
        document.getElementById('enemies').textContent = enemies.length;
    }
    
    function animate() {
        requestAnimationFrame(animate);
        const speed = 0.15;
        if(keys['z']) player.position.z -= speed;
        if(keys['s']) player.position.z += speed;
        if(keys['q']) player.position.x -= speed;
        if(keys['d']) player.position.x += speed;
        if(keys[' ']) throwPokeball();
        if(keys['e']) thunderbolt();
        
        // Update thrown pokeballs
        for(let i = thrownPokeballs.length-1; i >= 0; i--) {
            const pb = thrownPokeballs[i];
            if(!pb.userData.target || !enemies.includes(pb.userData.target)) {
                scene.remove(pb); thrownPokeballs.splice(i,1); continue;
            }
            const dir = new THREE.Vector3().subVectors(pb.userData.target.position, pb.position).normalize();
            pb.position.add(dir.multiplyScalar(pb.userData.speed));
            pb.rotation.x += 0.2; pb.rotation.z += 0.1;
            if(pb.position.distanceTo(pb.userData.target.position) < 0.8) {
                const e = pb.userData.target;
                e.userData.hp -= 20 + level*5;
                if(e.userData.hp <= 0) {
                    const idx = enemies.indexOf(e);
                    if(idx > -1) { scene.remove(e); enemies.splice(idx,1); xp += 25; score++; }
                    if(xp >= 100) { level++; xp = 0; hp = Math.min(100, hp+20); }
                    const gotcha = document.createElement('div');
                    gotcha.textContent = 'âœ¨ GOTCHA! âœ¨';
                    gotcha.style.cssText = 'position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);font-size:3rem;color:#ffd700;text-shadow:0 0 20px #ff0;z-index:999;';
                    document.body.appendChild(gotcha);
                    setTimeout(() => gotcha.remove(), 1000);
                    updateUI();
                }
                scene.remove(pb); thrownPokeballs.splice(i,1);
            }
        }
        
        enemies.forEach(e => {
            const dir = new THREE.Vector3().subVectors(player.position, e.position).normalize();
            e.position.add(dir.multiplyScalar(e.userData.speed));
            if(e.position.distanceTo(player.position) < 1.2) {
                hp -= 0.5;
                updateUI();
                if(hp <= 0) { alert('Game Over! Score: '+score); location.reload(); }
            }
        });
        
        camera.position.x = player.position.x;
        camera.position.z = player.position.z + 10;
        camera.lookAt(player.position);
        renderer.render(scene, camera);
    }
    animate();
    
    window.addEventListener('resize', () => {
        camera.aspect = window.innerWidth/window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
    });
    </script>
</body>
</html>