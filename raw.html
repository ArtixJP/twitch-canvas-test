<!DOCTYPE html>

<html lang="en">
<head>
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' https:; script-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com https://cdn.jsdelivr.net https://unpkg.com https://esm.sh https://esm.run https://cdn.tailwindcss.com https://threejs.org https://cdn.threejs.org https://cdn.p5js.org https://code.jquery.com https://d3js.org https://cdn.plot.ly https://cdn.tonejs.org; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://fonts.gstatic.com https://cdnjs.cloudflare.com https://cdn.jsdelivr.net; img-src 'self' data: https:; media-src 'self' https:; font-src 'self' https://fonts.gstatic.com https://fonts.googleapis.com https://cdnjs.cloudflare.com https://cdn.jsdelivr.net; worker-src 'self'; frame-src https://www.youtube.com https://www.youtube-nocookie.com https://player.vimeo.com; connect-src 'self' https: wss: ws:; object-src 'none'; base-uri 'self'; form-action 'self';">
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Twitch Minecraft World Builder</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<style>
        body { 
            font-family: 'Courier New', monospace; 
            margin: 0;
            padding: 0;
            overflow: hidden;
            background: #87CEEB;
            color: white;
        }
        h1 { 
            font-size: 2rem; 
            text-align: center; 
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 100;
            text-shadow: 2px 2px 0 #000, -2px -2px 0 #000, 2px -2px 0 #000, -2px 2px 0 #000;
            margin: 0;
            pointer-events: none;
            font-family: 'Courier New', monospace;
            letter-spacing: 2px;
            image-rendering: pixelated;
        }
        #game-container {
            position: relative;
            width: 100vw;
            height: 100vh;
        }
        canvas {
            display: block;
        }
        #object-count {
            position: absolute;
            bottom: 10px;
            left: 10px;
            font-size: 0.9rem;
            z-index: 100;
            background: rgba(0,0,0,0.7);
            padding: 8px 12px;
            border: 3px solid #555;
            image-rendering: pixelated;
        }
        #controls {
            position: absolute;
            bottom: 10px;
            right: 10px;
            font-size: 0.8rem;
            z-index: 100;
            background: rgba(0,0,0,0.7);
            padding: 8px 12px;
            border: 3px solid #555;
        }
        .minecraft-text {
            color: #FFFF55;
            text-shadow: 2px 2px 0 #3F3F00;
        }
    </style>
</head>
<body>
<div id="game-container">
<h1>‚õèÔ∏è MINECRAFT WORLD BUILDER ‚õèÔ∏è</h1>
<div id="object-count"><span class="minecraft-text">Blocks: 0 | Mobs: 0</span></div>
<div id="controls">üñ±Ô∏è Drag to rotate | Scroll to zoom</div>
</div>
<script>
        // Three.js Minecraft World
        let scene, camera, renderer, controls;
        let blocks = [];
        let mobs = [];
        let blockCount = 0;
        let time = 0;
        
        // Mouse controls
        let isDragging = false;
        let previousMousePosition = { x: 0, y: 0 };
        let cameraAngle = { x: 0.5, y: 0.3 };
        let cameraDistance = 50;
        
        init();
        animate();
        
        function init() {
            // Scene setup
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x87CEEB);
            scene.fog = new THREE.Fog(0x87CEEB, 50, 150);
            
            // Camera
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            updateCameraPosition();
            
            // Renderer
            renderer = new THREE.WebGLRenderer({ antialias: false });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            document.getElementById('game-container').appendChild(renderer.domElement);
            
            // Lighting
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
            scene.add(ambientLight);
            
            const sunLight = new THREE.DirectionalLight(0xffffff, 0.8);
            sunLight.position.set(50, 100, 50);
            sunLight.castShadow = true;
            scene.add(sunLight);
            
            // Create Minecraft terrain
            createTerrain();
            
            // Add legacy creatures as Minecraft mobs
            createVoxelFish(5, 8, 3);
            createVoxelFish(-8, 10, -5);
            createVoxelFish(12, 6, 8);
            createVoxelShark(0, 4, 0);
            createVoxelWerewolfRabbit(-10, 2, 5);
            createVoxelGreeter(8, 12, -3);
            
            // Add trees
            createTree(10, 0, 10);
            createTree(-12, 0, 8);
            createTree(5, 0, -15);
            createTree(-8, 0, -10);
            
            // Mouse events
            renderer.domElement.addEventListener('mousedown', onMouseDown);
            renderer.domElement.addEventListener('mousemove', onMouseMove);
            renderer.domElement.addEventListener('mouseup', onMouseUp);
            renderer.domElement.addEventListener('wheel', onMouseWheel);
            
            window.addEventListener('resize', onWindowResize);
        }
        
        function createBlockMaterial(color) {
            return new THREE.MeshLambertMaterial({ 
                color: color,
                flatShading: true
            });
        }
        
        function createBlock(x, y, z, color, size = 1) {
            const geometry = new THREE.BoxGeometry(size, size, size);
            const material = createBlockMaterial(color);
            const block = new THREE.Mesh(geometry, material);
            block.position.set(x, y, z);
            block.castShadow = true;
            block.receiveShadow = true;
            scene.add(block);
            blocks.push(block);
            blockCount++;
            return block;
        }
        
        function createTerrain() {
            // Grass layer
            for (let x = -20; x <= 20; x++) {
                for (let z = -20; z <= 20; z++) {
                    const height = Math.floor(Math.sin(x * 0.3) * Math.cos(z * 0.3) * 2);
                    createBlock(x, height, z, 0x4CAF50); // Grass
                    // Dirt below
                    for (let y = height - 1; y >= height - 2; y--) {
                        createBlock(x, y, z, 0x8B4513); // Dirt
                    }
                    // Stone deep below
                    createBlock(x, height - 3, z, 0x808080);
                }
            }
            
            // Water pool
            for (let x = -5; x <= 5; x++) {
                for (let z = -5; z <= 5; z++) {
                    if (x*x + z*z < 20) {
                        const waterBlock = createBlock(x, 1, z, 0x3498db);
                        waterBlock.material.transparent = true;
                        waterBlock.material.opacity = 0.7;
                    }
                }
            }
        }
        
        function createTree(x, baseY, z) {
            // Trunk
            for (let y = 1; y <= 5; y++) {
                createBlock(x, baseY + y, z, 0x8B4513);
            }
            // Leaves
            for (let lx = -2; lx <= 2; lx++) {
                for (let lz = -2; lz <= 2; lz++) {
                    for (let ly = 0; ly <= 2; ly++) {
                        if (Math.abs(lx) + Math.abs(lz) + ly < 4) {
                            createBlock(x + lx, baseY + 5 + ly, z + lz, 0x228B22);
                        }
                    }
                }
            }
        }
        
        function createVoxelFish(x, y, z) {
            const fish = new THREE.Group();
            
            // Body (cyan/blue blocks)
            const colors = [0x00CED1, 0x40E0D0, 0x48D1CC];
            const bodyColor = colors[Math.floor(Math.random() * colors.length)];
            
            for (let i = 0; i < 4; i++) {
                const block = createBlock(0, 0, 0, bodyColor);
                block.position.set(i - 1.5, 0, 0);
                fish.add(block);
            }
            // Tail
            const tail = createBlock(0, 0, 0, bodyColor);
            tail.position.set(-2.5, 0.5, 0);
            tail.scale.set(0.5, 0.5, 0.5);
            fish.add(tail);
            
            // Eye
            const eye = createBlock(0, 0, 0, 0xFFFFFF);
            eye.position.set(1.5, 0.3, 0.5);
            eye.scale.set(0.3, 0.3, 0.3);
            fish.add(eye);
            
            // Fins (wings)
            const fin1 = createBlock(0, 0, 0, 0x87CEEB);
            fin1.position.set(0, 1, 0);
            fin1.scale.set(1.5, 0.2, 0.5);
            fish.add(fin1);
            
            fish.position.set(x, y, z);
            fish.userData = { type: 'fish', vx: (Math.random() - 0.5) * 0.1, vy: 0, baseY: y };
            scene.add(fish);
            mobs.push(fish);
        }
        
        function createVoxelShark(x, y, z) {
            const shark = new THREE.Group();
            
            // Body (gray blocks)
            for (let i = 0; i < 6; i++) {
                const block = createBlock(0, 0, 0, 0x708090);
                block.position.set(i - 2.5, 0, 0);
                shark.add(block);
            }
            // Dorsal fin
            const fin = createBlock(0, 0, 0, 0x5F6A6A);
            fin.position.set(0, 1, 0);
            fin.scale.set(0.5, 1, 0.3);
            shark.add(fin);
            
            // Tail
            const tail = createBlock(0, 0, 0, 0x5F6A6A);
            tail.position.set(-3.5, 0.5, 0);
            tail.scale.set(0.5, 1.5, 0.3);
            shark.add(tail);
            
            // Teeth (white blocks)
            for (let i = 0; i < 3; i++) {
                const tooth = createBlock(0, 0, 0, 0xFFFFFF);
                tooth.position.set(3 + i * 0.2, -0.3, 0.3);
                tooth.scale.set(0.15, 0.3, 0.15);
                shark.add(tooth);
            }
            
            // Red eye
            const eye = createBlock(0, 0, 0, 0xFF0000);
            eye.position.set(2.5, 0.3, 0.5);
            eye.scale.set(0.25, 0.25, 0.25);
            shark.add(eye);
            
            shark.position.set(x, y, z);
            shark.userData = { type: 'shark', vx: (Math.random() - 0.5) * 0.05, angle: 0 };
            scene.add(shark);
            mobs.push(shark);
        }
        
        function createVoxelWerewolfRabbit(x, y, z) {
            const werewolf = new THREE.Group();
            
            // Body (dark purple)
            for (let i = 0; i < 3; i++) {
                for (let j = 0; j < 2; j++) {
                    const block = createBlock(0, 0, 0, 0x2D1B36);
                    block.position.set(i - 1, j, 0);
                    werewolf.add(block);
                }
            }
            
            // Head
            const head = createBlock(0, 0, 0, 0x3D2B46);
            head.position.set(1.5, 2, 0);
            werewolf.add(head);
            
            // Ears (tall and pointy)
            const ear1 = createBlock(0, 0, 0, 0x3D2B46);
            ear1.position.set(1.2, 3.5, 0.3);
            ear1.scale.set(0.3, 1.5, 0.3);
            werewolf.add(ear1);
            
            const ear2 = createBlock(0, 0, 0, 0x3D2B46);
            ear2.position.set(1.8, 3.5, 0.3);
            ear2.scale.set(0.3, 1.5, 0.3);
            werewolf.add(ear2);
            
            // Glowing red eyes
            const eye1 = createBlock(0, 0, 0, 0xFF0000);
            eye1.position.set(1.8, 2.2, 0.5);
            eye1.scale.set(0.2, 0.2, 0.2);
            werewolf.add(eye1);
            
            const eye2 = createBlock(0, 0, 0, 0xFF0000);
            eye2.position.set(2.1, 2.2, 0.5);
            eye2.scale.set(0.2, 0.2, 0.2);
            werewolf.add(eye2);
            
            // Fangs
            const fang1 = createBlock(0, 0, 0, 0xFFFFFF);
            fang1.position.set(2, 1.7, 0.5);
            fang1.scale.set(0.1, 0.3, 0.1);
            werewolf.add(fang1);
            
            // Legs
            const leg1 = createBlock(0, 0, 0, 0x2D1B36);
            leg1.position.set(-0.5, -1, 0.3);
            leg1.scale.set(0.4, 1, 0.4);
            werewolf.add(leg1);
            
            const leg2 = createBlock(0, 0, 0, 0x2D1B36);
            leg2.position.set(0.5, -1, 0.3);
            leg2.scale.set(0.4, 1, 0.4);
            werewolf.add(leg2);
            
            werewolf.position.set(x, y, z);
            werewolf.userData = { type: 'werewolf', vx: (Math.random() - 0.5) * 0.03, howlTime: 0 };
            scene.add(werewolf);
            mobs.push(werewolf);
        }
        
        function createVoxelGreeter(x, y, z) {
            const greeter = new THREE.Group();
            
            // Fish-shaped sign body (rainbow colors)
            const rainbowColors = [0xFF6B6B, 0xFFA500, 0xFFFF00, 0x00FF00, 0x00BFFF, 0x8A2BE2];
            
            for (let i = 0; i < 6; i++) {
                const block = createBlock(0, 0, 0, rainbowColors[i]);
                block.position.set(i - 2.5, 0, 0);
                greeter.add(block);
            }
            
            // Top fin
            const topFin = createBlock(0, 0, 0, 0xFFD700);
            topFin.position.set(0, 1, 0);
            topFin.scale.set(0.5, 0.8, 0.3);
            greeter.add(topFin);
            
            // Eye
            const eye = createBlock(0, 0, 0, 0xFFFFFF);
            eye.position.set(2.5, 0.3, 0.5);
            eye.scale.set(0.4, 0.4, 0.4);
            greeter.add(eye);
            
            const pupil = createBlock(0, 0, 0, 0x000000);
            pupil.position.set(2.6, 0.3, 0.6);
            pupil.scale.set(0.2, 0.2, 0.2);
            greeter.add(pupil);
            
            // Sparkle blocks around it
            for (let i = 0; i < 4; i++) {
                const sparkle = createBlock(0, 0, 0, 0xFFFF00);
                sparkle.position.set(
                    Math.cos(i * Math.PI / 2) * 4,
                    Math.sin(i * Math.PI / 2) * 2,
                    0
                );
                sparkle.scale.set(0.3, 0.3, 0.3);
                sparkle.userData = { sparkleIndex: i };
                greeter.add(sparkle);
            }
            
            greeter.position.set(x, y, z);
            greeter.userData = { type: 'greeter', wobble: 0 };
            scene.add(greeter);
            mobs.push(greeter);
        }
        
        function updateCameraPosition() {
            camera.position.x = Math.sin(cameraAngle.x) * Math.cos(cameraAngle.y) * cameraDistance;
            camera.position.y = Math.sin(cameraAngle.y) * cameraDistance + 10;
            camera.position.z = Math.cos(cameraAngle.x) * Math.cos(cameraAngle.y) * cameraDistance;
            camera.lookAt(0, 5, 0);
        }
        
        function onMouseDown(event) {
            isDragging = true;
            previousMousePosition = { x: event.clientX, y: event.clientY };
        }
        
        function onMouseMove(event) {
            if (!isDragging) return;
            const deltaX = event.clientX - previousMousePosition.x;
            const deltaY = event.clientY - previousMousePosition.y;
            cameraAngle.x += deltaX * 0.01;
            cameraAngle.y = Math.max(-Math.PI / 3, Math.min(Math.PI / 3, cameraAngle.y + deltaY * 0.01));
            updateCameraPosition();
            previousMousePosition = { x: event.clientX, y: event.clientY };
        }
        
        function onMouseUp() {
            isDragging = false;
        }
        
        function onMouseWheel(event) {
            cameraDistance = Math.max(20, Math.min(100, cameraDistance + event.deltaY * 0.05));
            updateCameraPosition();
        }
        
        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }
        
        function animate() {
            requestAnimationFrame(animate);
            time += 0.016;
            
            // Animate mobs
            for (let mob of mobs) {
                if (mob.userData.type === 'fish') {
                    mob.position.x += mob.userData.vx;
                    mob.position.y = mob.userData.baseY + Math.sin(time * 2 + mob.position.x) * 2;
                    mob.rotation.y = mob.userData.vx > 0 ? 0 : Math.PI;
                    if (mob.position.x > 25) mob.position.x = -25;
                    if (mob.position.x < -25) mob.position.x = 25;
                }
                else if (mob.userData.type === 'shark') {
                    mob.userData.angle += 0.01;
                    mob.position.x = Math.cos(mob.userData.angle) * 8;
                    mob.position.z = Math.sin(mob.userData.angle) * 8;
                    mob.rotation.y = -mob.userData.angle + Math.PI / 2;
                }
                else if (mob.userData.type === 'werewolf') {
                    mob.position.x += mob.userData.vx;
                    mob.rotation.y = mob.userData.vx > 0 ? -Math.PI / 2 : Math.PI / 2;
                    if (mob.position.x > 18 || mob.position.x < -18) mob.userData.vx *= -1;
                    // Occasional jump
                    if (Math.random() < 0.005) {
                        mob.position.y += 2;
                    }
                    if (mob.position.y > 2) mob.position.y -= 0.1;
                }
                else if (mob.userData.type === 'greeter') {
                    mob.userData.wobble += 0.05;
                    mob.position.y += Math.sin(mob.userData.wobble) * 0.02;
                    mob.rotation.y += 0.01;
                    // Animate sparkles
                    mob.children.forEach((child, i) => {
                        if (child.userData && child.userData.sparkleIndex !== undefined) {
                            const idx = child.userData.sparkleIndex;
                            child.position.x = Math.cos(time * 2 + idx * Math.PI / 2) * 4;
                            child.position.y = Math.sin(time * 2 + idx * Math.PI / 2) * 2;
                        }
                    });
                }
            }
            
            // Day/night cycle (subtle)
            const dayProgress = (Math.sin(time * 0.1) + 1) / 2;
            const skyColor = new THREE.Color().lerpColors(
                new THREE.Color(0x1a1a2e),
                new THREE.Color(0x87CEEB),
                dayProgress
            );
            scene.background = skyColor;
            scene.fog.color = skyColor;
            
            // Update UI
            document.getElementById('object-count').innerHTML = 
                `<span class="minecraft-text">Blocks: ${blockCount} | Mobs: ${mobs.length}</span>`;
            
            renderer.render(scene, camera);
        }
    </script>
</body>
</html>