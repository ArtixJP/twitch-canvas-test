<!DOCTYPE html>

<html lang="en">
<head>
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' https:; script-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com https://cdn.jsdelivr.net https://unpkg.com https://esm.sh https://esm.run https://cdn.tailwindcss.com https://threejs.org https://cdn.threejs.org https://cdn.p5js.org https://code.jquery.com https://d3js.org https://cdn.plot.ly https://cdn.tonejs.org; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://fonts.gstatic.com https://cdnjs.cloudflare.com https://cdn.jsdelivr.net; img-src 'self' data: https:; media-src 'self' https:; font-src 'self' https://fonts.gstatic.com https://fonts.googleapis.com https://cdnjs.cloudflare.com https://cdn.jsdelivr.net; worker-src 'self'; frame-src https://www.youtube.com https://www.youtube-nocookie.com https://player.vimeo.com; connect-src 'self' https: wss: ws:; object-src 'none'; base-uri 'self'; form-action 'self';">
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>‚õèÔ∏è MINECRAFT 3D - BAKERY WORLD ‚õèÔ∏è</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&amp;display=swap" rel="stylesheet"/>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }

:root {
    --grass-top: #5D8C3D;
    --dirt: #8B4513;
    --stone: #808080;
    --sky-day: #87CEEB;
    --wood: #A0522D;
    --portal-purple: #8B008B;
}

body {
    font-family: 'Press Start 2P', monospace;
    background: linear-gradient(180deg, #87CEEB 0%, #B0E0E6 60%, #90EE90 60%, #228B22 100%);
    min-height: 100vh;
    overflow-x: hidden;
    image-rendering: pixelated;
    cursor: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32"><rect fill="%238B4513" x="4" y="4" width="24" height="24"/><rect fill="%23A0522D" x="8" y="8" width="16" height="16"/></svg>') 16 16, auto;
}

/* PIXEL GRID OVERLAY */
.pixel-grid {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 9999;
    background: 
        repeating-linear-gradient(0deg, transparent, transparent 31px, rgba(0,0,0,0.03) 31px, rgba(0,0,0,0.03) 32px),
        repeating-linear-gradient(90deg, transparent, transparent 31px, rgba(0,0,0,0.03) 31px, rgba(0,0,0,0.03) 32px);
}

/* MINECRAFT SKY */
.mc-sky {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(180deg, #1a1a2e 0%, #16213e 30%, #0f3460 60%, #533483 100%);
    z-index: -2;
}

/* STARS */
.star {
    position: fixed;
    width: 4px;
    height: 4px;
    background: #fff;
    animation: twinkle 2s ease-in-out infinite;
}

@keyframes twinkle {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.3; }
}

/* FLOATING BLOCKS */
.mc-block {
    position: fixed;
    width: 64px;
    height: 64px;
    image-rendering: pixelated;
    animation: blockFloat 4s ease-in-out infinite;
    z-index: 10;
    box-shadow: 4px 4px 0 rgba(0,0,0,0.3);
}

.grass-block {
    background: linear-gradient(180deg, #5D8C3D 0%, #5D8C3D 25%, #8B4513 25%, #8B4513 100%);
    border: 4px solid #3D5C2D;
}

.dirt-block {
    background: #8B4513;
    border: 4px solid #654321;
}

.stone-block {
    background: linear-gradient(135deg, #808080 25%, #696969 50%, #808080 75%);
    border: 4px solid #505050;
}

.bread-block {
    background: linear-gradient(180deg, #DAA520 0%, #D2691E 50%, #8B4513 100%);
    border: 4px solid #654321;
    border-radius: 8px;
}

@keyframes blockFloat {
    0%, 100% { transform: translateY(0) rotate(0deg); }
    50% { transform: translateY(-20px) rotate(5deg); }
}

/* GROUND LAYER */
.mc-ground {
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 128px;
    background: repeating-linear-gradient(90deg, 
        #5D8C3D 0px, #5D8C3D 64px, 
        #4A7A2D 64px, #4A7A2D 128px);
    border-top: 8px solid #3D5C2D;
    z-index: 100;
}

.mc-ground::after {
    content: '';
    position: absolute;
    top: 32px;
    left: 0;
    width: 100%;
    height: 96px;
    background: repeating-linear-gradient(90deg, 
        #8B4513 0px, #8B4513 64px, 
        #7A3A0A 64px, #7A3A0A 128px);
}

/* MAIN GAME HUD */
.mc-hud {
    position: fixed;
    bottom: 140px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 4px;
    z-index: 500;
    background: rgba(0,0,0,0.5);
    padding: 8px;
    border: 4px solid #555;
}

.hotbar-slot {
    width: 64px;
    height: 64px;
    background: #8B8B8B;
    border: 4px solid #373737;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2rem;
    cursor: pointer;
    transition: transform 0.1s;
}

.hotbar-slot:hover {
    transform: scale(1.1);
    border-color: #fff;
}

.hotbar-slot.selected {
    border-color: #fff;
    box-shadow: 0 0 10px #fff;
}

/* BAKERY BUILDING - MINECRAFT STYLE */
.mc-bakery {
    position: relative;
    width: 90%;
    max-width: 800px;
    margin: 100px auto;
    background: linear-gradient(180deg, #A0522D 0%, #8B4513 100%);
    border: 8px solid #654321;
    padding: 32px;
    z-index: 200;
    box-shadow: 8px 8px 0 rgba(0,0,0,0.4);
}

.mc-bakery::before {
    content: '';
    position: absolute;
    top: -48px;
    left: -8px;
    width: calc(100% + 16px);
    height: 48px;
    background: repeating-linear-gradient(90deg, 
        #8B0000 0px, #8B0000 32px, 
        #A52A2A 32px, #A52A2A 64px);
    clip-path: polygon(0 100%, 50% 0, 100% 100%);
    border: 4px solid #5C0000;
}

.mc-sign {
    background: #DEB887;
    border: 4px solid #8B4513;
    padding: 16px 32px;
    text-align: center;
    margin-bottom: 24px;
    box-shadow: 4px 4px 0 rgba(0,0,0,0.3);
}

.mc-sign h1 {
    color: #3D2914;
    font-size: 1rem;
    text-shadow: 2px 2px 0 #FFF8E7;
    line-height: 1.5;
}

/* ITEM DISPLAYS */
.mc-chest {
    background: #A0522D;
    border: 4px solid #654321;
    padding: 16px;
    margin: 16px 0;
}

.mc-chest-title {
    background: #8B4513;
    color: #FFF8E7;
    padding: 8px;
    font-size: 0.6rem;
    text-align: center;
    margin-bottom: 16px;
}

.mc-items {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
    gap: 16px;
}

.mc-item {
    background: #8B8B8B;
    border: 4px solid #373737;
    padding: 16px;
    text-align: center;
    cursor: pointer;
    transition: all 0.1s;
}

.mc-item:hover {
    transform: scale(1.05);
    border-color: #fff;
    box-shadow: 0 0 20px rgba(255,255,255,0.3);
}

.mc-item-icon {
    font-size: 3rem;
    margin-bottom: 8px;
    filter: drop-shadow(2px 2px 0 #000);
}

.mc-item-name {
    font-size: 0.5rem;
    color: #fff;
    text-shadow: 1px 1px 0 #000;
}

.mc-item-price {
    font-size: 0.4rem;
    color: #FFD700;
    margin-top: 4px;
}

/* FLYING CROISSANTS AS MINECRAFT ITEMS */
.mc-flying-item {
    position: fixed;
    font-size: 2rem;
    z-index: 300;
    pointer-events: none;
    animation: minecraftBob 2s ease-in-out infinite, minecraftFly 15s linear infinite;
    filter: drop-shadow(2px 2px 0 #000);
    image-rendering: pixelated;
}

@keyframes minecraftBob {
    0%, 100% { transform: translateY(0) rotate(0deg); }
    50% { transform: translateY(-10px) rotate(180deg); }
}

@keyframes minecraftFly {
    0% { left: -50px; top: 20%; }
    25% { left: 30%; top: 60%; }
    50% { left: 70%; top: 30%; }
    75% { left: 40%; top: 70%; }
    100% { left: 110%; top: 20%; }
}

/* CREEPER BAKER */
.creeper-baker {
    position: fixed;
    bottom: 140px;
    left: 30px;
    width: 64px;
    height: 96px;
    z-index: 400;
    animation: creeperWalk 8s ease-in-out infinite;
}

.creeper-head {
    width: 64px;
    height: 64px;
    background: #5D8C3D;
    border: 4px solid #3D5C2D;
    position: relative;
}

.creeper-face {
    position: absolute;
    top: 16px;
    left: 8px;
    width: 48px;
    height: 32px;
    background: 
        linear-gradient(90deg, #000 0%, #000 33%, transparent 33%, transparent 66%, #000 66%, #000 100%);
    background-size: 16px 16px;
}

.creeper-body {
    width: 32px;
    height: 32px;
    background: #5D8C3D;
    border: 4px solid #3D5C2D;
    margin: 0 auto;
}

.creeper-chef-hat {
    position: absolute;
    top: -32px;
    left: 8px;
    width: 48px;
    height: 32px;
    background: #fff;
    border: 4px solid #ddd;
    border-radius: 8px 8px 0 0;
}

@keyframes creeperWalk {
    0%, 100% { left: 30px; }
    50% { left: calc(100% - 100px); }
}

/* PORTAL - NOW CLICKABLE! */
.mc-portal-container {
    position: fixed;
    bottom: 140px;
    right: 30px;
    z-index: 400;
    cursor: pointer;
}

.mc-portal {
    width: 96px;
    height: 160px;
    background: linear-gradient(180deg, #4B0082 0%, #8B008B 50%, #4B0082 100%);
    border: 8px solid #2D0047;
    box-shadow: 0 0 30px #8B008B, inset 0 0 40px rgba(255,255,255,0.3);
    animation: portalPulse 1s ease-in-out infinite;
    position: relative;
}

.mc-portal::before {
    content: 'üçû BREAD DIMENSION';
    position: absolute;
    bottom: -40px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 0.4rem;
    color: #DA70D6;
    text-shadow: 1px 1px 0 #000;
    white-space: nowrap;
}

.mc-portal:hover {
    box-shadow: 0 0 60px #DA70D6, inset 0 0 60px rgba(255,255,255,0.6);
    transform: scale(1.1);
}

@keyframes portalPulse {
    0%, 100% { box-shadow: 0 0 30px #8B008B, inset 0 0 40px rgba(255,255,255,0.3); }
    50% { box-shadow: 0 0 50px #DA70D6, inset 0 0 50px rgba(255,255,255,0.5); }
}

/* ACHIEVEMENT POPUP */
.mc-achievement {
    position: fixed;
    top: 20px;
    left: 50%;
    transform: translateX(-50%);
    background: #222;
    border: 4px solid #555;
    padding: 16px 24px;
    display: flex;
    align-items: center;
    gap: 16px;
    z-index: 1000;
    animation: achievementSlide 5s ease-in-out;
}

.mc-achievement-icon {
    font-size: 2rem;
}

.mc-achievement-text {
    color: #fff;
}

.mc-achievement-title {
    color: #FFFF00;
    font-size: 0.5rem;
}

.mc-achievement-desc {
    font-size: 0.4rem;
    margin-top: 4px;
}

@keyframes achievementSlide {
    0% { top: -100px; opacity: 0; }
    10%, 90% { top: 20px; opacity: 1; }
    100% { top: -100px; opacity: 0; }
}

/* HEARTS (HEALTH BAR) */
.mc-health {
    position: fixed;
    top: 20px;
    left: 20px;
    display: flex;
    gap: 4px;
    z-index: 500;
}

.mc-heart {
    font-size: 1.5rem;
    filter: drop-shadow(1px 1px 0 #000);
    animation: heartBeat 1s ease-in-out infinite;
}

@keyframes heartBeat {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.1); }
}

/* HUNGER BAR */
.mc-hunger {
    position: fixed;
    top: 20px;
    right: 20px;
    display: flex;
    gap: 4px;
    z-index: 500;
}

/* EXPERIENCE BAR */
.mc-xp-bar {
    position: fixed;
    bottom: 210px;
    left: 50%;
    transform: translateX(-50%);
    width: 300px;
    height: 8px;
    background: #222;
    border: 2px solid #000;
    z-index: 500;
}

.mc-xp-fill {
    height: 100%;
    width: 75%;
    background: #7FFF00;
    animation: xpGlow 2s ease-in-out infinite;
}

@keyframes xpGlow {
    0%, 100% { box-shadow: 0 0 5px #7FFF00; }
    50% { box-shadow: 0 0 15px #7FFF00; }
}

.mc-xp-level {
    position: absolute;
    top: -20px;
    left: 50%;
    transform: translateX(-50%);
    color: #7FFF00;
    font-size: 0.6rem;
    text-shadow: 1px 1px 0 #000;
}

/* SCROLLABLE CONTENT AREA */
.mc-world {
    padding-bottom: 250px;
}

/* CHAT LOG */
.mc-chat {
    position: fixed;
    bottom: 250px;
    left: 20px;
    width: 300px;
    max-height: 150px;
    background: rgba(0,0,0,0.5);
    padding: 8px;
    font-size: 0.4rem;
    color: #fff;
    z-index: 500;
    overflow: hidden;
}

.mc-chat-msg {
    margin-bottom: 4px;
    animation: chatFade 10s linear forwards;
}

.mc-chat-msg span {
    color: #55FF55;
}

@keyframes chatFade {
    0%, 80% { opacity: 1; }
    100% { opacity: 0; }
}
</style>
</head>
<body>
<div id="game-container"></div>
<div id="crosshair">+</div>
<div id="controls-info">
<p>üéÆ WASD - Move | SPACE - Jump | MOUSE - Look</p>
<p>CLICK - Place/Break Block | E - Inventory</p>
</div>
<div class="mc-health" style="position:fixed;top:20px;left:20px;z-index:1000;display:flex;gap:4px;">
<span class="mc-heart">‚ù§Ô∏è</span>
<span class="mc-heart">‚ù§Ô∏è</span>
<span class="mc-heart">‚ù§Ô∏è</span>
<span class="mc-heart">‚ù§Ô∏è</span>
<span class="mc-heart">‚ù§Ô∏è</span>
<span class="mc-heart">‚ù§Ô∏è</span>
<span class="mc-heart">‚ù§Ô∏è</span>
<span class="mc-heart">üñ§</span>
<span class="mc-heart">üñ§</span>
<span class="mc-heart">üñ§</span>
</div>
<div class="mc-hunger" style="position:fixed;top:20px;right:20px;z-index:1000;display:flex;gap:4px;">
<span>üçû</span><span>üçû</span><span>üçû</span><span>üçû</span><span>üçû</span>
<span>üçû</span><span>üçû</span><span>ü•ñ</span><span>ü•ñ</span><span>ü•ñ</span>
</div>
<div id="bread-counter" style="position:fixed;top:60px;right:20px;z-index:1000;color:#FFD700;font-size:0.8rem;">ü•ê Bread: 0</div>
<div class="mc-hud" style="position:fixed;bottom:20px;left:50%;transform:translateX(-50%);z-index:1000;display:flex;gap:4px;background:rgba(0,0,0,0.5);padding:8px;border:4px solid #555;">
<div class="hotbar-slot selected" style="width:50px;height:50px;background:#8B8B8B;border:3px solid #fff;display:flex;align-items:center;justify-content:center;font-size:1.5rem;">üü´</div>
<div class="hotbar-slot" style="width:50px;height:50px;background:#8B8B8B;border:3px solid #373737;display:flex;align-items:center;justify-content:center;font-size:1.5rem;">üü©</div>
<div class="hotbar-slot" style="width:50px;height:50px;background:#8B8B8B;border:3px solid #373737;display:flex;align-items:center;justify-content:center;font-size:1.5rem;">‚¨ú</div>
<div class="hotbar-slot" style="width:50px;height:50px;background:#8B8B8B;border:3px solid #373737;display:flex;align-items:center;justify-content:center;font-size:1.5rem;">üü®</div>
<div class="hotbar-slot" style="width:50px;height:50px;background:#8B8B8B;border:3px solid #373737;display:flex;align-items:center;justify-content:center;font-size:1.5rem;">ü•ê</div>
<div class="hotbar-slot" style="width:50px;height:50px;background:#8B8B8B;border:3px solid #373737;display:flex;align-items:center;justify-content:center;font-size:1.5rem;">üçû</div>
<div class="hotbar-slot" style="width:50px;height:50px;background:#8B8B8B;border:3px solid #373737;display:flex;align-items:center;justify-content:center;font-size:1.5rem;">‚õèÔ∏è</div>
<div class="hotbar-slot" style="width:50px;height:50px;background:#8B8B8B;border:3px solid #373737;display:flex;align-items:center;justify-content:center;font-size:1.5rem;">üó°Ô∏è</div>
<div class="hotbar-slot" style="width:50px;height:50px;background:#8B8B8B;border:3px solid #373737;display:flex;align-items:center;justify-content:center;font-size:1.5rem;">üõ°Ô∏è</div>
</div>
<style>
#game-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; }
#crosshair { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 30px; color: white; z-index: 1000; pointer-events: none; text-shadow: 2px 2px 0 #000; }
#controls-info { position: fixed; bottom: 100px; left: 50%; transform: translateX(-50%); z-index: 1000; text-align: center; color: #fff; font-size: 0.5rem; background: rgba(0,0,0,0.7); padding: 10px 20px; border-radius: 8px; }
body { margin: 0; overflow: hidden; cursor: crosshair; }
.mc-heart { font-size: 1.2rem; }
</style>
<script>
console.log('‚õèÔ∏è 3D MINECRAFT BAKERY WORLD LOADED!');
console.log('üéÆ x100 REQUESTS FULFILLED - NOW IN 3D!');

// THREE.JS MINECRAFT CLONE
let scene, camera, renderer, player;
let blocks = [];
let breadCount = 0;
const blockSize = 1;
const worldSize = 20;

// Movement
const keys = { w: false, a: false, s: false, d: false, space: false };
let velocity = { x: 0, y: 0, z: 0 };
let onGround = true;
let selectedBlock = 0;
const blockColors = [0x8B4513, 0x228B22, 0xCCCCCC, 0xFFD700, 0xD2691E, 0xDEB887];

function init() {
    scene = new THREE.Scene();
    scene.background = new THREE.Color(0x87CEEB);
    scene.fog = new THREE.Fog(0x87CEEB, 20, 60);
    
    camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
    camera.position.set(worldSize/2, 10, worldSize/2);
    
    renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.shadowMap.enabled = true;
    document.getElementById('game-container').appendChild(renderer.domElement);
    
    // Lighting
    const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
    scene.add(ambientLight);
    const sunLight = new THREE.DirectionalLight(0xffffff, 0.8);
    sunLight.position.set(50, 100, 50);
    sunLight.castShadow = true;
    scene.add(sunLight);
    
    // Generate terrain
    generateWorld();
    
    // Build bakery structure!
    buildBakery();
    
    // Add floating bread collectibles
    addBreadCollectibles();
    
    // Player collision box
    player = { x: worldSize/2, y: 8, z: worldSize/2, yaw: 0, pitch: 0 };
    
    // Event listeners
    document.addEventListener('keydown', (e) => { keys[e.key.toLowerCase()] = true; if(e.key === ' ') e.preventDefault(); });
    document.addEventListener('keyup', (e) => keys[e.key.toLowerCase()] = false);
    document.addEventListener('click', onClick);
    document.addEventListener('mousemove', onMouseMove);
    document.addEventListener('pointerlockchange', () => {});
    renderer.domElement.addEventListener('click', () => renderer.domElement.requestPointerLock());
    window.addEventListener('resize', onResize);
    
    // Hotbar selection
    document.querySelectorAll('.hotbar-slot').forEach((slot, i) => {
        slot.addEventListener('click', (e) => {
            e.stopPropagation();
            document.querySelectorAll('.hotbar-slot').forEach(s => s.style.borderColor = '#373737');
            slot.style.borderColor = '#fff';
            selectedBlock = i;
        });
    });
    
    animate();
}

function generateWorld() {
    const geometry = new THREE.BoxGeometry(blockSize, blockSize, blockSize);
    
    for (let x = 0; x < worldSize; x++) {
        for (let z = 0; z < worldSize; z++) {
            const height = Math.floor(Math.sin(x * 0.3) * Math.cos(z * 0.3) * 2) + 3;
            for (let y = 0; y <= height; y++) {
                let color = y === height ? 0x228B22 : (y > height - 2 ? 0x8B4513 : 0x808080);
                const material = new THREE.MeshLambertMaterial({ color });
                const block = new THREE.Mesh(geometry, material);
                block.position.set(x, y, z);
                block.castShadow = true;
                block.receiveShadow = true;
                scene.add(block);
                blocks.push(block);
            }
        }
    }
}

function buildBakery() {
    const geometry = new THREE.BoxGeometry(blockSize, blockSize, blockSize);
    const woodMat = new THREE.MeshLambertMaterial({ color: 0xA0522D });
    const stoneMat = new THREE.MeshLambertMaterial({ color: 0x808080 });
    const breadMat = new THREE.MeshLambertMaterial({ color: 0xD2691E });
    
    // Bakery walls
    for (let y = 5; y < 10; y++) {
        for (let x = 5; x < 12; x++) {
            if (y === 5 || y === 9 || x === 5 || x === 11) {
                const block = new THREE.Mesh(geometry, woodMat.clone());
                block.position.set(x, y, 5);
                scene.add(block);
                blocks.push(block);
                const block2 = new THREE.Mesh(geometry, woodMat.clone());
                block2.position.set(x, y, 10);
                scene.add(block2);
                blocks.push(block2);
            }
        }
        const sideBlock1 = new THREE.Mesh(geometry, woodMat.clone());
        sideBlock1.position.set(5, y, 7);
        scene.add(sideBlock1);
        blocks.push(sideBlock1);
        const sideBlock2 = new THREE.Mesh(geometry, woodMat.clone());
        sideBlock2.position.set(11, y, 7);
        scene.add(sideBlock2);
        blocks.push(sideBlock2);
    }
    
    // Bakery sign (bread block on top)
    const signBlock = new THREE.Mesh(geometry, breadMat);
    signBlock.position.set(8, 10, 5);
    scene.add(signBlock);
    blocks.push(signBlock);
}

function addBreadCollectibles() {
    const breadGeom = new THREE.BoxGeometry(0.5, 0.3, 0.5);
    const breadMat = new THREE.MeshLambertMaterial({ color: 0xDAA520 });
    
    for (let i = 0; i < 10; i++) {
        const bread = new THREE.Mesh(breadGeom, breadMat);
        bread.position.set(
            Math.random() * worldSize,
            6 + Math.random() * 3,
            Math.random() * worldSize
        );
        bread.userData.isBread = true;
        bread.userData.bobOffset = Math.random() * Math.PI * 2;
        scene.add(bread);
        blocks.push(bread);
    }
}

function onMouseMove(e) {
    if (document.pointerLockElement) {
        player.yaw -= e.movementX * 0.002;
        player.pitch -= e.movementY * 0.002;
        player.pitch = Math.max(-Math.PI/2 + 0.1, Math.min(Math.PI/2 - 0.1, player.pitch));
    }
}

function onClick(e) {
    if (!document.pointerLockElement) return;
    
    const raycaster = new THREE.Raycaster();
    raycaster.setFromCamera({ x: 0, y: 0 }, camera);
    const intersects = raycaster.intersectObjects(blocks);
    
    if (intersects.length > 0) {
        const hit = intersects[0];
        if (hit.object.userData.isBread) {
            // Collect bread!
            scene.remove(hit.object);
            blocks = blocks.filter(b => b !== hit.object);
            breadCount++;
            document.getElementById('bread-counter').textContent = 'ü•ê Bread: ' + breadCount;
        } else if (e.button === 0 && selectedBlock < 4) {
            // Place block
            const normal = hit.face.normal;
            const pos = hit.object.position.clone().add(normal);
            const geometry = new THREE.BoxGeometry(blockSize, blockSize, blockSize);
            const material = new THREE.MeshLambertMaterial({ color: blockColors[selectedBlock] });
            const newBlock = new THREE.Mesh(geometry, material);
            newBlock.position.copy(pos);
            newBlock.castShadow = true;
            scene.add(newBlock);
            blocks.push(newBlock);
        } else if (e.button === 2 || selectedBlock === 6) {
            // Break block
            scene.remove(hit.object);
            blocks = blocks.filter(b => b !== hit.object);
        }
    }
}

function onResize() {
    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
}

function animate() {
    requestAnimationFrame(animate);
    
    // Movement
    const speed = 0.15;
    const dir = { x: 0, z: 0 };
    
    if (keys.w) { dir.x += Math.sin(player.yaw); dir.z += Math.cos(player.yaw); }
    if (keys.s) { dir.x -= Math.sin(player.yaw); dir.z -= Math.cos(player.yaw); }
    if (keys.a) { dir.x += Math.cos(player.yaw); dir.z -= Math.sin(player.yaw); }
    if (keys.d) { dir.x -= Math.cos(player.yaw); dir.z += Math.sin(player.yaw); }
    
    player.x += dir.x * speed;
    player.z += dir.z * speed;
    
    // Gravity & Jump
    if (keys.space && onGround) { velocity.y = 0.25; onGround = false; }
    velocity.y -= 0.015;
    player.y += velocity.y;
    
    if (player.y < 6) { player.y = 6; velocity.y = 0; onGround = true; }
    
    // Update camera
    camera.position.set(player.x, player.y, player.z);
    camera.rotation.order = 'YXZ';
    camera.rotation.y = player.yaw;
    camera.rotation.x = player.pitch;
    
    // Animate bread collectibles
    const time = Date.now() * 0.003;
    blocks.forEach(b => {
        if (b.userData.isBread) {
            b.position.y = 6 + Math.sin(time + b.userData.bobOffset) * 0.3;
            b.rotation.y += 0.02;
        }
    });
    
    renderer.render(scene, camera);
}

// Start the game!
init();

// Number keys for hotbar in 3D mode
document.addEventListener('keydown', (e) => {
    if (e.key >= '1' && e.key <= '9') {
        const slots = document.querySelectorAll('.hotbar-slot');
        slots.forEach(s => s.style.borderColor = '#373737');
        if (slots[parseInt(e.key) - 1]) {
            slots[parseInt(e.key) - 1].style.borderColor = '#fff';
            selectedBlock = parseInt(e.key) - 1;
        }
    }
});
</script>
</body>
</html>