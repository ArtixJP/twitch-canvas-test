<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Sparky's Magical Flight - Physics Game</title>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&amp;family=Nunito:wght@400;700&amp;display=swap" rel="stylesheet"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>
<style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }
    
    body { 
        font-family: 'Nunito', sans-serif; 
        min-height: 100vh; 
        background: linear-gradient(180deg, #1a0a2e 0%, #3d1a5c 40%, #6b2d8a 70%, #2d1f3d 100%);
        color: white;
        overflow: hidden;
    }
    
    #game-container {
        position: relative;
        width: 100vw;
        height: 100vh;
    }
    
    #game-canvas {
        position: absolute;
        top: 0;
        left: 0;
    }
    
    .game-ui {
        position: fixed;
        top: 20px;
        left: 20px;
        z-index: 100;
        background: linear-gradient(145deg, rgba(74, 26, 107, 0.9), rgba(45, 31, 61, 0.9));
        padding: 15px 25px;
        border-radius: 15px;
        border: 2px solid #9b30ff;
        box-shadow: 0 0 20px rgba(155, 48, 255, 0.5);
    }
    
    .game-ui h1 {
        font-family: 'Press Start 2P', cursive;
        font-size: 0.8rem;
        color: #e0b0ff;
        margin-bottom: 10px;
        text-shadow: 2px 2px 0 #000;
    }
    
    .score {
        font-family: 'Press Start 2P', cursive;
        font-size: 0.7rem;
        color: #ffb3ff;
    }
    
    .instructions {
        position: fixed;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        z-index: 100;
        background: linear-gradient(145deg, rgba(74, 26, 107, 0.9), rgba(45, 31, 61, 0.9));
        padding: 15px 30px;
        border-radius: 15px;
        border: 2px solid #bf5fff;
        text-align: center;
        box-shadow: 0 0 20px rgba(191, 95, 255, 0.4);
    }
    
    .instructions p {
        font-size: 0.85rem;
        color: #ddd;
        margin: 5px 0;
    }
    
    .instructions span {
        font-family: 'Press Start 2P', cursive;
        font-size: 0.6rem;
        color: #e0b0ff;
    }
    
    .magic-burst {
        position: fixed;
        pointer-events: none;
        width: 100px;
        height: 100px;
        border-radius: 50%;
        background: radial-gradient(circle, rgba(224, 102, 255, 0.8), transparent);
        animation: burst 0.5s ease-out forwards;
        z-index: 50;
    }
    
    @keyframes burst {
        0% { transform: scale(0); opacity: 1; }
        100% { transform: scale(3); opacity: 0; }
    }
    
    .fire-power {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 100;
        background: linear-gradient(145deg, rgba(74, 26, 107, 0.9), rgba(45, 31, 61, 0.9));
        padding: 15px 20px;
        border-radius: 15px;
        border: 2px solid #ff6b35;
        box-shadow: 0 0 20px rgba(255, 107, 53, 0.5);
    }
    
    .fire-power span {
        font-family: 'Press Start 2P', cursive;
        font-size: 0.6rem;
        color: #ffb3ff;
    }
    
    .fire-bar {
        width: 150px;
        height: 15px;
        background: #2d1f3d;
        border-radius: 10px;
        margin-top: 8px;
        overflow: hidden;
    }
    
    .fire-fill {
        height: 100%;
        background: linear-gradient(90deg, #ff6b35, #ff9500, #ffcc00);
        border-radius: 10px;
        transition: width 0.1s;
        box-shadow: 0 0 10px #ff6b35;
    }
</style>
</head>
<body>
<div id="game-container">
<canvas id="game-canvas"></canvas>
</div>
<div class="game-ui">
<h1>üêâ SPARKY'S FLIGHT</h1>
<p class="score">MAGIC ORBS: <span id="score">0</span></p>
</div>
<div class="fire-power">
<span>üî• FIRE POWER</span>
<div class="fire-bar">
<div class="fire-fill" id="fire-fill" style="width: 100%"></div>
</div>
</div>
<div class="instructions">
<span>HOW TO PLAY</span>
<p>‚¨ÜÔ∏è‚¨áÔ∏è‚¨ÖÔ∏è‚û°Ô∏è or WASD to fly Sparky</p>
<p>SPACE to breathe purple fire!</p>
<p>Collect ‚ú® magic orbs and avoid üíÄ dark crystals!</p>
</div>
<script>
(function() {
    const Engine = Matter.Engine,
          Render = Matter.Render,
          Runner = Matter.Runner,
          Bodies = Matter.Bodies,
          Body = Matter.Body,
          Composite = Matter.Composite,
          Events = Matter.Events,
          Vector = Matter.Vector;

    const canvas = document.getElementById('game-canvas');
    const width = window.innerWidth;
    const height = window.innerHeight;

    const engine = Engine.create();
    engine.gravity.y = 0.3;

    const render = Render.create({
        canvas: canvas,
        engine: engine,
        options: {
            width: width,
            height: height,
            wireframes: false,
            background: 'transparent'
        }
    });

    // Sparky the Dragon
    const sparky = Bodies.circle(width / 2, height / 2, 30, {
        restitution: 0.5,
        friction: 0.01,
        frictionAir: 0.02,
        render: {
            sprite: {
                texture: 'data:image/svg+xml,' + encodeURIComponent(`
                    <svg xmlns="http://www.w3.org/2000/svg" width="80" height="80" viewBox="0 0 80 80">
                        <defs>
                            <radialGradient id="body" cx="50%" cy="50%" r="50%">
                                <stop offset="0%" style="stop-color:#bf5fff"/>
                                <stop offset="100%" style="stop-color:#6b2d8a"/>
                            </radialGradient>
                            <filter id="glow">
                                <feGaussianBlur stdDeviation="3" result="coloredBlur"/>
                                <feMerge><feMergeNode in="coloredBlur"/><feMergeNode in="SourceGraphic"/></feMerge>
                            </filter>
                        </defs>
                        <ellipse cx="40" cy="45" rx="25" ry="20" fill="url(#body)" filter="url(#glow)"/>
                        <ellipse cx="40" cy="35" rx="18" ry="15" fill="#9b30ff"/>
                        <circle cx="33" cy="32" r="5" fill="white"/>
                        <circle cx="47" cy="32" r="5" fill="white"/>
                        <circle cx="34" cy="33" r="2.5" fill="#1a0a2e"/>
                        <circle cx="48" cy="33" r="2.5" fill="#1a0a2e"/>
                        <ellipse cx="40" cy="42" rx="3" ry="2" fill="#ff6b9d"/>
                        <path d="M20 45 Q10 35 15 25 Q20 30 25 40" fill="#9b30ff"/>
                        <path d="M60 45 Q70 35 65 25 Q60 30 55 40" fill="#9b30ff"/>
                        <path d="M30 22 L28 12 L35 20" fill="#e066ff"/>
                        <path d="M50 22 L52 12 L45 20" fill="#e066ff"/>
                        <ellipse cx="40" cy="60" rx="8" ry="5" fill="#bf5fff"/>
                    </svg>
                `),
                xScale: 0.75,
                yScale: 0.75
            }
        },
        label: 'sparky'
    });

    // Walls
    const walls = [
        Bodies.rectangle(width / 2, -25, width, 50, { isStatic: true, render: { fillStyle: '#1a0a2e' } }),
        Bodies.rectangle(width / 2, height + 25, width, 50, { isStatic: true, render: { fillStyle: '#1a0a2e' } }),
        Bodies.rectangle(-25, height / 2, 50, height, { isStatic: true, render: { fillStyle: '#1a0a2e' } }),
        Bodies.rectangle(width + 25, height / 2, 50, height, { isStatic: true, render: { fillStyle: '#1a0a2e' } })
    ];

    Composite.add(engine.world, [sparky, ...walls]);

    // Game state
    let score = 0;
    let firePower = 100;
    const keys = {};
    const orbs = [];
    const crystals = [];
    const fireballs = [];

    // Create magic orb
    function createOrb() {
        const x = Math.random() * (width - 100) + 50;
        const y = Math.random() * (height - 200) + 50;
        const orb = Bodies.circle(x, y, 15, {
            isStatic: true,
            isSensor: true,
            render: {
                fillStyle: '#ffcc00',
                strokeStyle: '#ff9500',
                lineWidth: 3
            },
            label: 'orb'
        });
        orbs.push(orb);
        Composite.add(engine.world, orb);
    }

    // Create dark crystal
    function createCrystal() {
        const x = Math.random() * (width - 100) + 50;
        const y = Math.random() * (height - 200) + 50;
        const crystal = Bodies.polygon(x, y, 6, 20, {
            isStatic: true,
            isSensor: true,
            render: {
                fillStyle: '#4a0080',
                strokeStyle: '#8b00ff',
                lineWidth: 2
            },
            label: 'crystal'
        });
        crystals.push(crystal);
        Composite.add(engine.world, crystal);
    }

    // Create fireball
    function createFireball() {
        if (firePower < 10) return;
        firePower -= 10;
        
        const angle = sparky.angle;
        const velocity = Vector.rotate({ x: 15, y: 0 }, angle);
        
        const fireball = Bodies.circle(sparky.position.x + velocity.x * 2, sparky.position.y + velocity.y * 2, 12, {
            restitution: 0.8,
            friction: 0,
            frictionAir: 0,
            render: {
                fillStyle: '#bf5fff',
                strokeStyle: '#e066ff',
                lineWidth: 4
            },
            label: 'fireball'
        });
        
        Body.setVelocity(fireball, velocity);
        fireballs.push({ body: fireball, life: 150 });
        Composite.add(engine.world, fireball);
    }

    // Initial orbs and crystals
    for (let i = 0; i < 8; i++) createOrb();
    for (let i = 0; i < 4; i++) createCrystal();

    // Spawn new items periodically
    setInterval(() => {
        if (orbs.length < 10) createOrb();
    }, 2000);

    setInterval(() => {
        if (crystals.length < 6) createCrystal();
    }, 4000);

    // Regenerate fire power
    setInterval(() => {
        if (firePower < 100) firePower += 2;
        document.getElementById('fire-fill').style.width = firePower + '%';
    }, 100);

    // Controls
    document.addEventListener('keydown', (e) => {
        keys[e.key.toLowerCase()] = true;
        if (e.code === 'Space') {
            e.preventDefault();
            createFireball();
        }
    });

    document.addEventListener('keyup', (e) => {
        keys[e.key.toLowerCase()] = false;
    });

    // Game loop
    Events.on(engine, 'beforeUpdate', () => {
        const force = 0.003;
        
        if (keys['w'] || keys['arrowup']) {
            Body.applyForce(sparky, sparky.position, { x: 0, y: -force });
        }
        if (keys['s'] || keys['arrowdown']) {
            Body.applyForce(sparky, sparky.position, { x: 0, y: force });
        }
        if (keys['a'] || keys['arrowleft']) {
            Body.applyForce(sparky, sparky.position, { x: -force, y: 0 });
            Body.setAngle(sparky, -0.2);
        }
        if (keys['d'] || keys['arrowright']) {
            Body.applyForce(sparky, sparky.position, { x: force, y: 0 });
            Body.setAngle(sparky, 0.2);
        }
        
        if (!keys['a'] && !keys['arrowleft'] && !keys['d'] && !keys['arrowright']) {
            Body.setAngle(sparky, sparky.angle * 0.9);
        }

        // Update fireballs
        for (let i = fireballs.length - 1; i >= 0; i--) {
            fireballs[i].life--;
            if (fireballs[i].life <= 0) {
                Composite.remove(engine.world, fireballs[i].body);
                fireballs.splice(i, 1);
            }
        }
    });

    // Collision detection
    Events.on(engine, 'collisionStart', (event) => {
        event.pairs.forEach((pair) => {
            const labels = [pair.bodyA.label, pair.bodyB.label];
            
            // Sparky collects orb
            if (labels.includes('sparky') && labels.includes('orb')) {
                const orb = pair.bodyA.label === 'orb' ? pair.bodyA : pair.bodyB;
                const index = orbs.indexOf(orb);
                if (index > -1) {
                    orbs.splice(index, 1);
                    Composite.remove(engine.world, orb);
                    score++;
                    document.getElementById('score').textContent = score;
                    createMagicBurst(orb.position.x, orb.position.y);
                }
            }
            
            // Sparky hits crystal
            if (labels.includes('sparky') && labels.includes('crystal')) {
                if (score > 0) score--;
                document.getElementById('score').textContent = score;
                Body.setVelocity(sparky, { x: -sparky.velocity.x * 2, y: -sparky.velocity.y * 2 });
            }
            
            // Fireball destroys crystal
            if (labels.includes('fireball') && labels.includes('crystal')) {
                const crystal = pair.bodyA.label === 'crystal' ? pair.bodyA : pair.bodyB;
                const fireball = pair.bodyA.label === 'fireball' ? pair.bodyA : pair.bodyB;
                
                const crystalIndex = crystals.indexOf(crystal);
                if (crystalIndex > -1) {
                    crystals.splice(crystalIndex, 1);
                    Composite.remove(engine.world, crystal);
                    createMagicBurst(crystal.position.x, crystal.position.y);
                    score += 2;
                    document.getElementById('score').textContent = score;
                }
                
                const fireballObj = fireballs.find(f => f.body === fireball);
                if (fireballObj) {
                    fireballObj.life = 0;
                }
            }
        });
    });

    function createMagicBurst(x, y) {
        const burst = document.createElement('div');
        burst.className = 'magic-burst';
        burst.style.left = (x - 50) + 'px';
        burst.style.top = (y - 50) + 'px';
        document.body.appendChild(burst);
        setTimeout(() => burst.remove(), 500);
    }

    // Draw additional effects
    Events.on(render, 'afterRender', () => {
        const ctx = render.context;
        
        // Draw sparkles around orbs
        orbs.forEach(orb => {
            const time = Date.now() * 0.005;
            ctx.save();
            ctx.globalAlpha = 0.6 + Math.sin(time) * 0.4;
            ctx.shadowColor = '#ffcc00';
            ctx.shadowBlur = 20;
            ctx.beginPath();
            ctx.arc(orb.position.x, orb.position.y, 20 + Math.sin(time) * 5, 0, Math.PI * 2);
            ctx.strokeStyle = '#ffcc00';
            ctx.lineWidth = 2;
            ctx.stroke();
            ctx.restore();
            
            // Draw star emoji
            ctx.font = '20px serif';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText('‚ú®', orb.position.x, orb.position.y);
        });
        
        // Draw crystal effects
        crystals.forEach(crystal => {
            ctx.font = '25px serif';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText('üíÄ', crystal.position.x, crystal.position.y);
        });
        
        // Draw fire trail on fireballs
        fireballs.forEach(fb => {
            ctx.save();
            ctx.shadowColor = '#bf5fff';
            ctx.shadowBlur = 30;
            ctx.beginPath();
            ctx.arc(fb.body.position.x, fb.body.position.y, 15, 0, Math.PI * 2);
            ctx.fillStyle = 'rgba(191, 95, 255, 0.5)';
            ctx.fill();
            ctx.restore();
            
            ctx.font = '18px serif';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText('üî•', fb.body.position.x, fb.body.position.y);
        });

        // Draw background stars
        ctx.save();
        for (let i = 0; i < 50; i++) {
            const x = (i * 137.5) % width;
            const y = (i * 73.3) % height;
            const size = 1 + (i % 3);
            const alpha = 0.3 + Math.sin(Date.now() * 0.002 + i) * 0.3;
            ctx.globalAlpha = alpha;
            ctx.fillStyle = 'white';
            ctx.beginPath();
            ctx.arc(x, y, size, 0, Math.PI * 2);
            ctx.fill();
        }
        ctx.restore();
    });

    Render.run(render);
    const runner = Runner.create();
    Runner.run(runner, engine);

    // Handle resize
    window.addEventListener('resize', () => {
        render.canvas.width = window.innerWidth;
        render.canvas.height = window.innerHeight;
        render.options.width = window.innerWidth;
        render.options.height = window.innerHeight;
    });
})();
</script>
</body>
</html>