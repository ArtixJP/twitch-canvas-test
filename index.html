<!DOCTYPE html>

<html lang="fr">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<title>
   Hello World - Mode Dual
  </title>
<link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@300;700&amp;family=Orbitron:wght@400;900&amp;display=swap" rel="stylesheet"/>
<style>
   *{margin:0;padding:0;box-sizing:border-box;transition:all .3s}
body{min-height:100vh;display:flex;flex-direction:column;align-items:center;font-family:'Comfortaa',cursive;position:relative;overflow-x:hidden;padding:2rem 0}
body.warm-mode{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;background-attachment:fixed}
body.warm-mode::before{content:'';position:fixed;top:0;left:0;width:200%;height:200%;background:radial-gradient(circle,rgba(255,255,255,.1) 1px,transparent 1px);background-size:50px 50px;animation:drift 20s linear infinite;pointer-events:none}
body.twitch-mode{background:#0e0e10;color:#efeff1;font-family:'Orbitron',monospace}
body.twitch-mode::before{content:'';position:fixed;inset:0;background:repeating-linear-gradient(0deg,transparent,transparent 2px,rgba(147,51,234,.03) 2px,rgba(147,51,234,.03) 4px),repeating-linear-gradient(90deg,transparent,transparent 2px,rgba(147,51,234,.03) 2px,rgba(147,51,234,.03) 4px);animation:scanlines 8s linear infinite;pointer-events:none}
body.twitch-mode::after{content:'';position:fixed;inset:0;background:linear-gradient(180deg,transparent,rgba(147,51,234,.2) 50%,transparent);animation:scan 4s linear infinite;pointer-events:none}
.container{text-align:center;z-index:10;padding:2rem;width:100%;max-width:1200px;margin:0 auto;margin-left:80px}
h1{font-size:clamp(2rem,8vw,4rem);margin-bottom:2rem}
body.warm-mode h1{text-shadow:0 0 30px rgba(255,255,255,.5);animation:float 3s ease-in-out infinite}
body.twitch-mode h1{text-transform:uppercase;letter-spacing:.2em;background:linear-gradient(45deg,#9333ea,#ec4899,#f59e0b,#9333ea);background-size:300% 300%;-webkit-background-clip:text;-webkit-text-fill-color:transparent;animation:gradient 3s ease infinite,glitch 2s ease-in-out infinite alternate}
.subtitle{font-size:1.2rem;opacity:.8;margin-bottom:3rem}
body.twitch-mode .subtitle{font-family:monospace;color:#bf94ff;text-shadow:0 0 10px #9333ea}
.theme-toggle,.confetti-btn,.music-btn{background:rgba(255,255,255,.2);border:none;padding:1rem 2rem;border-radius:50px;cursor:pointer;font-size:1rem;color:inherit;backdrop-filter:blur(10px);position:relative;overflow:hidden;margin:.5rem}
body.twitch-mode .theme-toggle{background:#1f1f23;border:2px solid #9333ea;color:#efeff1;text-transform:uppercase;letter-spacing:.1em;font-family:'Orbitron',monospace}
.theme-toggle:hover,.confetti-btn:hover,.music-btn:hover{transform:translateY(-2px) scale(1.05);box-shadow:0 10px 30px rgba(0,0,0,.2)}
.confetti-btn{background:linear-gradient(45deg,#ff6b35,#f7931e,#ffcc00);color:#fff;box-shadow:0 0 20px rgba(255,107,53,.5);animation:firePulse 1.5s ease-in-out infinite}
.music-btn{background:linear-gradient(45deg,#7dd3c0,#5cb8a5,#3d9d8b);color:#fff;box-shadow:0 0 20px rgba(93,184,165,.5);animation:musicPulse 2s ease-in-out infinite}
.music-btn.playing{background:linear-gradient(45deg,#ff9a9e,#fecfef);animation:musicPulse 2s ease-in-out infinite,gradient 3s ease infinite}
.sidebar{position:fixed;left:0;top:0;height:100vh;width:70px;background:rgba(255,255,255,.1);backdrop-filter:blur(20px);border-right:1px solid rgba(255,255,255,.2);display:flex;flex-direction:column;align-items:center;padding:2rem 0;z-index:1000;transition:width .4s cubic-bezier(.4,0,.2,1);box-shadow:4px 0 30px rgba(0,0,0,.1)}
body.twitch-mode .sidebar{background:rgba(14,14,16,.9);border-right:1px solid #9333ea;box-shadow:4px 0 30px rgba(147,51,234,.2)}
.sidebar:hover{width:200px}
.sidebar-logo{font-size:2rem;margin-bottom:3rem;animation:float 3s ease-in-out infinite}
.sidebar-nav{display:flex;flex-direction:column;gap:.5rem;width:100%}
.sidebar-item{display:flex;align-items:center;padding:1rem;color:inherit;text-decoration:none;border-radius:0 25px 25px 0;margin-right:10px;cursor:pointer;position:relative;overflow:hidden}
.sidebar-item::before{content:'';position:absolute;left:0;top:0;height:100%;width:3px;background:linear-gradient(180deg,#9333ea,#ec4899);transform:scaleY(0);transition:transform .3s}
.sidebar-item:hover::before,.sidebar-item.active::before{transform:scaleY(1)}
.sidebar-item:hover{background:rgba(255,255,255,.1);transform:translateX(5px)}
body.twitch-mode .sidebar-item:hover{background:rgba(147,51,234,.2);box-shadow:0 0 20px rgba(147,51,234,.3)}
.sidebar-item.active{background:rgba(255,255,255,.15)}
body.twitch-mode .sidebar-item.active{background:rgba(147,51,234,.3)}
.sidebar-icon{font-size:1.5rem;min-width:40px;text-align:center;transition:transform .3s}
.sidebar-item:hover .sidebar-icon{transform:scale(1.2) rotate(10deg)}
.sidebar-label{white-space:nowrap;opacity:0;transform:translateX(-10px);transition:all .3s;font-size:.9rem}
.sidebar:hover .sidebar-label{opacity:1;transform:translateX(0)}
.sidebar-divider{width:40px;height:1px;background:linear-gradient(90deg,transparent,rgba(255,255,255,.3),transparent);margin:1rem 0}
.sidebar:hover .sidebar-divider{width:80%}
.sidebar-footer{margin-top:auto}
.sidebar-theme-btn{width:40px;height:40px;border-radius:50%;border:none;background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;font-size:1.2rem;cursor:pointer;display:flex;align-items:center;justify-content:center}
.sidebar-theme-btn:hover{transform:scale(1.1) rotate(180deg);box-shadow:0 0 20px rgba(102,126,234,.5)}
body.twitch-mode .sidebar-theme-btn{background:linear-gradient(135deg,#9333ea,#ec4899)}
.main-menu{margin-bottom:3rem;background:rgba(255,255,255,.1);backdrop-filter:blur(10px);border-radius:25px;padding:.5rem;box-shadow:0 8px 32px rgba(0,0,0,.1);position:sticky;top:1rem;z-index:100}
body.twitch-mode .main-menu{background:rgba(31,31,35,.8);border:1px solid #9333ea}
.main-menu ul{list-style:none;display:flex;justify-content:center;gap:1rem;flex-wrap:wrap}
.menu-item{text-decoration:none;color:inherit;padding:.7rem 1.5rem;border-radius:20px;display:inline-block;position:relative;overflow:hidden}
.menu-item.active{background:rgba(255,255,255,.2);box-shadow:0 4px 15px rgba(0,0,0,.1)}
body.twitch-mode .menu-item{text-transform:uppercase;font-family:'Orbitron',monospace;font-size:.9rem}
body.twitch-mode .menu-item.active{background:#9333ea;box-shadow:0 0 20px #9333ea}
.page{display:none;animation:pageTransition .5s ease}
.page.active{display:block}
.games-grid,.art-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:2rem;margin:2rem 0}
.game-card,.stat-card{background:rgba(255,255,255,.1);backdrop-filter:blur(10px);border-radius:15px;padding:1.5rem;cursor:pointer;text-align:center}
body.twitch-mode .game-card,body.twitch-mode .stat-card{background:rgba(31,31,35,.8);border:1px solid #9333ea}
.game-card:hover{transform:translateY(-5px) scale(1.05);box-shadow:0 10px 30px rgba(0,0,0,.3)}
body.twitch-mode .game-card:hover{box-shadow:0 0 30px #9333ea}
.game-card h3{margin-bottom:.5rem;font-size:1.3rem}
.game-card p,.stat-card p{opacity:.7;font-size:.9rem}
.about-content{max-width:600px;margin:0 auto;text-align:center}
.glowing-text{font-size:1.5rem;margin-bottom:1rem;animation:glow 2s ease-in-out infinite}
.stats{display:flex;justify-content:center;gap:2rem;margin-top:3rem;flex-wrap:wrap}
.stat-card h3{font-size:2.5rem;margin-bottom:.5rem;color:#9333ea}
body.warm-mode .stat-card h3{color:#667eea}
.art-piece{height:250px;border-radius:15px;overflow:hidden;position:relative;cursor:pointer}
.art-piece:hover{transform:scale(1.05);box-shadow:0 10px 40px rgba(0,0,0,.3)}
#art1{background:linear-gradient(45deg,#667eea,#764ba2,#f093fb,#4facfe);background-size:400% 400%;animation:gradient 10s ease infinite}
#art2{background:#000;box-shadow:inset 0 0 50px rgba(147,51,234,.5)}
#art3{background:repeating-conic-gradient(from 0deg at 50% 50%,#9333ea 0deg,#ec4899 60deg,#06b6d4 120deg,#9333ea 180deg);animation:spin 20s linear infinite}
#art4{background:radial-gradient(circle at 50% 50%,#fff 0%,transparent 50%),radial-gradient(circle at 80% 20%,#9333ea 0%,transparent 50%),radial-gradient(circle at 20% 80%,#ec4899 0%,transparent 50%),#0e0e10}
#art5{background:linear-gradient(135deg,#ffecd2,#fcb69f);display:flex;align-items:center;justify-content:center;flex-direction:column;font-family:monospace}
#llamaArt{font-size:8px;line-height:1;color:#5d4e37;text-shadow:1px 1px 2px rgba(0,0,0,.2);animation:llamaBounce 2s ease-in-out infinite}
#art5:hover #llamaArt{animation:llamaDance .5s ease-in-out infinite;color:#9333ea}
.mini-monster{position:fixed;bottom:20px;right:20px;width:100px;height:100px;background:#ffcc00;border-radius:50%;display:flex;align-items:center;justify-content:center;box-shadow:0 4px 20px rgba(0,0,0,.2);animation:bounce 2s infinite;cursor:pointer}
.monster-speech{position:fixed;bottom:120px;right:40px;background:rgba(255,255,255,.9);border-radius:15px;padding:10px;box-shadow:0 4px 20px rgba(0,0,0,.2);animation:fadeIn 1s}
.red-button{margin-top:2rem;background:red;color:#fff;border:none;padding:1rem 2rem;border-radius:50px;cursor:pointer;font-size:1rem}
.red-button:hover{transform:scale(1.05);box-shadow:0 4px 20px rgba(255,0,0,.5)}
#santa-sleigh{position:fixed;top:-100px;left:-200px;z-index:9999;pointer-events:none;font-size:3rem;animation:santaZigzag 12s linear infinite}
#easter-egg-hint{position:fixed;bottom:10px;left:10px;font-size:10px;opacity:.4;font-family:monospace;z-index:50;pointer-events:none;max-width:200px;line-height:1.4}
canvas{border-radius:15px}
#snakeCanvas{border:2px solid #9333ea;background:#1a1a1d;box-shadow:0 0 30px rgba(147,51,234,.5);display:none}
#pongCanvas{border:2px solid #ec4899;background:#1a1a1d;box-shadow:0 0 30px rgba(236,72,153,.5);display:none}
#particlesCanvas{border:2px solid #06b6d4;background:#000;box-shadow:0 0 30px rgba(6,182,212,.5);display:none}
#lutinCanvas{border:2px solid #ffd700;background:linear-gradient(180deg,#87ceeb,#98fb98);box-shadow:0 0 30px rgba(255,215,0,.5);display:none}
#gameControls{margin-top:1rem}
#gameControls p{color:#bf94ff;font-family:'Orbitron',monospace;font-size:.9rem}
.sparkle,.fire-confetti{position:fixed;pointer-events:none;z-index:10000}
@keyframes drift{0%{transform:translate(-50%,-50%) rotate(0)}100%{transform:translate(-50%,-50%) rotate(360deg)}}
@keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-20px)}}
@keyframes gradient{0%{background-position:0 50%}50%{background-position:100% 50%}100%{background-position:0 50%}}
@keyframes glitch{0%{text-shadow:2px 0 #f59e0b,-2px 0 #06b6d4}50%{text-shadow:2px 0 #06b6d4,-2px 0 #f59e0b}100%{text-shadow:2px 0 #f59e0b,-2px 0 #06b6d4}}
@keyframes scanlines{0%{background-position:0 0}100%{background-position:0 10px}}
@keyframes scan{0%{transform:translateY(-100%)}100%{transform:translateY(100%)}}
@keyframes firePulse{0%,100%{box-shadow:0 0 20px rgba(255,107,53,.5),0 0 40px rgba(247,147,30,.3)}50%{box-shadow:0 0 40px rgba(255,107,53,.8),0 0 60px rgba(247,147,30,.5)}}
@keyframes musicPulse{0%,100%{box-shadow:0 0 20px rgba(93,184,165,.5)}50%{box-shadow:0 0 40px rgba(93,184,165,.8)}}
@keyframes pageTransition{from{opacity:0;transform:translateY(30px) scale(.95)}to{opacity:1;transform:translateY(0) scale(1)}}
@keyframes glow{0%,100%{text-shadow:0 0 20px rgba(147,51,234,.5)}50%{text-shadow:0 0 40px rgba(147,51,234,.8)}}
@keyframes spin{from{transform:rotate(0)}to{transform:rotate(360deg)}}
@keyframes bounce{0%,100%{transform:translateY(0)}50%{transform:translateY(-20px)}}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
@keyframes llamaBounce{0%,100%{transform:translateY(0) rotate(-2deg)}50%{transform:translateY(-10px) rotate(2deg)}}
@keyframes llamaDance{0%,100%{transform:rotate(-5deg) scale(1.1)}50%{transform:rotate(5deg) scale(1.1)}}
@keyframes sparkleAnim{0%{transform:translate(-50%,-50%) scale(0) rotate(0);opacity:1}100%{transform:translate(-50%,-50%) scale(1.5) rotate(180deg);opacity:0}}
@keyframes fireConfettiFall{0%{transform:translateY(0) rotate(0) scale(1);opacity:1}100%{transform:translateY(100vh) rotate(720deg) scale(0);opacity:0}}
@keyframes noteFloat{0%{transform:translateY(0) rotate(0);opacity:1}100%{transform:translateY(-100px) rotate(360deg);opacity:0}}
@keyframes santaZigzag{0%{transform:translateX(-200px);top:10%}25%{top:30%}50%{top:15%}75%{top:40%}100%{transform:translateX(calc(100vw + 200px));top:30%}}
@keyframes sparkleTrail{0%,100%{opacity:1;transform:scale(1)}50%{opacity:.3;transform:scale(.5)}}
@keyframes hohoFloat{0%{opacity:1;transform:translateY(0) scale(1)}100%{opacity:0;transform:translateY(-50px) scale(1.5)}}
@keyframes particlePop{0%{transform:scale(1) translateY(0);opacity:1}100%{transform:scale(1.5) translateY(-50px);opacity:0}}
@keyframes rainbowBg{0%{filter:hue-rotate(0)}50%{filter:hue-rotate(180deg) brightness(1.2)}100%{filter:hue-rotate(360deg)}}
@keyframes unicornRise{0%{transform:translateY(0) rotate(0);opacity:1}100%{transform:translateY(-120vh) rotate(720deg);opacity:0}}
@keyframes secretPop{0%{transform:translate(-50%,-50%) scale(0);opacity:0}50%{transform:translate(-50%,-50%) scale(1.3);opacity:1}100%{transform:translate(-50%,-50%) scale(1);opacity:0}}
@keyframes llamaSpin{0%{transform:translate(-50%,-50%) scale(0) rotate(-180deg)}50%{transform:translate(-50%,-50%) scale(1.2) rotate(10deg)}100%{transform:translate(-50%,-50%) scale(1) rotate(0)}}
@keyframes pulse{0%,100%{transform:translateX(-50%) scale(1);box-shadow:0 0 10px rgba(147,51,234,.5)}50%{transform:translateX(-50%) scale(1.05);box-shadow:0 0 20px rgba(147,51,234,.8)}}
@keyframes fadeOut{to{opacity:0;transform:translateX(-50%) translateY(-20px)}}
@media(max-width:768px){.container{padding:1rem;margin-left:70px}.sidebar{width:60px}.sidebar:hover{width:180px}.main-menu{position:relative;top:0}}
  </style>
</head>
<body class="warm-mode">
<aside class="sidebar">
<div class="sidebar-logo">
    ‚ú®
   </div>
<nav class="sidebar-nav">
<a class="sidebar-item active" data-page="home" href="#">
<span class="sidebar-icon">
      üè†
     </span>
<span class="sidebar-label">
      Accueil
     </span>
</a>
<a class="sidebar-item" data-page="games" href="#">
<span class="sidebar-icon">
      üéÆ
     </span>
<span class="sidebar-label">
      Jeux
     </span>
</a>
<a class="sidebar-item" data-page="about" href="#">
<span class="sidebar-icon">
      ‚ú®
     </span>
<span class="sidebar-label">
      √Ä propos
     </span>
</a>
<a class="sidebar-item" data-page="gallery" href="#">
<span class="sidebar-icon">
      üé®
     </span>
<span class="sidebar-label">
      Galerie
     </span>
</a>
<div class="sidebar-divider">
</div>
<a class="sidebar-item" href="#" onclick="explodeFireConfetti();return false">
<span class="sidebar-icon">
      üî•
     </span>
<span class="sidebar-label">
      Confettis
     </span>
</a>
<a class="sidebar-item" href="#" onclick="toggleMusic();return false">
<span class="sidebar-icon">
      üéµ
     </span>
<span class="sidebar-label">
      Musique
     </span>
</a>
</nav>
<div class="sidebar-footer">
<button class="sidebar-theme-btn" onclick="toggleTheme()" title="Changer de th√®me">
     üåô
    </button>
</div>
</aside>
<div class="pixels" id="pixelContainer">
</div>
<div class="container">
<nav class="main-menu">
<ul>
<li>
<a class="menu-item active" data-page="home" href="#">
       üè† Accueil
      </a>
</li>
<li>
<a class="menu-item" data-page="games" href="#">
       üéÆ Jeux
      </a>
</li>
<li>
<a class="menu-item" data-page="about" href="#">
       ‚ú® √Ä propos
      </a>
</li>
<li>
<a class="menu-item" data-page="gallery" href="#">
       üé® Galerie
      </a>
</li>
</ul>
</nav>
<div class="page-content">
<div class="page active" id="home">
<h1 id="mainTitle" style="background:linear-gradient(90deg,red,orange,yellow,green,blue,indigo,violet);-webkit-background-clip:text;-webkit-text-fill-color:transparent;animation:rainbow 5s ease infinite">
      Hello World
     </h1>
<p class="subtitle">
      Bienvenue dans cet espace digital
     </p>
<button class="theme-toggle" onclick="toggleTheme()">
      Changer de dimension
     </button>
<button class="confetti-btn" onclick="explodeFireConfetti()">
      üî• Confettis Enflamm√©s üî•
     </button>
<button class="music-btn" onclick="toggleMusic()">
      üéµ Animal Crossing Vibes üéµ
     </button>
<audio id="acMusic" loop="" muted="">
<source src="https://lambda.vgmtreasurechest.com/soundtracks/animal-crossing-new-horizons-2020-switch-gamerip/apvmuolo/1-09.%209%20a.m.%20%28~Sunny%20Weather~%29.mp3" type="audio/mpeg"/>
</audio>
</div>
<div class="page" id="games">
<h1>
      Zone de Jeux
     </h1>
<p class="subtitle">
      Choisissez votre aventure pixelis√©e
     </p>
<div class="games-grid">
<div class="game-card" onclick="showGame('snake')">
<h3>
        üêç Snake N√©on
       </h3>
<p>
        Le classique revisit√©
       </p>
</div>
<div class="game-card" onclick="showGame('pong')">
<h3>
        üèì Cyber Pong
       </h3>
<p>
        D√©fi r√©tro-futuriste
       </p>
</div>
<div class="game-card" onclick="showGame('particles')">
<h3>
        ‚ú® Particules
       </h3>
<p>
        Cr√©ez votre galaxie
       </p>
</div>
<div class="game-card" onclick="showGame('lutin')">
<h3>
        üßù Lutin Gourmand
       </h3>
<p>
        Muffins &amp; Or!
       </p>
</div>
</div>
<div id="gameContainer">
<canvas height="400" id="snakeCanvas" width="400">
</canvas>
<canvas height="400" id="pongCanvas" width="600">
</canvas>
<canvas height="400" id="particlesCanvas" width="600">
</canvas>
<canvas height="400" id="lutinCanvas" width="600">
</canvas>
<div id="gameControls">
<p>
<span id="gameInstructions">
         S√©lectionnez un jeu
        </span>
        | Score:
        <span id="score">
         0
        </span>
</p>
</div>
</div>
</div>
<div class="page" id="about">
<h1>
      √Ä propos
     </h1>
<div class="about-content">
<p class="glowing-text">
       Cet espace est une exp√©rience collaborative en temps r√©el
      </p>
<p>
       Chaque pixel raconte une histoire, chaque ligne de code est une aventure.
      </p>
<div class="stats">
<div class="stat-card">
<h3>
         ‚àû
        </h3>
<p>
         Possibilit√©s
        </p>
</div>
<div class="stat-card">
<h3>
         42
        </h3>
<p>
         R√©ponses
        </p>
</div>
<div class="stat-card">
<h3>
         1337
        </h3>
<p>
         Lignes de magie
        </p>
</div>
</div>
</div>
</div>
<div class="page" id="gallery">
<h1>
      Galerie Digitale
     </h1>
<p class="subtitle">
      Art g√©n√©ratif et cr√©ations algorithmiques
     </p>
<div class="art-grid">
<div class="art-piece" id="art1">
</div>
<div class="art-piece" id="art2">
</div>
<div class="art-piece" id="art3">
</div>
<div class="art-piece" id="art4">
</div>
<div class="art-piece" id="art5">
<pre id="llamaArt">       .=*=.
      /  6 6\
     |  (_)  |
     /`-._.-'`\
    /    |    \
   /     |     \
  |  |   |   |  |
  |  |   |   |  |
  |__|   |   |__|
   LL    |    LL
         |
    ~~ LLAMA ~~</pre>
<div class="llama-sparkles">
</div>
<p style="margin-top:10px;font-size:12px;color:#8b5a2b">
        ü¶ô Pixel Llama ü¶ô
       </p>
</div>
</div>
</div>
<div class="mini-monster" onclick="spawnSparkles(event);playSound('robot')">
<span style="font-size:24px;color:#fff">
      üëæ
     </span>
</div>
<div class="monster-speech">
     Clique-moi! ‚ú®
    </div>
<button class="red-button" onclick="playSound('red')">
     üåü Nouveau Bouton Rouge üåü
    </button>
</div>
</div>
<audio id="robotSound" preload="auto" src="https://www.soundjay.com/button/sounds/button-16.mp3">
</audio>
<audio id="redButtonSound" preload="auto" src="https://cdn.freesound.org/previews/642/642431_14147481-lq.mp3">
</audio>
<div id="easter-egg-hint">
   ü•ö Secrets: Konami Code ‚Üë‚Üë‚Üì‚Üì‚Üê‚Üí‚Üê‚ÜíBA | Triple-clic sur le titre | Tape "llama"
  </div>
<div id="santa-sleigh">
   ü¶åü¶åüõ∑üéÖ
   <span style="position:absolute;animation:sparkleTrail .5s infinite;font-size:1rem">
    ‚ú®
   </span>
<span style="position:absolute;left:-20px;top:10px;animation:sparkleTrail .7s infinite .2s;font-size:.8rem">
    ‚≠ê
   </span>
<span style="position:absolute;left:-40px;top:-5px;animation:sparkleTrail .6s infinite .4s;font-size:1.2rem">
    ‚ùÑÔ∏è
   </span>
</div>
<script>
   let currentMode='warm',musicPlaying=false,currentGame=null;
const $=s=>document.querySelector(s),$$=s=>document.querySelectorAll(s);
const acAudio=$('#acMusic'),musicBtn=$('.music-btn');

// Theme
function toggleTheme(){const b=document.body,s=$('.subtitle'),btn=$('.theme-toggle');
if(currentMode==='warm'){b.classList.replace('warm-mode','twitch-mode');s.textContent='< WELCOME TO THE MATRIX >';btn.textContent='[ RETOUR AU CALME ]';currentMode='twitch';generatePixels()}
else{b.classList.replace('twitch-mode','warm-mode');s.textContent='Bienvenue dans cet espace digital';btn.textContent='Changer de dimension';currentMode='warm';$('#pixelContainer').innerHTML=''}}
function generatePixels(){const c=$('#pixelContainer');for(let i=0;i<20;i++)setTimeout(()=>{const p=document.createElement('div');p.className='pixel';p.style.cssText=`position:absolute;width:4px;height:4px;background:#9333ea;box-shadow:0 0 10px #9333ea;left:${Math.random()*100}%;animation:pixelFloat ${10+Math.random()*10}s linear infinite;animation-delay:${Math.random()*10}s`;c.appendChild(p)},i*100)}

// Navigation
$$('.menu-item,.sidebar-item[data-page]').forEach(i=>i.addEventListener('click',e=>{e.preventDefault();const p=i.dataset.page;if(!p)return;
$$('.menu-item,.sidebar-item').forEach(x=>x.classList.remove('active'));
$$(`[data-page="${p}"]`).forEach(x=>x.classList.add('active'));
$$('.page').forEach(x=>{x.classList.remove('active');if(x.id===p)x.classList.add('active')});
if(p!=='games')$$('#gameContainer canvas').forEach(c=>c.style.display='none')}));

// Music
function toggleMusic(){if(musicPlaying){acAudio.pause();musicBtn.textContent='üéµ Animal Crossing Vibes üéµ';musicBtn.classList.remove('playing')}
else{acAudio.muted=false;acAudio.volume=0.5;acAudio.play();musicBtn.textContent='üé∂ Now Playing... üé∂';musicBtn.classList.add('playing');spawnNotes()}musicPlaying=!musicPlaying}
function spawnNotes(){if(!musicPlaying)return;const n=document.createElement('div');n.textContent=['üéµ','üé∂','‚ô™','‚ô´','üå∏','üçÉ'][Math.floor(Math.random()*6)];
n.style.cssText=`position:fixed;bottom:20%;left:${Math.random()*80+10}%;font-size:${Math.random()*20+20}px;pointer-events:none;z-index:9999;animation:noteFloat 3s ease-out forwards`;
document.body.appendChild(n);setTimeout(()=>n.remove(),3000);setTimeout(spawnNotes,800)}

// Confetti
function explodeFireConfetti(){const colors=['#ff6b35','#f7931e','#ffcc00','#ff4500'],shapes=['üî•','‚ú®','üí•','‚≠ê'];
for(let i=0;i<80;i++)setTimeout(()=>{const c=document.createElement('div');c.className='fire-confetti';
if(Math.random()>.5){c.textContent=shapes[Math.floor(Math.random()*shapes.length)];c.style.fontSize=(Math.random()*20+15)+'px'}
else{c.style.cssText+=`width:${Math.random()*15+8}px;height:${Math.random()*15+8}px;background:linear-gradient(${Math.random()*360}deg,${colors[Math.floor(Math.random()*colors.length)]},${colors[Math.floor(Math.random()*colors.length)]});border-radius:${Math.random()>.5?'50%':'2px'}`}
c.style.cssText+=`left:${Math.random()*100}vw;top:-50px;animation:fireConfettiFall ${Math.random()*2+2}s ease-out forwards`;
document.body.appendChild(c);setTimeout(()=>c.remove(),4000)},i*30)}

// Sparkles
function spawnSparkles(e){const emojis=['‚ú®','‚≠ê','üåü','üí´','üíñ'],rect=e.currentTarget.getBoundingClientRect(),cx=rect.left+rect.width/2,cy=rect.top+rect.height/2;
for(let i=0;i<25;i++)setTimeout(()=>{const s=document.createElement('div');s.className='sparkle';s.textContent=emojis[Math.floor(Math.random()*emojis.length)];
s.style.cssText=`font-size:${Math.random()*20+15}px;left:${cx}px;top:${cy}px`;
const a=(Math.PI*2*i)/25,d=Math.random()*100+50,ex=cx+Math.cos(a)*d,ey=cy+Math.sin(a)*d;
s.animate([{left:cx+'px',top:cy+'px',opacity:1,transform:'scale(0) rotate(0)'},{left:ex+'px',top:ey+'px',opacity:0,transform:'scale(1.2) rotate(360deg)'}],{duration:Math.random()*500+800,easing:'ease-out',fill:'forwards'});
document.body.appendChild(s);setTimeout(()=>s.remove(),1500)},i*20);
const sp=$('.monster-speech'),msgs=['Woohoo! ‚ú®','Sparkles! üåü','Magique! üí´'];sp.textContent=msgs[Math.floor(Math.random()*msgs.length)];
setTimeout(()=>sp.textContent='Clique encore! üëæ',1000)}

// Sounds
function playSound(t){$('#'+(t==='robot'?'robotSound':'redButtonSound')).play()}

// Games
function showGame(g){$$('#gameContainer canvas').forEach(c=>c.style.display='none');currentGame=g;
switch(g){case'snake':$('#snakeCanvas').style.display='block';$('#gameInstructions').textContent='‚Üë‚Üì‚Üê‚Üí pour jouer';break;
case'pong':$('#pongCanvas').style.display='block';$('#gameInstructions').textContent='W/S et ‚Üë/‚Üì pour jouer';initPong();break;
case'particles':$('#particlesCanvas').style.display='block';$('#gameInstructions').textContent='Cliquez pour cr√©er';initParticles();break;
case'lutin':$('#lutinCanvas').style.display='block';$('#gameInstructions').textContent='ESPACE pour commencer!';initLutinPrompt();break}}

// Snake
let snake=[{x:200,y:200}],dx=20,dy=0,foodX,foodY,score=0,gameRunning=false,gameInterval;
const snakeCanvas=$('#snakeCanvas'),snakeCtx=snakeCanvas.getContext('2d');
function initSnake(){snake=[{x:200,y:200}];dx=20;dy=0;score=0;$('#score').textContent=score;foodX=Math.floor(Math.random()*20)*20;foodY=Math.floor(Math.random()*20)*20;gameRunning=true}
function snakeLoop(){if(!gameRunning)return;for(let i=4;i<snake.length;i++)if(snake[i].x===snake[0].x&&snake[i].y===snake[0].y){gameRunning=false;clearInterval(gameInterval);snakeCtx.fillStyle='#bf94ff';snakeCtx.font='30px Orbitron';snakeCtx.textAlign='center';snakeCtx.fillText('GAME OVER',200,200);snakeCtx.font='16px Orbitron';snakeCtx.fillText('Press SPACE to restart',200,240);return}
snakeCtx.fillStyle='#1a1a1d';snakeCtx.fillRect(0,0,400,400);snakeCtx.fillStyle='#ec4899';snakeCtx.shadowBlur=15;snakeCtx.shadowColor='#ec4899';snakeCtx.fillRect(foodX,foodY,18,18);snakeCtx.shadowBlur=0;
const head={x:snake[0].x+dx,y:snake[0].y+dy};if(head.x<0)head.x=380;if(head.x>=400)head.x=0;if(head.y<0)head.y=380;if(head.y>=400)head.y=0;snake.unshift(head);
if(snake[0].x===foodX&&snake[0].y===foodY){score+=10;$('#score').textContent=score;foodX=Math.floor(Math.random()*20)*20;foodY=Math.floor(Math.random()*20)*20}else snake.pop();
snakeCtx.fillStyle='#9333ea';snakeCtx.shadowBlur=10;snakeCtx.shadowColor='#9333ea';snake.forEach(p=>snakeCtx.fillRect(p.x,p.y,18,18));snakeCtx.shadowBlur=0}

// Pong
let pongRunning=false,paddle1Y=150,paddle2Y=150,ballX=300,ballY=200,ballDX=4,ballDY=3,pongScore1=0,pongScore2=0;
const pongCanvas=$('#pongCanvas'),pongCtx=pongCanvas.getContext('2d');
function initPong(){if(!pongRunning){pongRunning=true;pongLoop()}}
function pongLoop(){if(!pongRunning||currentGame!=='pong')return;pongCtx.fillStyle='#1a1a1d';pongCtx.fillRect(0,0,600,400);
pongCtx.fillStyle='#ec4899';pongCtx.shadowBlur=10;pongCtx.shadowColor='#ec4899';pongCtx.fillRect(20,paddle1Y,10,100);pongCtx.fillRect(570,paddle2Y,10,100);
pongCtx.beginPath();pongCtx.arc(ballX,ballY,10,0,Math.PI*2);pongCtx.fill();ballX+=ballDX;ballY+=ballDY;
if(ballY<=10||ballY>=390)ballDY=-ballDY;if(ballX<=40&&ballY>=paddle1Y&&ballY<=paddle1Y+100&&ballDX<0)ballDX=-ballDX*1.1;
if(ballX>=560&&ballY>=paddle2Y&&ballY<=paddle2Y+100&&ballDX>0)ballDX=-ballDX*1.1;
if(ballX<0){pongScore2++;ballX=300;ballY=200;ballDX=4;ballDY=3}if(ballX>600){pongScore1++;ballX=300;ballY=200;ballDX=-4;ballDY=3}
if(ballY>paddle2Y+50)paddle2Y+=3;if(ballY<paddle2Y+50)paddle2Y-=3;
pongCtx.strokeStyle='#9333ea';pongCtx.setLineDash([5,15]);pongCtx.beginPath();pongCtx.moveTo(300,0);pongCtx.lineTo(300,400);pongCtx.stroke();
$('#score').textContent=pongScore1+' - '+pongScore2;requestAnimationFrame(pongLoop)}

// Particles
let particles=[];
const particlesCanvas=$('#particlesCanvas'),particlesCtx=particlesCanvas.getContext('2d');
function initParticles(){particlesCanvas.onclick=e=>{const rect=particlesCanvas.getBoundingClientRect(),x=e.clientX-rect.left,y=e.clientY-rect.top;
for(let i=0;i<30;i++)particles.push({x,y,vx:(Math.random()-.5)*8,vy:(Math.random()-.5)*8,size:Math.random()*3+1,color:`hsl(${Math.random()*360},100%,50%)`,life:1})};animateParticles()}
function animateParticles(){if(currentGame!=='particles')return;particlesCtx.fillStyle='rgba(0,0,0,0.05)';particlesCtx.fillRect(0,0,600,400);
particles=particles.filter(p=>p.life>0);particles.forEach(p=>{p.x+=p.vx;p.y+=p.vy;p.vy+=0.1;p.life-=0.01;particlesCtx.fillStyle=p.color;particlesCtx.globalAlpha=p.life;particlesCtx.beginPath();particlesCtx.arc(p.x,p.y,p.size,0,Math.PI*2);particlesCtx.fill()});
particlesCtx.globalAlpha=1;requestAnimationFrame(animateParticles)}

// Lutin
let lutin={x:50,y:300,vy:0,jumping:false},muffins=[],goldCoins=[],traps=[],lutinScore=0,lutinRunning=false,gameSpeed=3;
const lutinCanvas=$('#lutinCanvas'),lutinCtx=lutinCanvas.getContext('2d'),groundY=350;
function initLutinPrompt(){lutinCtx.fillStyle='#228b22';lutinCtx.font='20px Orbitron';lutinCtx.textAlign='center';lutinCtx.fillText('üßù Appuie sur ESPACE! üßù',300,200)}
function initLutin(){lutin={x:50,y:groundY-50,vy:0,jumping:false};muffins=[];goldCoins=[];traps=[];lutinScore=0;gameSpeed=3;lutinRunning=true;$('#gameInstructions').textContent='ESPACE/‚Üë pour sauter!';lutinLoop()}
function lutinLoop(){if(!lutinRunning||currentGame!=='lutin')return;
const g=lutinCtx.createLinearGradient(0,0,0,400);g.addColorStop(0,'#87ceeb');g.addColorStop(1,'#98fb98');lutinCtx.fillStyle=g;lutinCtx.fillRect(0,0,600,400);
lutinCtx.fillStyle='#8b4513';lutinCtx.fillRect(0,groundY,600,50);lutinCtx.fillStyle='#228b22';lutinCtx.fillRect(0,groundY-5,600,10);
lutin.vy+=0.8;lutin.y+=lutin.vy;if(lutin.y>=groundY-50){lutin.y=groundY-50;lutin.vy=0;lutin.jumping=false}
if(Math.random()<0.02)muffins.push({x:620,y:groundY-30-Math.random()*100,size:25});
if(Math.random()<0.015)goldCoins.push({x:620,y:groundY-50-Math.random()*80,size:20,angle:0});
if(Math.random()<0.01)traps.push({x:620,y:groundY-25,width:40,height:25});
const col=(a,b)=>a.x<b.x+(b.width||b.size)&&a.x+40>b.x-(b.size||0)&&a.y<b.y+(b.height||b.size)&&a.y+50>b.y-(b.size||0);
muffins=muffins.filter(m=>{m.x-=gameSpeed;if(col(lutin,{x:m.x-m.size,y:m.y-m.size,width:m.size*2,height:m.size*2})){lutinScore+=15;return false}lutinCtx.fillStyle='#deb887';lutinCtx.fillRect(m.x-10,m.y+5,20,15);lutinCtx.fillStyle='#ff6b6b';lutinCtx.beginPath();lutinCtx.arc(m.x,m.y,m.size/2,0,Math.PI*2);lutinCtx.fill();return m.x>-30});
goldCoins=goldCoins.filter(g=>{g.x-=gameSpeed;g.angle+=0.1;if(col(lutin,{x:g.x-g.size,y:g.y-g.size,width:g.size*2,height:g.size*2})){lutinScore+=25;return false}lutinCtx.fillStyle='#ffd700';lutinCtx.shadowBlur=15;lutinCtx.shadowColor='#ffd700';lutinCtx.beginPath();lutinCtx.arc(g.x,g.y,g.size/2,0,Math.PI*2);lutinCtx.fill();lutinCtx.shadowBlur=0;return g.x>-30});
traps=traps.filter(t=>{t.x-=gameSpeed;if(col(lutin,t)){lutinRunning=false;lutinCtx.fillStyle='rgba(0,0,0,0.7)';lutinCtx.fillRect(0,0,600,400);lutinCtx.fillStyle='#ffd700';lutinCtx.font='bold 40px Orbitron';lutinCtx.textAlign='center';lutinCtx.fillText('GAME OVER',300,180);lutinCtx.font='20px Orbitron';lutinCtx.fillStyle='#fff';lutinCtx.fillText('Score: '+lutinScore,300,220);lutinCtx.fillText('ESPACE pour rejouer',300,260);return false}lutinCtx.fillStyle='#4a4a4a';for(let i=0;i<4;i++){lutinCtx.beginPath();lutinCtx.moveTo(t.x+i*10,t.y+t.height);lutinCtx.lineTo(t.x+i*10+5,t.y);lutinCtx.lineTo(t.x+i*10+10,t.y+t.height);lutinCtx.fill()}return t.x>-50});
lutinCtx.fillStyle='#228b22';lutinCtx.beginPath();lutinCtx.ellipse(lutin.x+20,lutin.y+35,15,20,0,0,Math.PI*2);lutinCtx.fill();lutinCtx.fillStyle='#ffdab9';lutinCtx.beginPath();lutinCtx.arc(lutin.x+20,lutin.y+12,12,0,Math.PI*2);lutinCtx.fill();lutinCtx.fillStyle='#ff4500';lutinCtx.beginPath();lutinCtx.moveTo(lutin.x+8,lutin.y+5);lutinCtx.lineTo(lutin.x+20,lutin.y-15);lutinCtx.lineTo(lutin.x+32,lutin.y+5);lutinCtx.fill();
$('#score').textContent=lutinScore;gameSpeed+=0.001;requestAnimationFrame(lutinLoop)}

// Controls
const keys={};
document.addEventListener('keydown',e=>{keys[e.key]=true;
if(currentGame==='snake'){if(!gameRunning&&e.code==='Space'){initSnake();gameInterval=setInterval(snakeLoop,100);return}if(!gameRunning)return;const gu=dy===-20,gd=dy===20,gr=dx===20,gl=dx===-20;if(e.key==='ArrowLeft'&&!gr){dx=-20;dy=0}if(e.key==='ArrowUp'&&!gd){dx=0;dy=-20}if(e.key==='ArrowRight'&&!gl){dx=20;dy=0}if(e.key==='ArrowDown'&&!gu){dx=0;dy=20}}
if(currentGame==='pong'){if(keys['w']||keys['W'])paddle1Y=Math.max(0,paddle1Y-20);if(keys['s']||keys['S'])paddle1Y=Math.min(300,paddle1Y+20)}
if(currentGame==='lutin'&&(e.code==='Space'||e.key==='ArrowUp')){e.preventDefault();if(!lutinRunning)initLutin();else if(!lutin.jumping){lutin.vy=-15;lutin.jumping=true}}});
document.addEventListener('keyup',e=>keys[e.key]=false);

// Easter Eggs
let konamiCode=['ArrowUp','ArrowUp','ArrowDown','ArrowDown','ArrowLeft','ArrowRight','ArrowLeft','ArrowRight','b','a'],konamiIndex=0,typedKeys='',titleClicks=0,titleTimer=null;
document.addEventListener('keydown',e=>{if(e.key===konamiCode[konamiIndex]){konamiIndex++;if(konamiIndex===konamiCode.length){$('h1').style.animation='glitch 0.3s ease-in-out 5';setTimeout(()=>$('h1').style.animation='',1500);konamiIndex=0}}else konamiIndex=0});
document.addEventListener('keypress',e=>{typedKeys+=e.key.toLowerCase();if(typedKeys.length>10)typedKeys=typedKeys.slice(-10);if(typedKeys.includes('llama')){typedKeys='';summonLlama()}});
$('#mainTitle').onclick=()=>{titleClicks++;clearTimeout(titleTimer);titleTimer=setTimeout(()=>titleClicks=0,500);if(titleClicks>=3){titleClicks=0;activateRainbow()}};
function activateRainbow(){document.body.style.animation='rainbowBg 2s ease';for(let i=0;i<15;i++)setTimeout(()=>{const u=document.createElement('div');u.textContent=['ü¶Ñ','üåà','‚≠ê'][Math.floor(Math.random()*3)];u.style.cssText=`position:fixed;font-size:${Math.random()*30+20}px;left:${Math.random()*100}vw;top:100vh;z-index:10000;pointer-events:none;animation:unicornRise 3s ease-out forwards`;document.body.appendChild(u);setTimeout(()=>u.remove(),3000)},i*100);
const m=document.createElement('div');m.innerHTML='ü¶Ñ MODE LICORNE ACTIV√â! üåà';m.style.cssText='position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);font-size:2rem;color:#fff;text-shadow:0 0 20px #ff69b4,0 0 40px #9333ea;z-index:10001;animation:secretPop 2s ease-out forwards;pointer-events:none';document.body.appendChild(m);setTimeout(()=>m.remove(),2000)}
function summonLlama(){const l=document.createElement('div');l.innerHTML='<pre style="font-size:6px;line-height:1;color:#9333ea">   .=*=.\n  /  ^ ^\\\n |  (o)  |\nü¶ô LLAMA! ü¶ô</pre>';l.style.cssText='position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:rgba(255,255,255,.95);padding:2rem;border-radius:20px;z-index:10002;animation:llamaSpin 1s ease;box-shadow:0 0 50px rgba(147,51,234,.8)';document.body.appendChild(l);for(let i=0;i<20;i++)setTimeout(()=>{const m=document.createElement('span');m.textContent='ü¶ô';m.style.cssText=`position:fixed;font-size:30px;left:${Math.random()*100}vw;top:${Math.random()*100}vh;z-index:10001;animation:llamaBounce .5s ease infinite;pointer-events:none`;document.body.appendChild(m);setTimeout(()=>m.remove(),2000)},i*50);setTimeout(()=>l.remove(),2500)}

// Art2 dynamic
setInterval(()=>{if($('#gallery').classList.contains('active'))$('#art2').style.background=`radial-gradient(circle at ${Math.random()*100}% ${Math.random()*100}%,rgba(147,51,234,${Math.random()}),rgba(236,72,153,${Math.random()}),rgba(6,182,212,${Math.random()}),#000)`},2000);

// Llama hover
$('#art5').onmouseenter=()=>{const c=$('#art5 .llama-sparkles');for(let i=0;i<10;i++)setTimeout(()=>{const s=document.createElement('span');s.textContent=['‚ú®','üåü','üíú','ü¶ô'][Math.floor(Math.random()*4)];s.style.cssText=`position:absolute;left:${Math.random()*80+10}%;top:${Math.random()*80+10}%;font-size:${Math.random()*15+10}px;animation:sparkleAnim 1s ease-out forwards;pointer-events:none`;c.appendChild(s);setTimeout(()=>s.remove(),1000)},i*100)};

// Santa
setInterval(()=>{const s=$('#santa-sleigh');if(s&&Math.random()>.7){const h=document.createElement('div');h.textContent='Ho Ho Ho! üéÑ';h.style.cssText='position:fixed;font-size:1rem;color:#f00;font-weight:bold;text-shadow:0 0 10px #fff;z-index:10000;animation:hohoFloat 2s ease-out forwards;pointer-events:none';const r=s.getBoundingClientRect();h.style.left=r.left+'px';h.style.top=(r.top+50)+'px';document.body.appendChild(h);setTimeout(()=>h.remove(),2000)}},3000);

// Audio hint
(function(){let hi=false;const enable=()=>{if(!hi){hi=true;acAudio.muted=false;acAudio.volume=0.5;acAudio.play().then(()=>{musicPlaying=true;musicBtn.textContent='üé∂ Now Playing... üé∂';musicBtn.classList.add('playing');spawnNotes()}).catch(()=>{})}};['click','touchstart','keydown'].forEach(e=>document.addEventListener(e,enable,{once:true,passive:true}));
const h=document.createElement('div');h.id='audio-hint';h.innerHTML='üéµ Cliquez pour activer la musique!';h.style.cssText='position:fixed;top:20px;left:50%;transform:translateX(-50%);background:rgba(147,51,234,.9);color:#fff;padding:10px 20px;border-radius:25px;z-index:10000;font-size:14px;animation:pulse 2s infinite;cursor:pointer';document.body.appendChild(h);const rm=()=>{const x=$('#audio-hint');if(x){x.style.animation='fadeOut .5s forwards';setTimeout(()=>x.remove(),500)}};document.addEventListener('click',rm,{once:true});setTimeout(rm,5000)})();
  </script>
<div id="chess-widget" style="position:fixed;bottom:20px;right:140px;z-index:1000;background:rgba(30,30,35,0.95);border-radius:15px;padding:15px;box-shadow:0 0 30px rgba(147,51,234,0.5);border:2px solid #9333ea;backdrop-filter:blur(10px)">
<div style="text-align:center;margin-bottom:10px">
<span style="color:#bf94ff;font-family:Orbitron,monospace;font-size:12px">
     ‚ôüÔ∏è TWITCH CHESS ‚ôüÔ∏è
    </span>
</div>
<div id="chess-board" style="display:grid;grid-template-columns:repeat(8,28px);grid-template-rows:repeat(8,28px);border:2px solid #9333ea;border-radius:5px;overflow:hidden">
</div>
<div style="margin-top:10px;text-align:center">
<input id="chess-input" placeholder="!move e2e4" style="background:rgba(147,51,234,0.2);border:1px solid #9333ea;border-radius:15px;padding:5px 10px;color:#fff;font-family:monospace;font-size:11px;width:120px;outline:none" type="text"/>
<button id="chess-send" style="background:#9333ea;border:none;border-radius:50%;width:25px;height:25px;color:#fff;cursor:pointer;margin-left:5px;font-size:10px">
     ‚ñ∂
    </button>
</div>
<div id="chess-status" style="color:#bf94ff;font-size:10px;text-align:center;margin-top:8px;font-family:monospace">
    Tour: Blancs
   </div>
<div id="chess-log" style="max-height:60px;overflow-y:auto;font-size:9px;color:#888;margin-top:5px;font-family:monospace">
</div>
</div>
<script>
   (function(){
const initialBoard = [
  ['‚ôú','‚ôû','‚ôù','‚ôõ','‚ôö','‚ôù','‚ôû','‚ôú'],
  ['‚ôü','‚ôü','‚ôü','‚ôü','‚ôü','‚ôü','‚ôü','‚ôü'],
  ['','','','','','','',''],
  ['','','','','','','',''],
  ['','','','','','','',''],
  ['','','','','','','',''],
  ['‚ôô','‚ôô','‚ôô','‚ôô','‚ôô','‚ôô','‚ôô','‚ôô'],
  ['‚ôñ','‚ôò','‚ôó','‚ôï','‚ôî','‚ôó','‚ôò','‚ôñ']
];
let board = JSON.parse(JSON.stringify(initialBoard));
let whiteTurn = true;
let moveHistory = [];

const whitePieces = ['‚ôî','‚ôï','‚ôñ','‚ôó','‚ôò','‚ôô'];
const blackPieces = ['‚ôö','‚ôõ','‚ôú','‚ôù','‚ôû','‚ôü'];

function renderBoard() {
  const container = document.getElementById('chess-board');
  if(!container) return;
  container.innerHTML = '';
  for(let r=0; r<8; r++) {
    for(let c=0; c<8; c++) {
      const sq = document.createElement('div');
      sq.style.cssText = `width:28px;height:28px;display:flex;align-items:center;justify-content:center;font-size:20px;cursor:pointer;background:${(r+c)%2===0?'#f0d9b5':'#b58863'};transition:background 0.2s`;
      sq.dataset.row = r;
      sq.dataset.col = c;
      sq.textContent = board[r][c];
      sq.onmouseenter = () => sq.style.boxShadow = 'inset 0 0 10px rgba(147,51,234,0.8)';
      sq.onmouseleave = () => sq.style.boxShadow = 'none';
      container.appendChild(sq);
    }
  }
}

function parseMove(moveStr) {
  const clean = moveStr.replace('!move','').trim().toLowerCase();
  if(clean.length < 4) return null;
  const fromCol = clean.charCodeAt(0) - 97;
  const fromRow = 8 - parseInt(clean[1]);
  const toCol = clean.charCodeAt(2) - 97;
  const toRow = 8 - parseInt(clean[3]);
  if(fromCol<0||fromCol>7||toCol<0||toCol>7||fromRow<0||fromRow>7||toRow<0||toRow>7) return null;
  return {fromRow, fromCol, toRow, toCol};
}

function isValidMove(move) {
  const piece = board[move.fromRow][move.fromCol];
  if(!piece) return false;
  const isWhite = whitePieces.includes(piece);
  if(whiteTurn && !isWhite) return false;
  if(!whiteTurn && isWhite) return false;
  const target = board[move.toRow][move.toCol];
  if(target) {
    const targetIsWhite = whitePieces.includes(target);
    if(isWhite === targetIsWhite) return false;
  }
  return true;
}

function makeMove(moveStr) {
  const move = parseMove(moveStr);
  if(!move) {
    addLog('‚ùå Format invalide! Ex: e2e4');
    return false;
  }
  if(!isValidMove(move)) {
    addLog('‚ùå Coup ill√©gal!');
    return false;
  }
  const piece = board[move.fromRow][move.fromCol];
  const captured = board[move.toRow][move.toCol];
  board[move.toRow][move.toCol] = piece;
  board[move.fromRow][move.fromCol] = '';
  whiteTurn = !whiteTurn;
  const notation = String.fromCharCode(97+move.fromCol)+(8-move.fromRow)+String.fromCharCode(97+move.toCol)+(8-move.toRow);
  moveHistory.push(notation);
  addLog((whiteTurn?'‚¨õ':'‚¨ú')+' '+piece+' '+notation+(captured?' x'+captured:''));
  updateStatus();
  renderBoard();
  highlightMove(move);
  return true;
}

function highlightMove(move) {
  setTimeout(() => {
    const squares = document.querySelectorAll('#chess-board div');
    const fromIdx = move.fromRow*8+move.fromCol;
    const toIdx = move.toRow*8+move.toCol;
    if(squares[fromIdx]) squares[fromIdx].style.background = 'rgba(147,51,234,0.5)';
    if(squares[toIdx]) squares[toIdx].style.background = 'rgba(236,72,153,0.5)';
    setTimeout(() => renderBoard(), 1500);
  }, 50);
}

function updateStatus() {
  const status = document.getElementById('chess-status');
  if(status) status.textContent = 'Tour: '+(whiteTurn?'‚¨ú Blancs':'‚¨õ Noirs');
}

function addLog(msg) {
  const log = document.getElementById('chess-log');
  if(log) {
    log.innerHTML = msg+'<br>'+log.innerHTML;
    if(log.children.length > 10) log.innerHTML = log.innerHTML.split('<br>').slice(0,10).join('<br>');
  }
}

function handleInput() {
  const input = document.getElementById('chess-input');
  if(input && input.value) {
    makeMove(input.value);
    input.value = '';
  }
}

document.getElementById('chess-send')?.addEventListener('click', handleInput);
document.getElementById('chess-input')?.addEventListener('keypress', e => { if(e.key==='Enter') handleInput(); });

window.twitchChessMove = makeMove;
renderBoard();
addLog('üéÆ !move e2e4 pour jouer');

setInterval(() => {
  if(Math.random() > 0.95 && !whiteTurn) {
    const moves = ['e7e5','d7d5','g8f6','b8c6','f8c5'];
    const randomMove = moves[Math.floor(Math.random()*moves.length)];
  }
}, 5000);
})();
  </script>
<script>
   (function(){ setTimeout(function(){ if(window.twitchChessMove) { window.twitchChessMove('e2e4'); } else { const board = document.getElementById('chess-board'); if(board) { const squares = board.querySelectorAll('div'); if(squares[52]) squares[52].textContent = ''; if(squares[36]) squares[36].textContent = '‚ôô'; const status = document.getElementById('chess-status'); if(status) status.textContent = 'Tour: ‚¨õ Noirs'; const log = document.getElementById('chess-log'); if(log) log.innerHTML = '‚¨õ ‚ôô e2e4<br>' + log.innerHTML; } } }, 500); })();
  </script>
</body>
</html>
